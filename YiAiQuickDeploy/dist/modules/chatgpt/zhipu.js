'use strict';const _0x4848e0=_0x3b6e;(function(_0x371cb5,_0x599c0d){const _0x41cecb=_0x3b6e,_0x22c4a4=_0x371cb5();while(!![]){try{const _0x38b81c=parseInt(_0x41cecb(0xf1))/0x1*(-parseInt(_0x41cecb(0xfd))/0x2)+-parseInt(_0x41cecb(0xeb))/0x3*(parseInt(_0x41cecb(0xf5))/0x4)+parseInt(_0x41cecb(0xe2))/0x5*(parseInt(_0x41cecb(0x10a))/0x6)+parseInt(_0x41cecb(0xfa))/0x7*(-parseInt(_0x41cecb(0x101))/0x8)+-parseInt(_0x41cecb(0xe0))/0x9*(-parseInt(_0x41cecb(0xe9))/0xa)+parseInt(_0x41cecb(0x107))/0xb*(-parseInt(_0x41cecb(0xea))/0xc)+parseInt(_0x41cecb(0xe8))/0xd;if(_0x38b81c===_0x599c0d)break;else _0x22c4a4['push'](_0x22c4a4['shift']());}catch(_0x1bcbcd){_0x22c4a4['push'](_0x22c4a4['shift']());}}}(_0x5926,0x2d004));function _0x3b6e(_0x127568,_0x2ad427){const _0x5926c6=_0x5926();return _0x3b6e=function(_0x3b6e70,_0x70bf5a){_0x3b6e70=_0x3b6e70-0xe0;let _0xe24315=_0x5926c6[_0x3b6e70];return _0xe24315;},_0x3b6e(_0x127568,_0x2ad427);}Object[_0x4848e0(0x10e)](exports,_0x4848e0(0xed),{'value':!![]}),exports[_0x4848e0(0x10d)]=exports[_0x4848e0(0xe3)]=exports['compilerMetaJsonStr']=exports[_0x4848e0(0xf4)]=void 0x0;const axios=require(_0x4848e0(0xfe)),jwt=require('jsonwebtoken');function generateToken(_0x26e22a,_0x11904a=0x3e8*0x3c*0x3c*0x18*0x168){const _0x4e3f69=_0x4848e0,[_0x2da19a,_0x33d889]=_0x26e22a[_0x4e3f69(0xef)]('.'),_0xefe6d9={'api_key':_0x2da19a,'exp':Math[_0x4e3f69(0xe4)](Date[_0x4e3f69(0xe1)]())+_0x11904a*0x3e8,'timestamp':Math['round'](Date[_0x4e3f69(0xe1)]())};return jwt[_0x4e3f69(0x106)](_0xefe6d9,_0x33d889,{'algorithm':_0x4e3f69(0xf8),'header':{'alg':_0x4e3f69(0xf8),'sign_type':_0x4e3f69(0xf3)}});}exports[_0x4848e0(0xf4)]=generateToken;function compilerMetaJsonStr(_0x1bba3a){const _0x2cebe1=_0x4848e0;let _0x1b8bb9={};try{_0x1b8bb9=JSON['parse'](_0x1bba3a);}catch(_0x1fb73b){_0x1b8bb9={'usage':{'completion_tokens':0x31,'prompt_tokens':0x14d,'total_tokens':0x18f}},console[_0x2cebe1(0xf2)]('json\x20parse\x20error\x20from\x20zhipu!',_0x1bba3a);}return _0x1b8bb9;}function _0x5926(){const _0x7f8e62=['length','sendMessageFromZhipu','defineProperty','9KaXhxQ','now','15JVCDpu','compilerStream','round','id:','https://open.bigmodel.cn/api/paas/v3/model-api/','filter','12637053aNGvCD','560390dmDfRd','60WkKjbi','80823fraQHg','application/json','__esModule','data:','split','stream','340939iLrHzl','error','SIGN','generateToken','44dclovf','/sse-invoke','then','HS256','trim','14gHSBWy','text','usage','2GAmOxI','axios','event:','data','1310768sUIRaZ','replace','toString','is_end','catch','sign','371855GlRBai','end','compilerMetaJsonStr','580422buLcEh','error:\x20'];_0x5926=function(){return _0x7f8e62;};return _0x5926();}exports[_0x4848e0(0x109)]=compilerMetaJsonStr;function compilerStream(_0xd773c1){const _0x12bc54=_0x4848e0;var _0x423930;if(_0xd773c1[_0x12bc54(0x10c)]===0x3)return{'event':_0xd773c1[0x0][_0x12bc54(0x102)](_0x12bc54(0xff),''),'id':_0xd773c1[0x1]['replace'](_0x12bc54(0xe5),''),'is_end':![],'result':_0xd773c1[0x2][_0x12bc54(0x102)](_0x12bc54(0xee),'')[_0x12bc54(0xf9)]()};if(_0xd773c1[_0x12bc54(0x10c)]===0x4)return{'event':_0xd773c1[0x0]['replace'](_0x12bc54(0xff),''),'id':_0xd773c1[0x1][_0x12bc54(0x102)](_0x12bc54(0xe5),''),'result':_0xd773c1[0x2][_0x12bc54(0x102)](_0x12bc54(0xee),'')[_0x12bc54(0xf9)](),'is_end':!![],'usage':(_0x423930=compilerMetaJsonStr(_0xd773c1[0x3]['replace']('meta:','')))===null||_0x423930===void 0x0?void 0x0:_0x423930[_0x12bc54(0xfc)]};}exports[_0x4848e0(0xe3)]=compilerStream;async function sendMessageFromZhipu(_0x3f2199,{onProgress:_0x1cc08e,key:_0x50d61b,model:_0x138e53,temperature:temperature=0.95}){const _0x718093=await generateToken(_0x50d61b);return new Promise((_0x4ca965,_0x61a0ef)=>{const _0x137493=_0x3b6e,_0x56a94e=_0x137493(0xe6)+_0x138e53+_0x137493(0xf6),_0x26f273={'method':'POST','url':_0x56a94e,'responseType':_0x137493(0xf0),'headers':{'Content-Type':_0x137493(0xec),'Authorization':_0x718093},'data':{'prompt':_0x3f2199,'temperature':temperature}};axios(_0x26f273)[_0x137493(0xf7)](_0x56e2ad=>{const _0x55b73f=_0x137493,_0xcbbfd7=_0x56e2ad[_0x55b73f(0x100)];let _0x36cfd6,_0x1cacec='';_0xcbbfd7['on']('data',_0x2920d0=>{const _0x3905cc=_0x55b73f,_0x1b4a16=_0x2920d0[_0x3905cc(0x103)]()[_0x3905cc(0xef)]('\x0a')[_0x3905cc(0xe7)](_0x33410c=>_0x33410c[_0x3905cc(0xf9)]()!==''),_0x2194eb=compilerStream(_0x1b4a16);if(!_0x2194eb)return;const {id:_0x485fb8,result:_0xe4f5fb,is_end:_0x141ca5}=_0x2194eb;_0xe4f5fb&&(_0x1cacec+=_0xe4f5fb[_0x3905cc(0xf9)]()),_0x141ca5&&(_0x2194eb[_0x3905cc(0x104)]=![],_0x36cfd6=_0x2194eb,_0x36cfd6[_0x3905cc(0xfb)]=_0x1cacec),_0x1cc08e(_0x2194eb);}),_0xcbbfd7['on'](_0x55b73f(0x108),()=>{_0x4ca965(_0x36cfd6),_0x1cacec='';});})[_0x137493(0x105)](_0x34b00f=>{const _0x4ca3a9=_0x137493;console['log'](_0x4ca3a9(0x10b),_0x34b00f);});});}exports['sendMessageFromZhipu']=sendMessageFromZhipu;