'use strict';const _0xc15df3=_0x32a2;(function(_0x1ed581,_0x5907e1){const _0x2f0fe3=_0x32a2,_0x18c3cb=_0x1ed581();while(!![]){try{const _0x50fb52=parseInt(_0x2f0fe3(0xc0))/0x1*(parseInt(_0x2f0fe3(0xc3))/0x2)+-parseInt(_0x2f0fe3(0xb6))/0x3*(-parseInt(_0x2f0fe3(0xbc))/0x4)+parseInt(_0x2f0fe3(0xaa))/0x5+parseInt(_0x2f0fe3(0xa7))/0x6*(-parseInt(_0x2f0fe3(0xa9))/0x7)+-parseInt(_0x2f0fe3(0xd6))/0x8+parseInt(_0x2f0fe3(0xbd))/0x9*(parseInt(_0x2f0fe3(0xa0))/0xa)+-parseInt(_0x2f0fe3(0xca))/0xb*(parseInt(_0x2f0fe3(0xd2))/0xc);if(_0x50fb52===_0x5907e1)break;else _0x18c3cb['push'](_0x18c3cb['shift']());}catch(_0x1aa20a){_0x18c3cb['push'](_0x18c3cb['shift']());}}}(_0x46c8,0xf2f18));function _0x46c8(){const _0x110605=['replace','user','11778240NlBwOi','includes','parentMessageId','system','text','346190wiYvmP','reduce','NineStore','splice','expires','chat','gemini-pro','30JSdpiG','generateKey','91770BrqwdV','3069820tsPFhT','isArray','encode','content','slice','_recursivePruning','image_url','map','assistant','本次携带上下文的长度','max','ERNIE','36VeCtzt','concat','setData','formatOptions','claude-3-5-sonnet-20240620','set','24404TxgiTE','135tPrqzU','getData','get_encoding','1480883TcNBLa','gpt-4-vision-preview','join','2FhvEbR','namespace','get','__esModule','@dqbd/tiktoken','gpt-4-all','type','242yxtvVp','store','min','defineProperty','push','length','_getTokenCount','getUuid','84228UuitCe','gpt-4o-all'];_0x46c8=function(){return _0x110605;};return _0x46c8();}Object[_0xc15df3(0xcd)](exports,_0xc15df3(0xc6),{'value':!![]}),exports[_0xc15df3(0xa2)]=void 0x0;const uuid_1=require('uuid'),tiktoken_1=require(_0xc15df3(0xc7)),tokenizer=(0x0,tiktoken_1[_0xc15df3(0xbf)])('cl100k_base');class NineStore{constructor(_0x475a4f){const _0xe62822=_0xc15df3,{store:_0x46e1b6,namespace:_0x10abae,expires:_0x928580}=this[_0xe62822(0xb9)](_0x475a4f);this[_0xe62822(0xcb)]=_0x46e1b6,this['namespace']=_0x10abae,this[_0xe62822(0xa4)]=_0x928580;}[_0xc15df3(0xb9)](_0x491beb){const _0x2d8b88=_0xc15df3,{store:_0x16c187,expires:expires=0x3e8*0x3c*0x3c*0x18*0x3,namespace:namespace=_0x2d8b88(0xa5)}=_0x491beb;return{'store':_0x16c187,'namespace':namespace,'expires':expires};}[_0xc15df3(0xa8)](_0x181e22){const _0x47b209=_0xc15df3;return this[_0x47b209(0xc4)]?this[_0x47b209(0xc4)]+'-'+_0x181e22:_0x181e22;}async[_0xc15df3(0xbe)](_0x33fc98){const _0x151faa=_0xc15df3,_0x348313=await this['store'][_0x151faa(0xc5)](_0x33fc98);return _0x348313;}async[_0xc15df3(0xb8)](_0x28da10,_0x3f9855=this[_0xc15df3(0xa4)]){const _0x2b0b45=_0xc15df3;await this[_0x2b0b45(0xcb)][_0x2b0b45(0xbb)](_0x28da10['id'],_0x28da10,_0x3f9855);}async['buildMessageFromParentMessageId'](_0x36f9e3,_0x534c0c){const _0xcc600a=_0xc15df3;let {maxRounds:_0x381a28,maxModelToken:_0x342d62,maxResponseTokens:_0x49ef68,systemMessage:systemMessage='',name:_0x538496,imageUrl:_0x3e9b79,model:_0x5d2973,activeModel:_0x30565f}=_0x534c0c,{parentMessageId:_0x4b6a54}=_0x534c0c,_0x1805d7=[],_0x591cd5=0x0;if(systemMessage){const _0xde5ce9=[_0xcc600a(0xa6),_0xcc600a(0xb5),'hunyuan'],_0x641fba=_0x30565f&&_0xde5ce9['some'](_0x3be90d=>_0x30565f[_0xcc600a(0x9c)](_0x3be90d));_0x641fba?(_0x1805d7['push']({'role':_0xcc600a(0xd5),'content':systemMessage,'name':_0x538496}),_0x1805d7[_0xcc600a(0xce)]({'role':_0xcc600a(0xb2),'content':'好的','name':_0x538496})):_0x1805d7[_0xcc600a(0xce)]({'role':_0xcc600a(0x9e),'content':systemMessage,'name':_0x538496});}const _0x15695a=_0x1805d7[_0xcc600a(0xcf)];let _0x152d0f=0x0;const _0x23f63a=[_0xcc600a(0xc1),'gpt-4o',_0xcc600a(0xba)];if(_0x23f63a[_0xcc600a(0x9c)](_0x30565f)&&_0x3e9b79){const _0x261d45=[{'type':_0xcc600a(0x9f),'text':_0x36f9e3},{'type':'image_url','image_url':{'url':_0x3e9b79}}];_0x1805d7['push']({'role':'user','content':_0x261d45,'name':_0x538496});}else{if(_0x23f63a[_0xcc600a(0x9c)](_0x30565f)&&!_0x3e9b79){const _0x49aafd=[{'type':_0xcc600a(0x9f),'text':_0x36f9e3}];_0x1805d7[_0xcc600a(0xce)]({'role':_0xcc600a(0xd5),'content':_0x49aafd,'name':_0x538496});}else(_0x5d2973===_0xcc600a(0xc8)||_0x5d2973===_0xcc600a(0xd3))&&_0x3e9b79&&(_0x36f9e3=_0x3e9b79+'\x0a'+_0x36f9e3),_0x1805d7[_0xcc600a(0xce)]({'role':'user','content':_0x36f9e3,'name':_0x538496});}let _0x4a7014=_0x1805d7;do{if(!_0x4b6a54)break;const _0x5dddda=await this[_0xcc600a(0xbe)](_0x4b6a54);if(!_0x5dddda)break;const {text:_0x1df1a8,name:_0x8fa581,role:_0x1a8e80,imageUrl:_0x2e8f16}=_0x5dddda;let _0x1fea13=_0x1df1a8;if(_0x2e8f16)_0x23f63a[_0xcc600a(0x9c)](_0x30565f)&&(_0x1a8e80===_0xcc600a(0xb2)?_0x1fea13=[{'type':'text','text':_0x1df1a8}]:_0x1fea13=[{'type':_0xcc600a(0x9f),'text':_0x1df1a8},{'type':_0xcc600a(0xb0),'image_url':{'url':_0x2e8f16}}]);else!_0x2e8f16&&_0x23f63a[_0xcc600a(0x9c)](_0x30565f)&&(_0x1fea13=[{'type':_0xcc600a(0x9f),'text':_0x1df1a8}]);_0x4a7014=_0x4a7014['slice'](0x0,_0x15695a)[_0xcc600a(0xb7)]([{'role':_0x1a8e80,'content':_0x1fea13,'name':_0x8fa581},..._0x4a7014[_0xcc600a(0xae)](_0x15695a)]),_0x152d0f++;if(_0x381a28&&_0x152d0f>=_0x381a28)break;if(_0x342d62&&_0x49ef68){const _0x15aed6=_0x342d62-_0x49ef68;_0x591cd5=await this['_getTokenCount'](_0x4a7014);const _0x45f639=_0x591cd5+0xc8<=_0x15aed6;!_0x45f639&&(_0x4a7014=this[_0xcc600a(0xaf)](_0x4a7014,_0x15aed6,systemMessage));}_0x4b6a54=_0x5dddda[_0xcc600a(0x9d)];}while(!![]);const _0x3c9063=Math[_0xcc600a(0xb4)](0x1,Math[_0xcc600a(0xcc)](_0x342d62-_0x591cd5,_0x49ef68));return console['log'](_0xcc600a(0xb3),_0x4a7014[_0xcc600a(0xcf)],_0x591cd5),{'context':_0x4a7014,'round':_0x4a7014['length'],'historyToken':_0x591cd5};}['_getTokenCount'](_0x20f445){const _0x3db58c=_0xc15df3;let _0x4aa816=_0x20f445[_0x3db58c(0xa1)]((_0x1ea263,_0xb4daee)=>{const _0x12a413=_0x3db58c;if(Array[_0x12a413(0xab)](_0xb4daee[_0x12a413(0xad)])){const _0xa3fc28=_0xb4daee[_0x12a413(0xad)]['filter'](_0x5a6fdf=>_0x5a6fdf[_0x12a413(0xc9)]==='text')[_0x12a413(0xb1)](_0x7b050a=>_0x7b050a['text'])[_0x12a413(0xc2)]('\x20');return _0x1ea263+_0xa3fc28;}else return _0x1ea263+(_0xb4daee['content']||'');},'');return _0x4aa816=_0x4aa816[_0x3db58c(0xd4)](/<\|endoftext\|>/g,''),tokenizer[_0x3db58c(0xac)](_0x4aa816)[_0x3db58c(0xcf)]*2.18;}['_recursivePruning'](_0x1a8988,_0x355e0a,_0x5c17b5){const _0x14748e=_0xc15df3,_0x141644=this[_0x14748e(0xd0)](_0x1a8988);if(_0x141644<=_0x355e0a)return _0x1a8988;return _0x1a8988[_0x14748e(0xa3)](_0x5c17b5?0x1:0x0,0x1),this[_0x14748e(0xaf)](_0x1a8988,_0x355e0a,_0x5c17b5);}[_0xc15df3(0xd1)](){return(0x0,uuid_1['v4'])();}}function _0x32a2(_0x3d9833,_0x24689e){const _0x46c80a=_0x46c8();return _0x32a2=function(_0x32a2b6,_0x14a5d5){_0x32a2b6=_0x32a2b6-0x9c;let _0x22bcc3=_0x46c80a[_0x32a2b6];return _0x22bcc3;},_0x32a2(_0x3d9833,_0x24689e);}exports[_0xc15df3(0xa2)]=NineStore;