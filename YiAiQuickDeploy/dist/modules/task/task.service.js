'use strict';const _0x533ae7=_0x2c3b;function _0x1cea(){const _0x4dc09b=['function','update','./../globalConfig/globalConfig.service','ModelsService','length','Logger','debug','Injectable','1829016qTeOHa','2380JQdDgE','__metadata','Cron','design:type','object','handleCron','__param','../models/models.service','79875lTdbon','EVERY_HOUR','design:returntype','find','globalConfigService','then','Repository','965245SRAwdD','72sqnfXy','2275BTNwhn','__esModule','243047RkkTBW','metadata','prototype','checkUserMemerExpire','decorate','TaskService','getWechatAccessToken','modelsService','1525836UpssEW','19755760EWdMYr','@nestjs/schedule','会员已到期、清空所有余额并移除会员身份！','design:paramtypes','defineProperty','70PPTGAi','@nestjs/typeorm','userBalanceEntity'];_0x1cea=function(){return _0x4dc09b;};return _0x1cea();}(function(_0x9a0df6,_0x474afe){const _0x597915=_0x2c3b,_0x2121db=_0x9a0df6();while(!![]){try{const _0x1aaca3=-parseInt(_0x597915(0x1d1))/0x1+-parseInt(_0x597915(0x1e3))/0x2*(parseInt(_0x597915(0x1f7))/0x3)+parseInt(_0x597915(0x1ef))/0x4*(parseInt(_0x597915(0x1d3))/0x5)+parseInt(_0x597915(0x1dd))/0x6+-parseInt(_0x597915(0x1d5))/0x7*(parseInt(_0x597915(0x1d2))/0x8)+parseInt(_0x597915(0x1ee))/0x9+parseInt(_0x597915(0x1de))/0xa;if(_0x1aaca3===_0x474afe)break;else _0x2121db['push'](_0x2121db['shift']());}catch(_0x1b21f9){_0x2121db['push'](_0x2121db['shift']());}}}(_0x1cea,0x78a8e));var __decorate=this&&this['__decorate']||function(_0x55f2c4,_0x2b6b33,_0x2f7856,_0x5aa7a9){const _0x3434ed=_0x2c3b;var _0x376e03=arguments[_0x3434ed(0x1ea)],_0x34dad9=_0x376e03<0x3?_0x2b6b33:_0x5aa7a9===null?_0x5aa7a9=Object['getOwnPropertyDescriptor'](_0x2b6b33,_0x2f7856):_0x5aa7a9,_0x348097;if(typeof Reflect===_0x3434ed(0x1f3)&&typeof Reflect[_0x3434ed(0x1d9)]===_0x3434ed(0x1e6))_0x34dad9=Reflect[_0x3434ed(0x1d9)](_0x55f2c4,_0x2b6b33,_0x2f7856,_0x5aa7a9);else{for(var _0x3002fe=_0x55f2c4['length']-0x1;_0x3002fe>=0x0;_0x3002fe--)if(_0x348097=_0x55f2c4[_0x3002fe])_0x34dad9=(_0x376e03<0x3?_0x348097(_0x34dad9):_0x376e03>0x3?_0x348097(_0x2b6b33,_0x2f7856,_0x34dad9):_0x348097(_0x2b6b33,_0x2f7856))||_0x34dad9;}return _0x376e03>0x3&&_0x34dad9&&Object[_0x3434ed(0x1e2)](_0x2b6b33,_0x2f7856,_0x34dad9),_0x34dad9;},__metadata=this&&this[_0x533ae7(0x1f0)]||function(_0x48cfae,_0x33c4ed){const _0x4c8407=_0x533ae7;if(typeof Reflect===_0x4c8407(0x1f3)&&typeof Reflect[_0x4c8407(0x1d6)]===_0x4c8407(0x1e6))return Reflect[_0x4c8407(0x1d6)](_0x48cfae,_0x33c4ed);},__param=this&&this[_0x533ae7(0x1f5)]||function(_0x20a74d,_0x1f243c){return function(_0x391b33,_0x5c0566){_0x1f243c(_0x391b33,_0x5c0566,_0x20a74d);};};Object[_0x533ae7(0x1e2)](exports,_0x533ae7(0x1d4),{'value':!![]}),exports[_0x533ae7(0x1da)]=void 0x0;function _0x2c3b(_0x1650f4,_0x538559){const _0x1ceac4=_0x1cea();return _0x2c3b=function(_0x2c3b74,_0x194d6f){_0x2c3b74=_0x2c3b74-0x1cc;let _0x673728=_0x1ceac4[_0x2c3b74];return _0x673728;},_0x2c3b(_0x1650f4,_0x538559);}const globalConfig_service_1=require(_0x533ae7(0x1e8)),common_1=require('@nestjs/common'),schedule_1=require(_0x533ae7(0x1df)),userBalance_entity_1=require('../userBalance/userBalance.entity'),typeorm_1=require(_0x533ae7(0x1e4)),typeorm_2=require('typeorm'),models_service_1=require(_0x533ae7(0x1f6));let TaskService=class TaskService{constructor(_0x2b6ef1,_0x3fda3a,_0x4e35f0){const _0x46e7bc=_0x533ae7;this[_0x46e7bc(0x1e5)]=_0x2b6ef1,this[_0x46e7bc(0x1ce)]=_0x3fda3a,this[_0x46e7bc(0x1dc)]=_0x4e35f0;}[_0x533ae7(0x1f4)](){const _0x4ddd5c=_0x533ae7;common_1[_0x4ddd5c(0x1eb)][_0x4ddd5c(0x1ec)]('Automatically\x20refresh\x20WeChat\x20access\x20every\x20hour\x20Token',_0x4ddd5c(0x1da)),this[_0x4ddd5c(0x1ce)][_0x4ddd5c(0x1db)]();}async['checkUserMemerExpire'](){const _0x598522=_0x533ae7,_0x3616e0=await this[_0x598522(0x1e5)][_0x598522(0x1cd)]({'where':{'expirationTime':(0x0,typeorm_2['LessThanOrEqual'])(new Date())}});if(!_0x3616e0||!_0x3616e0[_0x598522(0x1ea)])return;_0x3616e0['forEach'](_0x36b659=>{const _0x29b0fe=_0x598522;this[_0x29b0fe(0x1e5)][_0x29b0fe(0x1e7)]({'id':_0x36b659['id']},{'expirationTime':null,'packageId':0x0,'memberModel3Count':0x0,'memberModel4Count':0x0,'memberDrawMjCount':0x0})[_0x29b0fe(0x1cf)](_0x4e2a3f=>{const _0x5ec8fe=_0x29b0fe;common_1[_0x5ec8fe(0x1eb)][_0x5ec8fe(0x1ec)](_0x36b659['id']+_0x5ec8fe(0x1e0),_0x5ec8fe(0x1da));});});}};__decorate([(0x0,schedule_1[_0x533ae7(0x1f1)])(schedule_1['CronExpression'][_0x533ae7(0x1f8)]),__metadata(_0x533ae7(0x1f2),Function),__metadata(_0x533ae7(0x1e1),[]),__metadata('design:returntype',void 0x0)],TaskService[_0x533ae7(0x1d7)],_0x533ae7(0x1f4),null),__decorate([(0x0,schedule_1['Cron'])(schedule_1['CronExpression']['EVERY_5_MINUTES']),__metadata(_0x533ae7(0x1f2),Function),__metadata(_0x533ae7(0x1e1),[]),__metadata(_0x533ae7(0x1cc),Promise)],TaskService[_0x533ae7(0x1d7)],_0x533ae7(0x1d8),null),TaskService=__decorate([(0x0,common_1[_0x533ae7(0x1ed)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(userBalance_entity_1['UserBalanceEntity'])),__metadata(_0x533ae7(0x1e1),[typeorm_2[_0x533ae7(0x1d0)],globalConfig_service_1['GlobalConfigService'],models_service_1[_0x533ae7(0x1e9)]])],TaskService),exports[_0x533ae7(0x1da)]=TaskService;