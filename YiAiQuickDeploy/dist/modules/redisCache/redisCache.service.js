'use strict';const _0x48e4da=_0x42b2;function _0x42b2(_0x13efc6,_0x6140ce){const _0x57b186=_0x57b1();return _0x42b2=function(_0x42b25c,_0x5010bf){_0x42b25c=_0x42b25c-0x133;let _0x4716eb=_0x57b186[_0x42b25c];return _0x4716eb;},_0x42b2(_0x13efc6,_0x6140ce);}(function(_0x2a5275,_0xccee9){const _0x3e5b41=_0x42b2,_0x3f58e8=_0x2a5275();while(!![]){try{const _0x27ae8a=parseInt(_0x3e5b41(0x137))/0x1*(-parseInt(_0x3e5b41(0x157))/0x2)+-parseInt(_0x3e5b41(0x141))/0x3*(-parseInt(_0x3e5b41(0x13d))/0x4)+-parseInt(_0x3e5b41(0x139))/0x5+parseInt(_0x3e5b41(0x134))/0x6+-parseInt(_0x3e5b41(0x149))/0x7*(-parseInt(_0x3e5b41(0x158))/0x8)+parseInt(_0x3e5b41(0x148))/0x9+-parseInt(_0x3e5b41(0x15d))/0xa;if(_0x27ae8a===_0xccee9)break;else _0x3f58e8['push'](_0x3f58e8['shift']());}catch(_0x15dfd2){_0x3f58e8['push'](_0x3f58e8['shift']());}}}(_0x57b1,0x5dcc9));function _0x57b1(){const _0x4205c5=['tokens:','__param','733932qSRvIh','function','Injectable','94865hvNHTK','defineProperty','2066440CnHuGz','set','RedisCacheService','invalidateTokens','727696JKsTpz','test','token:','@nestjs/common','9hqHprg','decorate','design:paramtypes','visitor','length','get','object','2148750NDFeYn','14eAMtgl','super','Inject','您已在其他设备覆盖登录、请您重新登录！','__decorate','user','onModuleInit','HttpStatus','redisClient','forEach','metadata','__metadata','ttl','REDIS_CLIENT','2AHtDww','2538208byNHvE','del','__esModule','aaa','HttpException','6490420VOZkqJ'];_0x57b1=function(){return _0x4205c5;};return _0x57b1();}var __decorate=this&&this[_0x48e4da(0x14d)]||function(_0x295765,_0x4fdb7e,_0x124580,_0x303f0f){const _0x2c8870=_0x48e4da;var _0x32e78c=arguments[_0x2c8870(0x145)],_0x49a801=_0x32e78c<0x3?_0x4fdb7e:_0x303f0f===null?_0x303f0f=Object['getOwnPropertyDescriptor'](_0x4fdb7e,_0x124580):_0x303f0f,_0x5b387e;if(typeof Reflect==='object'&&typeof Reflect[_0x2c8870(0x142)]===_0x2c8870(0x135))_0x49a801=Reflect['decorate'](_0x295765,_0x4fdb7e,_0x124580,_0x303f0f);else{for(var _0x4559be=_0x295765['length']-0x1;_0x4559be>=0x0;_0x4559be--)if(_0x5b387e=_0x295765[_0x4559be])_0x49a801=(_0x32e78c<0x3?_0x5b387e(_0x49a801):_0x32e78c>0x3?_0x5b387e(_0x4fdb7e,_0x124580,_0x49a801):_0x5b387e(_0x4fdb7e,_0x124580))||_0x49a801;}return _0x32e78c>0x3&&_0x49a801&&Object['defineProperty'](_0x4fdb7e,_0x124580,_0x49a801),_0x49a801;},__metadata=this&&this[_0x48e4da(0x154)]||function(_0x363b94,_0x424a4c){const _0x160a20=_0x48e4da;if(typeof Reflect===_0x160a20(0x147)&&typeof Reflect[_0x160a20(0x153)]===_0x160a20(0x135))return Reflect[_0x160a20(0x153)](_0x363b94,_0x424a4c);},__param=this&&this[_0x48e4da(0x133)]||function(_0x3bcf3f,_0x5b8571){return function(_0x347789,_0x403aab){_0x5b8571(_0x347789,_0x403aab,_0x3bcf3f);};};Object[_0x48e4da(0x138)](exports,_0x48e4da(0x15a),{'value':!![]}),exports[_0x48e4da(0x13b)]=void 0x0;const common_1=require(_0x48e4da(0x140));let RedisCacheService=class RedisCacheService{constructor(_0x2858dc){const _0x55de1d=_0x48e4da;this[_0x55de1d(0x151)]=_0x2858dc;}async[_0x48e4da(0x14f)](){}[_0x48e4da(0x13e)](){const _0x126486=_0x48e4da;return this[_0x126486(0x151)][_0x126486(0x13a)](_0x126486(0x15b),0x6f),0x1;}async['get'](_0x54f64c){const _0x34b577=_0x48e4da,{key:_0x3383c2}=_0x54f64c,_0x538e1b=await this['redisClient'][_0x34b577(0x146)](_0x3383c2);return await this[_0x34b577(0x151)][_0x34b577(0x146)](_0x3383c2);}async[_0x48e4da(0x13a)](_0x5dfa66,_0x2a0677){const _0x245837=_0x48e4da;try{const {key:_0x3ac51f,val:_0x1e2264}=_0x5dfa66;await this['redisClient'][_0x245837(0x13a)](_0x3ac51f,_0x1e2264),_0x2a0677&&await this[_0x245837(0x151)]['expire'](_0x3ac51f,_0x2a0677);return;}catch(_0x227b86){throw new common_1[(_0x245837(0x15c))](_0x227b86,common_1[_0x245837(0x150)]['BAD_REQUEST']);}}async[_0x48e4da(0x155)](_0x3e9821){const _0x4ed1c7=_0x48e4da;return await this[_0x4ed1c7(0x151)]['ttl'](_0x3e9821);}async['del'](_0x243c37){const _0x411460=_0x48e4da,{key:_0x26f8ff}=_0x243c37;await this[_0x411460(0x151)][_0x411460(0x159)](_0x26f8ff);return;}async['saveToken'](_0x2d48dd,_0x39c433){const _0x3b2d11=_0x48e4da,_0x216d5a=await this[_0x3b2d11(0x151)]['zRange'](_0x3b2d11(0x15e)+_0x2d48dd,0x0,-0x1);await this[_0x3b2d11(0x13c)](_0x2d48dd,_0x216d5a),this['redisClient'][_0x3b2d11(0x13a)](_0x3b2d11(0x13f)+_0x2d48dd,_0x39c433);}async[_0x48e4da(0x13c)](_0x8cfb62,_0x56ec20){const _0x124471=_0x48e4da;_0x56ec20[_0x124471(0x152)](_0x2940ef=>{const _0x2b6a99=_0x124471;this[_0x2b6a99(0x151)][_0x2b6a99(0x159)](_0x2b6a99(0x13f)+_0x8cfb62+':'+_0x2940ef);});}async['checkTokenAuth'](_0x189b3e,_0x48562a){const _0x2e5ea2=_0x48e4da,{id:_0x31a320,role:_0x14bfda}=_0x48562a[_0x2e5ea2(0x14e)];if(_0x14bfda===_0x2e5ea2(0x144))return!![];const _0x487173=await this[_0x2e5ea2(0x151)][_0x2e5ea2(0x146)](_0x2e5ea2(0x13f)+_0x31a320);if(_0x487173===null)return await this[_0x2e5ea2(0x151)][_0x2e5ea2(0x13a)](_0x2e5ea2(0x13f)+_0x31a320,_0x189b3e),!![];if(_0x487173!==_0x189b3e){if([_0x2e5ea2(0x14a),'admin']['includes'](_0x14bfda))return!![];throw new common_1['HttpException'](_0x2e5ea2(0x14c),common_1[_0x2e5ea2(0x150)]['UNAUTHORIZED']);}}};RedisCacheService=__decorate([(0x0,common_1[_0x48e4da(0x136)])(),__param(0x0,(0x0,common_1[_0x48e4da(0x14b)])(_0x48e4da(0x156))),__metadata(_0x48e4da(0x143),[Object])],RedisCacheService),exports[_0x48e4da(0x13b)]=RedisCacheService;