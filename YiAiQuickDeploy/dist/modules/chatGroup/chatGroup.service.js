'use strict';const _0x125f46=_0x3de0;function _0x3de0(_0xc71445,_0x152f8e){const _0x54a8ce=_0x54a8();return _0x3de0=function(_0x3de0b8,_0x446d8c){_0x3de0b8=_0x3de0b8-0xc8;let _0x4b2801=_0x54a8ce[_0x3de0b8];return _0x4b2801;},_0x3de0(_0xc71445,_0x152f8e);}(function(_0x433427,_0x426721){const _0x276577=_0x3de0,_0x4daf54=_0x433427();while(!![]){try{const _0x826a6b=parseInt(_0x276577(0xdd))/0x1+parseInt(_0x276577(0xf9))/0x2+-parseInt(_0x276577(0xfe))/0x3*(-parseInt(_0x276577(0xeb))/0x4)+parseInt(_0x276577(0xd2))/0x5*(-parseInt(_0x276577(0xf3))/0x6)+-parseInt(_0x276577(0xda))/0x7+parseInt(_0x276577(0xd5))/0x8+-parseInt(_0x276577(0xf5))/0x9*(parseInt(_0x276577(0xce))/0xa);if(_0x826a6b===_0x426721)break;else _0x4daf54['push'](_0x4daf54['shift']());}catch(_0x5941cf){_0x4daf54['push'](_0x4daf54['shift']());}}}(_0x54a8,0x1afae));var __decorate=this&&this[_0x125f46(0x105)]||function(_0x37a58b,_0x33f249,_0x265a99,_0x56067d){const _0x2b338e=_0x125f46;var _0x907f0e=arguments[_0x2b338e(0xc9)],_0x3ff529=_0x907f0e<0x3?_0x33f249:_0x56067d===null?_0x56067d=Object[_0x2b338e(0xe5)](_0x33f249,_0x265a99):_0x56067d,_0x438742;if(typeof Reflect===_0x2b338e(0xf1)&&typeof Reflect[_0x2b338e(0xd9)]==='function')_0x3ff529=Reflect[_0x2b338e(0xd9)](_0x37a58b,_0x33f249,_0x265a99,_0x56067d);else{for(var _0x4230e2=_0x37a58b[_0x2b338e(0xc9)]-0x1;_0x4230e2>=0x0;_0x4230e2--)if(_0x438742=_0x37a58b[_0x4230e2])_0x3ff529=(_0x907f0e<0x3?_0x438742(_0x3ff529):_0x907f0e>0x3?_0x438742(_0x33f249,_0x265a99,_0x3ff529):_0x438742(_0x33f249,_0x265a99))||_0x3ff529;}return _0x907f0e>0x3&&_0x3ff529&&Object['defineProperty'](_0x33f249,_0x265a99,_0x3ff529),_0x3ff529;},__metadata=this&&this[_0x125f46(0x108)]||function(_0x47c88a,_0x1f8673){const _0x265329=_0x125f46;if(typeof Reflect===_0x265329(0xf1)&&typeof Reflect[_0x265329(0xca)]===_0x265329(0xdb))return Reflect[_0x265329(0xca)](_0x47c88a,_0x1f8673);},__param=this&&this[_0x125f46(0xe3)]||function(_0x2afd45,_0x35b643){return function(_0x47eedc,_0x18384a){_0x35b643(_0x47eedc,_0x18384a,_0x2afd45);};};Object[_0x125f46(0xdf)](exports,_0x125f46(0xe6),{'value':!![]}),exports[_0x125f46(0xfc)]=void 0x0;const common_1=require(_0x125f46(0xee)),chatGroup_entity_1=require(_0x125f46(0xd7)),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require(_0x125f46(0xe8)),app_entity_1=require(_0x125f46(0xf2)),models_service_1=require(_0x125f46(0xcc));function _0x54a8(){const _0xa14eca=['4722SZKoTw','appId','616419YxWciR','删除成功','AppEntity','getBaseConfig','77324KNiFdx','create','title','ChatGroupService','新对话','32868njMXzP','user','InjectRepository','keyType','请先选择一个对话或者新加一个对话再操作！','appEntity','appLogo','__decorate','BAD_REQUEST','非法操作、您在使用一个不存在的应用！','__metadata','delAll','length','metadata','stringify','../models/models.service','modelsService','10WkeyHN','非法操作、您在删除一个非法资源！','HttpException','Injectable','325eqsGPW','HttpStatus','config','1502408mHIxpP','query','./chatGroup.entity','非法操作、您在使用一个未启用的应用！','decorate','132650nBRUPn','function','affected','731psiSks','chatGroupEntity','defineProperty','design:paramtypes','update','Repository','__param','map','getOwnPropertyDescriptor','__esModule','parse','typeorm','isSticky','DESC','8ltDYgw','log','save','@nestjs/common','findOne','find','object','../app/app.entity'];_0x54a8=function(){return _0xa14eca;};return _0x54a8();}let ChatGroupService=class ChatGroupService{constructor(_0xb02a27,_0x50d5f8,_0x3a564b){const _0x36eead=_0x125f46;this[_0x36eead(0xde)]=_0xb02a27,this[_0x36eead(0x103)]=_0x50d5f8,this[_0x36eead(0xcd)]=_0x3a564b;}async[_0x125f46(0xfa)](_0x5a5132,_0x45c464){const _0x14605c=_0x125f46,{id:_0x4020f2}=_0x45c464[_0x14605c(0xff)],{appId:_0x52f1f9}=_0x5a5132,_0x537054={'title':_0x14605c(0xfd),'userId':_0x4020f2};if(_0x52f1f9){const _0x44e938=await this[_0x14605c(0x103)][_0x14605c(0xef)]({'where':{'id':_0x52f1f9}});if(!_0x44e938)throw new common_1[(_0x14605c(0xd0))](_0x14605c(0x107),common_1['HttpStatus'][_0x14605c(0x106)]);else{const {status:_0x2bccc1,name:_0x2b675b}=_0x44e938,_0x26b441=await this['chatGroupEntity']['count']({'where':{'userId':_0x4020f2,'appId':_0x52f1f9,'isDelete':![]}});if(_0x26b441>0x0)throw new common_1[(_0x14605c(0xd0))]('当前应用已经开启了一个对话无需新建了！',common_1['HttpStatus'][_0x14605c(0x106)]);if(![0x1,0x3,0x4,0x5]['includes'](_0x2bccc1))throw new common_1['HttpException'](_0x14605c(0xd8),common_1[_0x14605c(0xd3)]['BAD_REQUEST']);_0x2b675b&&(_0x537054[_0x14605c(0xfb)]=_0x2b675b),_0x52f1f9&&(_0x537054['appId']=_0x52f1f9);}}const _0x27015d=await this[_0x14605c(0xcd)][_0x14605c(0xf8)](_0x52f1f9);_0x52f1f9&&(_0x27015d[_0x14605c(0xf4)]=_0x52f1f9);if(!_0x27015d)throw new common_1[(_0x14605c(0xd0))]('管理员未配置任何AI模型、请先联系管理员开通聊天模型配置！',common_1[_0x14605c(0xd3)][_0x14605c(0x106)]);return await this[_0x14605c(0xde)][_0x14605c(0xed)](Object['assign'](Object['assign']({},_0x537054),{'config':JSON[_0x14605c(0xcb)](_0x27015d)}));}async[_0x125f46(0xd6)](_0x579e81){const _0x3c577f=_0x125f46;try{const {id:_0x557d57}=_0x579e81[_0x3c577f(0xff)],_0x1280dc={'userId':_0x557d57,'isDelete':![]},_0x26cb58=await this[_0x3c577f(0xde)][_0x3c577f(0xf0)]({'where':_0x1280dc,'order':{'isSticky':_0x3c577f(0xea),'id':_0x3c577f(0xea)}}),_0x4f7c3b=_0x26cb58['filter'](_0x4b8b70=>_0x4b8b70['appId'])[_0x3c577f(0xe4)](_0x2e06e0=>_0x2e06e0[_0x3c577f(0xf4)]),_0xffd10a=await this[_0x3c577f(0x103)]['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x4f7c3b)}});return _0x26cb58[_0x3c577f(0xe4)](_0x2a419d=>{const _0x546fab=_0x3c577f;var _0x2c4604;return _0x2a419d[_0x546fab(0x104)]=(_0x2c4604=_0xffd10a[_0x546fab(0xf0)](_0x255243=>_0x255243['id']===_0x2a419d['appId']))===null||_0x2c4604===void 0x0?void 0x0:_0x2c4604['coverImg'],_0x2a419d;});}catch(_0x5305fd){console[_0x3c577f(0xec)]('error:\x20',_0x5305fd);}}async[_0x125f46(0xe1)](_0x555c82,_0x27ebea){const _0x571ecc=_0x125f46,{title:_0x10baca,isSticky:_0x2f09a0,groupId:_0x3436d0,config:_0x16a423}=_0x555c82,{id:_0x4e3cdb}=_0x27ebea[_0x571ecc(0xff)],_0x40630f=await this['chatGroupEntity'][_0x571ecc(0xef)]({'where':{'id':_0x3436d0,'userId':_0x4e3cdb}});if(!_0x40630f)throw new common_1[(_0x571ecc(0xd0))](_0x571ecc(0x102),common_1[_0x571ecc(0xd3)][_0x571ecc(0x106)]);const {appId:_0x43ced5}=_0x40630f;if(_0x43ced5&&!_0x10baca)try{const _0x2ae872=JSON[_0x571ecc(0xe7)](_0x16a423);if(Number(_0x2ae872[_0x571ecc(0x101)])!==0x1)throw new common_1['HttpException']('应用对话名称不能修改哟！',common_1[_0x571ecc(0xd3)][_0x571ecc(0x106)]);}catch(_0x153a24){}const _0x4c59b1={};_0x10baca&&(_0x4c59b1['title']=_0x10baca),typeof _0x2f09a0!=='undefined'&&(_0x4c59b1[_0x571ecc(0xe9)]=_0x2f09a0),_0x16a423&&(_0x4c59b1[_0x571ecc(0xd4)]=_0x16a423);const _0x129213=await this[_0x571ecc(0xde)][_0x571ecc(0xe1)]({'id':_0x3436d0},_0x4c59b1);if(_0x129213[_0x571ecc(0xdc)])return!![];else throw new common_1[(_0x571ecc(0xd0))]('更新对话失败！',common_1[_0x571ecc(0xd3)][_0x571ecc(0x106)]);}async['del'](_0x14b5ac,_0x30b2b4){const _0x3107bc=_0x125f46,{groupId:_0x12dd38}=_0x14b5ac,{id:_0x3c0077}=_0x30b2b4[_0x3107bc(0xff)],_0x4f9c04=await this[_0x3107bc(0xde)][_0x3107bc(0xef)]({'where':{'id':_0x12dd38,'userId':_0x3c0077}});if(!_0x4f9c04)throw new common_1['HttpException'](_0x3107bc(0xcf),common_1[_0x3107bc(0xd3)][_0x3107bc(0x106)]);const _0x2bf2fa=await this[_0x3107bc(0xde)]['update']({'id':_0x12dd38},{'isDelete':!![]});if(_0x2bf2fa['affected'])return _0x3107bc(0xf6);else throw new common_1['HttpException']('删除失败！',common_1[_0x3107bc(0xd3)][_0x3107bc(0x106)]);}async[_0x125f46(0xc8)](_0x5198eb){const _0x26dd5f=_0x125f46,{id:_0x27e8e3}=_0x5198eb['user'],_0x569999=await this[_0x26dd5f(0xde)][_0x26dd5f(0xe1)]({'userId':_0x27e8e3,'isSticky':![],'isDelete':![]},{'isDelete':!![]});if(_0x569999[_0x26dd5f(0xdc)])return _0x26dd5f(0xf6);else throw new common_1[(_0x26dd5f(0xd0))]('删除失败！',common_1[_0x26dd5f(0xd3)][_0x26dd5f(0x106)]);}async['getGroupInfoFromId'](_0xfa5b04){const _0x3780cd=_0x125f46;if(!_0xfa5b04)return;return await this[_0x3780cd(0xde)][_0x3780cd(0xef)]({'where':{'id':_0xfa5b04}});}};ChatGroupService=__decorate([(0x0,common_1[_0x125f46(0xd1)])(),__param(0x0,(0x0,typeorm_1[_0x125f46(0x100)])(chatGroup_entity_1['ChatGroupEntity'])),__param(0x1,(0x0,typeorm_1[_0x125f46(0x100)])(app_entity_1[_0x125f46(0xf7)])),__metadata(_0x125f46(0xe0),[typeorm_2[_0x125f46(0xe2)],typeorm_2[_0x125f46(0xe2)],models_service_1['ModelsService']])],ChatGroupService),exports[_0x125f46(0xfc)]=ChatGroupService;