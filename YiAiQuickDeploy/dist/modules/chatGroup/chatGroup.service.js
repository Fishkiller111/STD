'use strict';const _0x4d755c=_0x28c2;(function(_0xaba233,_0x3fbf7f){const _0x51d46f=_0x28c2,_0x4ca5dc=_0xaba233();while(!![]){try{const _0xc7c87f=parseInt(_0x51d46f(0xab))/0x1*(-parseInt(_0x51d46f(0x86))/0x2)+parseInt(_0x51d46f(0x78))/0x3*(-parseInt(_0x51d46f(0x91))/0x4)+parseInt(_0x51d46f(0xa1))/0x5*(-parseInt(_0x51d46f(0x7b))/0x6)+parseInt(_0x51d46f(0x9f))/0x7*(-parseInt(_0x51d46f(0x7d))/0x8)+-parseInt(_0x51d46f(0xa9))/0x9+parseInt(_0x51d46f(0xac))/0xa+parseInt(_0x51d46f(0xb4))/0xb;if(_0xc7c87f===_0x3fbf7f)break;else _0x4ca5dc['push'](_0x4ca5dc['shift']());}catch(_0x3fc36e){_0x4ca5dc['push'](_0x4ca5dc['shift']());}}}(_0x263e,0xd1692));function _0x28c2(_0x5a6fd0,_0x439d30){const _0x263eff=_0x263e();return _0x28c2=function(_0x28c2b6,_0x4a6c41){_0x28c2b6=_0x28c2b6-0x72;let _0x416143=_0x263eff[_0x28c2b6];return _0x416143;},_0x28c2(_0x5a6fd0,_0x439d30);}var __decorate=this&&this[_0x4d755c(0x9c)]||function(_0x3f1282,_0x2fd59c,_0x393872,_0x358e4a){const _0x3eb5cf=_0x4d755c;var _0x31e2ff=arguments[_0x3eb5cf(0xa5)],_0x192df3=_0x31e2ff<0x3?_0x2fd59c:_0x358e4a===null?_0x358e4a=Object[_0x3eb5cf(0x98)](_0x2fd59c,_0x393872):_0x358e4a,_0xd5a669;if(typeof Reflect===_0x3eb5cf(0xb3)&&typeof Reflect['decorate']===_0x3eb5cf(0x8e))_0x192df3=Reflect['decorate'](_0x3f1282,_0x2fd59c,_0x393872,_0x358e4a);else{for(var _0x65a010=_0x3f1282[_0x3eb5cf(0xa5)]-0x1;_0x65a010>=0x0;_0x65a010--)if(_0xd5a669=_0x3f1282[_0x65a010])_0x192df3=(_0x31e2ff<0x3?_0xd5a669(_0x192df3):_0x31e2ff>0x3?_0xd5a669(_0x2fd59c,_0x393872,_0x192df3):_0xd5a669(_0x2fd59c,_0x393872))||_0x192df3;}return _0x31e2ff>0x3&&_0x192df3&&Object[_0x3eb5cf(0x89)](_0x2fd59c,_0x393872,_0x192df3),_0x192df3;},__metadata=this&&this[_0x4d755c(0x83)]||function(_0x8cf0f0,_0x50a686){const _0x4d8cff=_0x4d755c;if(typeof Reflect==='object'&&typeof Reflect[_0x4d8cff(0x73)]===_0x4d8cff(0x8e))return Reflect[_0x4d8cff(0x73)](_0x8cf0f0,_0x50a686);},__param=this&&this[_0x4d755c(0x72)]||function(_0x46b62f,_0x54df50){return function(_0x584967,_0x8a090b){_0x54df50(_0x584967,_0x8a090b,_0x46b62f);};};Object['defineProperty'](exports,_0x4d755c(0xa8),{'value':!![]}),exports[_0x4d755c(0x7f)]=void 0x0;const common_1=require(_0x4d755c(0x7a)),chatGroup_entity_1=require('./chatGroup.entity'),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require(_0x4d755c(0x8c)),app_entity_1=require('../app/app.entity'),models_service_1=require(_0x4d755c(0x79));let ChatGroupService=class ChatGroupService{constructor(_0x3f601a,_0x2b7e19,_0xcf14f8){const _0x393852=_0x4d755c;this[_0x393852(0x9e)]=_0x3f601a,this[_0x393852(0x8b)]=_0x2b7e19,this[_0x393852(0xa4)]=_0xcf14f8;}async[_0x4d755c(0x82)](_0x25a8ea,_0x101314){const _0x29cdda=_0x4d755c,{id:_0x4b92bb}=_0x101314['user'],{appId:_0x444bc4}=_0x25a8ea,_0x2899d2={'title':_0x29cdda(0x9a),'userId':_0x4b92bb};if(_0x444bc4){const _0x22ca7c=await this[_0x29cdda(0x8b)]['findOne']({'where':{'id':_0x444bc4}});if(!_0x22ca7c)throw new common_1[(_0x29cdda(0xb1))](_0x29cdda(0x94),common_1[_0x29cdda(0x77)][_0x29cdda(0x85)]);else{const {status:_0xa787a4,name:_0x5b4e40}=_0x22ca7c,_0x477cef=await this[_0x29cdda(0x9e)][_0x29cdda(0xa7)]({'where':{'userId':_0x4b92bb,'appId':_0x444bc4,'isDelete':![]}});if(_0x477cef>0x0)throw new common_1[(_0x29cdda(0xb1))]('当前应用已经开启了一个对话无需新建了！',common_1['HttpStatus'][_0x29cdda(0x85)]);if(![0x1,0x3,0x4,0x5][_0x29cdda(0x74)](_0xa787a4))throw new common_1[(_0x29cdda(0xb1))](_0x29cdda(0x88),common_1[_0x29cdda(0x77)]['BAD_REQUEST']);_0x5b4e40&&(_0x2899d2[_0x29cdda(0x8d)]=_0x5b4e40),_0x444bc4&&(_0x2899d2['appId']=_0x444bc4);}}const _0x7ba05e=await this[_0x29cdda(0xa4)][_0x29cdda(0x8a)](_0x444bc4);_0x444bc4&&(_0x7ba05e[_0x29cdda(0x81)]=_0x444bc4);if(!_0x7ba05e)throw new common_1[(_0x29cdda(0xb1))]('管理员未配置任何AI模型、请先联系管理员开通聊天模型配置！',common_1[_0x29cdda(0x77)]['BAD_REQUEST']);return await this['chatGroupEntity'][_0x29cdda(0x8f)](Object['assign'](Object['assign']({},_0x2899d2),{'config':JSON[_0x29cdda(0x96)](_0x7ba05e)}));}async['query'](_0x5b1b34){const _0x1c5a96=_0x4d755c;try{const {id:_0x580514}=_0x5b1b34[_0x1c5a96(0x87)],_0x2fd600={'userId':_0x580514,'isDelete':![]},_0x130c65=await this['chatGroupEntity'][_0x1c5a96(0x93)]({'where':_0x2fd600,'order':{'isSticky':_0x1c5a96(0x9d),'id':_0x1c5a96(0x9d)}}),_0xa6e50c=_0x130c65['filter'](_0x114145=>_0x114145[_0x1c5a96(0x81)])['map'](_0x2e73a6=>_0x2e73a6[_0x1c5a96(0x81)]),_0x25f53f=await this['appEntity'][_0x1c5a96(0x93)]({'where':{'id':(0x0,typeorm_2['In'])(_0xa6e50c)}});return _0x130c65[_0x1c5a96(0xa3)](_0x25ffa3=>{const _0x34d6a8=_0x1c5a96;var _0x1b2418;return _0x25ffa3[_0x34d6a8(0x99)]=(_0x1b2418=_0x25f53f['find'](_0x58eeec=>_0x58eeec['id']===_0x25ffa3['appId']))===null||_0x1b2418===void 0x0?void 0x0:_0x1b2418[_0x34d6a8(0x97)],_0x25ffa3;});}catch(_0x2f1be4){console[_0x1c5a96(0x90)](_0x1c5a96(0xad),_0x2f1be4);}}async[_0x4d755c(0xb2)](_0x44ed88,_0x50b7bf){const _0x572059=_0x4d755c,{title:_0x4f2e23,isSticky:_0x5773be,groupId:_0x4c6919,config:_0x183a4e}=_0x44ed88,{id:_0xf66200}=_0x50b7bf[_0x572059(0x87)],_0x4e8a90=await this[_0x572059(0x9e)]['findOne']({'where':{'id':_0x4c6919,'userId':_0xf66200}});if(!_0x4e8a90)throw new common_1[(_0x572059(0xb1))]('请先选择一个对话或者新加一个对话再操作！',common_1[_0x572059(0x77)][_0x572059(0x85)]);const {appId:_0x14bf46}=_0x4e8a90;if(_0x14bf46&&!_0x4f2e23)try{const _0x426ba7=JSON['parse'](_0x183a4e);if(Number(_0x426ba7[_0x572059(0x76)])!==0x1)throw new common_1['HttpException']('应用对话名称不能修改哟！',common_1[_0x572059(0x77)]['BAD_REQUEST']);}catch(_0x4894f7){}const _0x43eb55={};_0x4f2e23&&(_0x43eb55[_0x572059(0x8d)]=_0x4f2e23),typeof _0x5773be!==_0x572059(0x84)&&(_0x43eb55[_0x572059(0xaa)]=_0x5773be),_0x183a4e&&(_0x43eb55[_0x572059(0x7c)]=_0x183a4e);const _0xc05d86=await this[_0x572059(0x9e)][_0x572059(0xb2)]({'id':_0x4c6919},_0x43eb55);if(_0xc05d86[_0x572059(0x75)])return!![];else throw new common_1[(_0x572059(0xb1))]('更新对话失败！',common_1[_0x572059(0x77)][_0x572059(0x85)]);}async[_0x4d755c(0xae)](_0x33dca2,_0x8a043){const _0xc305e3=_0x4d755c,{groupId:_0x57629e}=_0x33dca2,{id:_0x337403}=_0x8a043['user'],_0xd1977f=await this[_0xc305e3(0x9e)][_0xc305e3(0xa2)]({'where':{'id':_0x57629e,'userId':_0x337403}});if(!_0xd1977f)throw new common_1[(_0xc305e3(0xb1))](_0xc305e3(0x7e),common_1['HttpStatus'][_0xc305e3(0x85)]);const _0x3599fb=await this['chatGroupEntity'][_0xc305e3(0xb2)]({'id':_0x57629e},{'isDelete':!![]});if(_0x3599fb['affected'])return _0xc305e3(0x80);else throw new common_1[(_0xc305e3(0xb1))]('删除失败！',common_1[_0xc305e3(0x77)][_0xc305e3(0x85)]);}async['delAll'](_0x3e506a){const _0x4f12c7=_0x4d755c,{id:_0x550a29}=_0x3e506a['user'],_0xafbf4f=await this[_0x4f12c7(0x9e)][_0x4f12c7(0xb2)]({'userId':_0x550a29,'isSticky':![],'isDelete':![]},{'isDelete':!![]});if(_0xafbf4f['affected'])return _0x4f12c7(0x80);else throw new common_1[(_0x4f12c7(0xb1))](_0x4f12c7(0xaf),common_1[_0x4f12c7(0x77)][_0x4f12c7(0x85)]);}async['getGroupInfoFromId'](_0x7d64e4){const _0x9ee08b=_0x4d755c;if(!_0x7d64e4)return;return await this[_0x9ee08b(0x9e)][_0x9ee08b(0xa2)]({'where':{'id':_0x7d64e4}});}};ChatGroupService=__decorate([(0x0,common_1[_0x4d755c(0xb0)])(),__param(0x0,(0x0,typeorm_1[_0x4d755c(0x95)])(chatGroup_entity_1[_0x4d755c(0x92)])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(app_entity_1[_0x4d755c(0xa0)])),__metadata('design:paramtypes',[typeorm_2[_0x4d755c(0x9b)],typeorm_2[_0x4d755c(0x9b)],models_service_1[_0x4d755c(0xa6)]])],ChatGroupService),exports[_0x4d755c(0x7f)]=ChatGroupService;function _0x263e(){const _0x253ad6=['config','320312UZhZZM','非法操作、您在删除一个非法资源！','ChatGroupService','删除成功','appId','create','__metadata','undefined','BAD_REQUEST','2FBftiq','user','非法操作、您在使用一个未启用的应用！','defineProperty','getBaseConfig','appEntity','typeorm','title','function','save','log','93668rBdsWB','ChatGroupEntity','find','非法操作、您在使用一个不存在的应用！','InjectRepository','stringify','coverImg','getOwnPropertyDescriptor','appLogo','新对话','Repository','__decorate','DESC','chatGroupEntity','287MfskZF','AppEntity','870AYMbXv','findOne','map','modelsService','length','ModelsService','count','__esModule','9303507opHQnN','isSticky','224122xwsBuN','14870270MQcWdA','error:\x20','del','删除失败！','Injectable','HttpException','update','object','44317570celzxt','__param','metadata','includes','affected','keyType','HttpStatus','75ChQqDs','../models/models.service','@nestjs/common','40458FRZYVV'];_0x263e=function(){return _0x253ad6;};return _0x263e();}