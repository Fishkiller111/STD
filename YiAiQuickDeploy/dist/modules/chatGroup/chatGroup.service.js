'use strict';function _0x5d88(){const _0x3e38d4=['管理员未配置任何AI模型、请先联系管理员开通聊天模型配置！','parse','__param','InjectRepository','create','appId','design:paramtypes','affected','请先选择一个对话或者新加一个对话再操作！','findOne','Repository','./chatGroup.entity','../models/models.service','1366495yipeqN','delAll','title','isSticky','save','17571680vySrHv','非法操作、您在删除一个非法资源！','map','Injectable','新对话','undefined','appLogo','475596HsQwST','keyType','update','10960qnjDNq','7vczZYX','5796040Nbzsme','__decorate','更新对话失败！','3266706wSQxqO','ChatGroupEntity','ChatGroupService','defineProperty','user','log','count','decorate','4eTKmkU','typeorm','HttpException','@nestjs/typeorm','find','应用对话名称不能修改哟！','object','del','chatGroupEntity','appEntity','length','stringify','assign','8293500SEcpLh','DESC','includes','86xqcDih','删除失败！','config','filter','BAD_REQUEST','删除成功','HttpStatus','__metadata','getBaseConfig','function','getGroupInfoFromId','query','metadata','getOwnPropertyDescriptor','当前应用已经开启了一个对话无需新建了！','modelsService','__esModule','../app/app.entity'];_0x5d88=function(){return _0x3e38d4;};return _0x5d88();}const _0x8b550=_0x3af4;function _0x3af4(_0x14251,_0x15295f){const _0x5d8875=_0x5d88();return _0x3af4=function(_0x3af418,_0x5aea8a){_0x3af418=_0x3af418-0x122;let _0x59c29d=_0x5d8875[_0x3af418];return _0x59c29d;},_0x3af4(_0x14251,_0x15295f);}(function(_0x264cae,_0x1ce2ba){const _0x10baaf=_0x3af4,_0x2a3387=_0x264cae();while(!![]){try{const _0x342358=-parseInt(_0x10baaf(0x13e))/0x1*(-parseInt(_0x10baaf(0x15b))/0x2)+-parseInt(_0x10baaf(0x13b))/0x3+parseInt(_0x10baaf(0x14b))/0x4*(-parseInt(_0x10baaf(0x12f))/0x5)+parseInt(_0x10baaf(0x143))/0x6*(parseInt(_0x10baaf(0x13f))/0x7)+parseInt(_0x10baaf(0x140))/0x8+parseInt(_0x10baaf(0x158))/0x9+-parseInt(_0x10baaf(0x134))/0xa;if(_0x342358===_0x1ce2ba)break;else _0x2a3387['push'](_0x2a3387['shift']());}catch(_0x43994e){_0x2a3387['push'](_0x2a3387['shift']());}}}(_0x5d88,0x736a1));var __decorate=this&&this[_0x8b550(0x141)]||function(_0x31ec89,_0x16bf0c,_0x562467,_0x594fcc){const _0x5142d8=_0x8b550;var _0x445739=arguments[_0x5142d8(0x155)],_0x188d14=_0x445739<0x3?_0x16bf0c:_0x594fcc===null?_0x594fcc=Object[_0x5142d8(0x168)](_0x16bf0c,_0x562467):_0x594fcc,_0x36dfc9;if(typeof Reflect==='object'&&typeof Reflect[_0x5142d8(0x14a)]===_0x5142d8(0x164))_0x188d14=Reflect['decorate'](_0x31ec89,_0x16bf0c,_0x562467,_0x594fcc);else{for(var _0x2a88d9=_0x31ec89['length']-0x1;_0x2a88d9>=0x0;_0x2a88d9--)if(_0x36dfc9=_0x31ec89[_0x2a88d9])_0x188d14=(_0x445739<0x3?_0x36dfc9(_0x188d14):_0x445739>0x3?_0x36dfc9(_0x16bf0c,_0x562467,_0x188d14):_0x36dfc9(_0x16bf0c,_0x562467))||_0x188d14;}return _0x445739>0x3&&_0x188d14&&Object['defineProperty'](_0x16bf0c,_0x562467,_0x188d14),_0x188d14;},__metadata=this&&this[_0x8b550(0x162)]||function(_0x13eb12,_0x9eb7e2){const _0x5cf1df=_0x8b550;if(typeof Reflect===_0x5cf1df(0x151)&&typeof Reflect[_0x5cf1df(0x167)]==='function')return Reflect[_0x5cf1df(0x167)](_0x13eb12,_0x9eb7e2);},__param=this&&this[_0x8b550(0x124)]||function(_0x49ee29,_0x55427e){return function(_0x1b8898,_0x2ef1f3){_0x55427e(_0x1b8898,_0x2ef1f3,_0x49ee29);};};Object[_0x8b550(0x146)](exports,_0x8b550(0x16b),{'value':!![]}),exports[_0x8b550(0x145)]=void 0x0;const common_1=require('@nestjs/common'),chatGroup_entity_1=require(_0x8b550(0x12d)),typeorm_1=require(_0x8b550(0x14e)),typeorm_2=require(_0x8b550(0x14c)),app_entity_1=require(_0x8b550(0x16c)),models_service_1=require(_0x8b550(0x12e));let ChatGroupService=class ChatGroupService{constructor(_0xc1a5cd,_0xd0b241,_0x3aeafb){const _0x108826=_0x8b550;this[_0x108826(0x153)]=_0xc1a5cd,this[_0x108826(0x154)]=_0xd0b241,this['modelsService']=_0x3aeafb;}async[_0x8b550(0x126)](_0x338896,_0xed7a03){const _0x4f9502=_0x8b550,{id:_0x3dab20}=_0xed7a03['user'],{appId:_0x1f3871}=_0x338896,_0xfdca65={'title':_0x4f9502(0x138),'userId':_0x3dab20};if(_0x1f3871){const _0x591f86=await this[_0x4f9502(0x154)][_0x4f9502(0x12b)]({'where':{'id':_0x1f3871}});if(!_0x591f86)throw new common_1[(_0x4f9502(0x14d))]('非法操作、您在使用一个不存在的应用！',common_1['HttpStatus']['BAD_REQUEST']);else{const {status:_0x2fd0f3,name:_0x376434}=_0x591f86,_0x3b1fca=await this[_0x4f9502(0x153)][_0x4f9502(0x149)]({'where':{'userId':_0x3dab20,'appId':_0x1f3871,'isDelete':![]}});if(_0x3b1fca>0x0)throw new common_1['HttpException'](_0x4f9502(0x169),common_1['HttpStatus']['BAD_REQUEST']);if(![0x1,0x3,0x4,0x5][_0x4f9502(0x15a)](_0x2fd0f3))throw new common_1[(_0x4f9502(0x14d))]('非法操作、您在使用一个未启用的应用！',common_1[_0x4f9502(0x161)][_0x4f9502(0x15f)]);_0x376434&&(_0xfdca65[_0x4f9502(0x131)]=_0x376434),_0x1f3871&&(_0xfdca65[_0x4f9502(0x127)]=_0x1f3871);}}const _0x4faf32=await this[_0x4f9502(0x16a)][_0x4f9502(0x163)](_0x1f3871);_0x1f3871&&(_0x4faf32['appId']=_0x1f3871);if(!_0x4faf32)throw new common_1['HttpException'](_0x4f9502(0x122),common_1['HttpStatus'][_0x4f9502(0x15f)]);return await this[_0x4f9502(0x153)][_0x4f9502(0x133)](Object[_0x4f9502(0x157)](Object[_0x4f9502(0x157)]({},_0xfdca65),{'config':JSON[_0x4f9502(0x156)](_0x4faf32)}));}async[_0x8b550(0x166)](_0xaf9ddd){const _0x49bb7c=_0x8b550;try{const {id:_0x4f1aad}=_0xaf9ddd['user'],_0x3193e6={'userId':_0x4f1aad,'isDelete':![]},_0xdfc54e=await this[_0x49bb7c(0x153)][_0x49bb7c(0x14f)]({'where':_0x3193e6,'order':{'isSticky':_0x49bb7c(0x159),'id':'DESC'}}),_0x4d82a3=_0xdfc54e[_0x49bb7c(0x15e)](_0x58c043=>_0x58c043[_0x49bb7c(0x127)])[_0x49bb7c(0x136)](_0x35c361=>_0x35c361['appId']),_0x1546a7=await this[_0x49bb7c(0x154)]['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x4d82a3)}});return _0xdfc54e[_0x49bb7c(0x136)](_0x1aa23d=>{const _0x5f2390=_0x49bb7c;var _0x269013;return _0x1aa23d[_0x5f2390(0x13a)]=(_0x269013=_0x1546a7[_0x5f2390(0x14f)](_0x2321fd=>_0x2321fd['id']===_0x1aa23d[_0x5f2390(0x127)]))===null||_0x269013===void 0x0?void 0x0:_0x269013['coverImg'],_0x1aa23d;});}catch(_0x46b4a6){console[_0x49bb7c(0x148)]('error:\x20',_0x46b4a6);}}async[_0x8b550(0x13d)](_0x40102c,_0x4e080f){const _0x57f07f=_0x8b550,{title:_0x331537,isSticky:_0x47314c,groupId:_0x5654ca,config:_0x35ebd7}=_0x40102c,{id:_0x4b2ce0}=_0x4e080f[_0x57f07f(0x147)],_0x46641a=await this[_0x57f07f(0x153)][_0x57f07f(0x12b)]({'where':{'id':_0x5654ca,'userId':_0x4b2ce0}});if(!_0x46641a)throw new common_1['HttpException'](_0x57f07f(0x12a),common_1[_0x57f07f(0x161)][_0x57f07f(0x15f)]);const {appId:_0x9b933}=_0x46641a;if(_0x9b933&&!_0x331537)try{const _0xeba3b3=JSON[_0x57f07f(0x123)](_0x35ebd7);if(Number(_0xeba3b3[_0x57f07f(0x13c)])!==0x1)throw new common_1['HttpException'](_0x57f07f(0x150),common_1[_0x57f07f(0x161)]['BAD_REQUEST']);}catch(_0x4ca336){}const _0x424811={};_0x331537&&(_0x424811[_0x57f07f(0x131)]=_0x331537),typeof _0x47314c!==_0x57f07f(0x139)&&(_0x424811[_0x57f07f(0x132)]=_0x47314c),_0x35ebd7&&(_0x424811[_0x57f07f(0x15d)]=_0x35ebd7);const _0x1be216=await this[_0x57f07f(0x153)][_0x57f07f(0x13d)]({'id':_0x5654ca},_0x424811);if(_0x1be216[_0x57f07f(0x129)])return!![];else throw new common_1[(_0x57f07f(0x14d))](_0x57f07f(0x142),common_1[_0x57f07f(0x161)]['BAD_REQUEST']);}async[_0x8b550(0x152)](_0x4497ff,_0x4b13be){const _0x1785b8=_0x8b550,{groupId:_0x3b4666}=_0x4497ff,{id:_0x31a677}=_0x4b13be[_0x1785b8(0x147)],_0x4ba4fa=await this[_0x1785b8(0x153)][_0x1785b8(0x12b)]({'where':{'id':_0x3b4666,'userId':_0x31a677}});if(!_0x4ba4fa)throw new common_1['HttpException'](_0x1785b8(0x135),common_1[_0x1785b8(0x161)][_0x1785b8(0x15f)]);const _0x3569c1=await this[_0x1785b8(0x153)][_0x1785b8(0x13d)]({'id':_0x3b4666},{'isDelete':!![]});if(_0x3569c1[_0x1785b8(0x129)])return _0x1785b8(0x160);else throw new common_1['HttpException'](_0x1785b8(0x15c),common_1[_0x1785b8(0x161)][_0x1785b8(0x15f)]);}async[_0x8b550(0x130)](_0x22b462){const _0x7f8593=_0x8b550,{id:_0x19c3b5}=_0x22b462[_0x7f8593(0x147)],_0x102acd=await this[_0x7f8593(0x153)][_0x7f8593(0x13d)]({'userId':_0x19c3b5,'isSticky':![],'isDelete':![]},{'isDelete':!![]});if(_0x102acd['affected'])return'删除成功';else throw new common_1[(_0x7f8593(0x14d))](_0x7f8593(0x15c),common_1[_0x7f8593(0x161)][_0x7f8593(0x15f)]);}async[_0x8b550(0x165)](_0x5e5be0){const _0x27da71=_0x8b550;if(!_0x5e5be0)return;return await this[_0x27da71(0x153)][_0x27da71(0x12b)]({'where':{'id':_0x5e5be0}});}};ChatGroupService=__decorate([(0x0,common_1[_0x8b550(0x137)])(),__param(0x0,(0x0,typeorm_1[_0x8b550(0x125)])(chatGroup_entity_1[_0x8b550(0x144)])),__param(0x1,(0x0,typeorm_1[_0x8b550(0x125)])(app_entity_1['AppEntity'])),__metadata(_0x8b550(0x128),[typeorm_2['Repository'],typeorm_2[_0x8b550(0x12c)],models_service_1['ModelsService']])],ChatGroupService),exports[_0x8b550(0x145)]=ChatGroupService;