'use strict';function _0x3c42(_0x58a65c,_0x1d3331){const _0x527906=_0x5279();return _0x3c42=function(_0x3c4242,_0x34717c){_0x3c4242=_0x3c4242-0x16b;let _0x11c823=_0x527906[_0x3c4242];return _0x11c823;},_0x3c42(_0x58a65c,_0x1d3331);}const _0x2bcdd2=_0x3c42;(function(_0x95876c,_0x1dd147){const _0x4cd86d=_0x3c42,_0x542f7e=_0x95876c();while(!![]){try{const _0x13a5ef=parseInt(_0x4cd86d(0x16b))/0x1*(parseInt(_0x4cd86d(0x192))/0x2)+-parseInt(_0x4cd86d(0x1a5))/0x3+parseInt(_0x4cd86d(0x187))/0x4*(-parseInt(_0x4cd86d(0x178))/0x5)+parseInt(_0x4cd86d(0x18a))/0x6+-parseInt(_0x4cd86d(0x1d5))/0x7+parseInt(_0x4cd86d(0x16c))/0x8*(-parseInt(_0x4cd86d(0x186))/0x9)+parseInt(_0x4cd86d(0x1b7))/0xa;if(_0x13a5ef===_0x1dd147)break;else _0x542f7e['push'](_0x542f7e['shift']());}catch(_0x43b634){_0x542f7e['push'](_0x542f7e['shift']());}}}(_0x5279,0x53d41));function _0x5279(){const _0x2e27be=['typeOriginCn','百度文本检测出现错误、请查看配置信息:\x20','BadwordsService','您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！','checkBadWordsByConfig','default','getOwnPropertyDescriptor','stringify','findOne','UserEntity','删除敏感词成功','baiduCheckBadWords','typeorm','userId','affected','getSensitiveConfig','formarTips','username','nineai','4188667TqCPHK','updateBadWords','5bzbiAk','2164200CLpGRb','DESC','function','删除敏感词失败','***','log','HttpException','Repository','data','更新敏感词成功','code','@nestjs/common','2373335VmyxUe','find','id\x20=\x20:userId','hideString','match','update','baiduTextAccessToken','NineAi检测','createQueryBuilder','push','defineProperty','../../common/utils','userEntity','application/x-www-form-urlencoded','18aRWicf','4XpKGaV','forEach','join','1243248yCRZtf','@nestjs/typeorm','loadBadWords','敏感词已经存在了、请勿重复添加','__metadata','../user/user.entity','badWordsEntity','nineaiCheckBadWords','89774dmCtem','user','ViolationLogEntity','word','extractContent','recordUserBadWords','map','customSensitiveWords','post','badWords','keyword','category','delBadWords','queryBadWords','Like','violationCount\x20+\x201','您提交的内容中包含','violationLogEntity','../globalConfig/globalConfig.service','847851pYBoPu','BadWordsEntity','email','design:paramtypes','的内容、我们已对您的账户进行标记、请合规使用！','__param','violation','application/json','decorate','error:\x20','自定义检测','axios','word_list','添加敏感词成功','敏感词不存在,请检查您的提交信息','findAndCount','save','includes','18084330Kfyvqq','metadata','BAD_REQUEST','HttpStatus','length','的信息、我们已对您账号进行标记、请合规使用！','status','checkBadWords','./violationLog.entity','globalConfigService','ASC'];_0x5279=function(){return _0x2e27be;};return _0x5279();}var __decorate=this&&this['__decorate']||function(_0x428f07,_0x32b0ff,_0x836c26,_0x9d7620){const _0x5ba093=_0x3c42;var _0x4396bd=arguments['length'],_0x177af4=_0x4396bd<0x3?_0x32b0ff:_0x9d7620===null?_0x9d7620=Object[_0x5ba093(0x1c8)](_0x32b0ff,_0x836c26):_0x9d7620,_0xff2b79;if(typeof Reflect==='object'&&typeof Reflect[_0x5ba093(0x1ad)]==='function')_0x177af4=Reflect[_0x5ba093(0x1ad)](_0x428f07,_0x32b0ff,_0x836c26,_0x9d7620);else{for(var _0x2612ae=_0x428f07[_0x5ba093(0x1bb)]-0x1;_0x2612ae>=0x0;_0x2612ae--)if(_0xff2b79=_0x428f07[_0x2612ae])_0x177af4=(_0x4396bd<0x3?_0xff2b79(_0x177af4):_0x4396bd>0x3?_0xff2b79(_0x32b0ff,_0x836c26,_0x177af4):_0xff2b79(_0x32b0ff,_0x836c26))||_0x177af4;}return _0x4396bd>0x3&&_0x177af4&&Object[_0x5ba093(0x182)](_0x32b0ff,_0x836c26,_0x177af4),_0x177af4;},__metadata=this&&this[_0x2bcdd2(0x18e)]||function(_0x4a16bf,_0x4fad68){const _0x465c93=_0x2bcdd2;if(typeof Reflect==='object'&&typeof Reflect[_0x465c93(0x1b8)]===_0x465c93(0x16e))return Reflect[_0x465c93(0x1b8)](_0x4a16bf,_0x4fad68);},__param=this&&this[_0x2bcdd2(0x1aa)]||function(_0x274f05,_0x2b36db){return function(_0xf0dff8,_0x5da5f5){_0x2b36db(_0xf0dff8,_0x5da5f5,_0x274f05);};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[_0x2bcdd2(0x1c4)]=void 0x0;const globalConfig_service_1=require(_0x2bcdd2(0x1a4)),common_1=require(_0x2bcdd2(0x177)),badwords_entity_1=require('./badwords.entity'),typeorm_1=require(_0x2bcdd2(0x1ce)),typeorm_2=require(_0x2bcdd2(0x18b)),axios_1=require(_0x2bcdd2(0x1b0)),violationLog_entity_1=require(_0x2bcdd2(0x1bf)),user_entity_1=require(_0x2bcdd2(0x18f)),utils_1=require(_0x2bcdd2(0x183));let BadwordsService=class BadwordsService{constructor(_0x4ecadc,_0x304741,_0x4b5663,_0x413026){const _0x3844ac=_0x2bcdd2;this[_0x3844ac(0x190)]=_0x4ecadc,this[_0x3844ac(0x1a3)]=_0x304741,this[_0x3844ac(0x184)]=_0x4b5663,this['globalConfigService']=_0x413026,this[_0x3844ac(0x19b)]=[];}async['onModuleInit'](){const _0x23e9c2=_0x2bcdd2;this[_0x23e9c2(0x18c)]();}async[_0x2bcdd2(0x199)](_0x2ba0e0,_0x20f925){const _0x4a17c3=_0x2bcdd2,_0x10b4ef=[];for(let _0x228e82=0x0;_0x228e82<this[_0x4a17c3(0x19b)][_0x4a17c3(0x1bb)];_0x228e82++){const _0x20d796=this[_0x4a17c3(0x19b)][_0x228e82];_0x2ba0e0[_0x4a17c3(0x1b6)](_0x20d796)&&_0x10b4ef[_0x4a17c3(0x181)](_0x20d796);}if(_0x10b4ef[_0x4a17c3(0x1bb)]){await this[_0x4a17c3(0x197)](_0x20f925,_0x2ba0e0,_0x10b4ef,['自定义'],_0x4a17c3(0x1af));const _0x2b8423=_0x4a17c3(0x1c5);throw new common_1[(_0x4a17c3(0x172))](_0x2b8423,common_1['HttpStatus'][_0x4a17c3(0x1b9)]);}}async[_0x2bcdd2(0x1be)](_0x10bb6c,_0x220301){const _0x32e59c=_0x2bcdd2,_0xc739d1=await this[_0x32e59c(0x1c0)][_0x32e59c(0x1d1)]();_0xc739d1&&await this[_0x32e59c(0x1c6)](_0x10bb6c,_0xc739d1,_0x220301),await this['customSensitiveWords'](_0x10bb6c,_0x220301);}async[_0x2bcdd2(0x1c6)](_0x20ab2e,_0x22c4ca,_0x112473){const _0x40322c=_0x2bcdd2,{useType:_0x449a4d}=_0x22c4ca;_0x449a4d==='baidu'&&await this['baiduCheckBadWords'](_0x20ab2e,_0x22c4ca[_0x40322c(0x17e)],_0x112473),_0x449a4d===_0x40322c(0x1d4)&&await this[_0x40322c(0x191)](_0x20ab2e,_0x22c4ca,_0x112473);}['extractContent'](_0x7af902){const _0x43d9fd=_0x2bcdd2,_0xa960cd=/存在(.*?)不合规/,_0x232e1a=_0x7af902[_0x43d9fd(0x17c)](_0xa960cd);return _0x232e1a?_0x232e1a[0x1]:'';}async[_0x2bcdd2(0x1cd)](_0x408662,_0x2964ee,_0x420814){const _0x59d2f9=_0x2bcdd2;if(!_0x2964ee)return;const _0x3e5c70='https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token='+_0x2964ee+'}',_0xb0d52a={'Content-Type':_0x59d2f9(0x185),'Accept':_0x59d2f9(0x1ac)},_0x2a30ef=await axios_1[_0x59d2f9(0x1c7)][_0x59d2f9(0x19a)](_0x3e5c70,{'text':_0x408662},{'headers':_0xb0d52a}),{conclusion:_0x2b3a1b,error_code:_0x142fb0,error_msg:_0x13a582,conclusionType:_0x56e2cb,data:_0x5f3afb}=_0x2a30ef[_0x59d2f9(0x174)];_0x142fb0&&console[_0x59d2f9(0x171)](_0x59d2f9(0x1c3),_0x13a582);if(_0x56e2cb!==0x1){const _0xc909af=[...new Set(_0x5f3afb[_0x59d2f9(0x198)](_0x473e76=>this[_0x59d2f9(0x196)](_0x473e76['msg'])))];await this[_0x59d2f9(0x197)](_0x420814,_0x408662,[_0x59d2f9(0x170)],_0xc909af,'百度云检测');const _0xf6970e='您提交的信息中包含'+_0xc909af[_0x59d2f9(0x189)](',')+_0x59d2f9(0x1a9);throw new common_1['HttpException'](_0xf6970e,common_1['HttpStatus'][_0x59d2f9(0x1b9)]);}}async[_0x2bcdd2(0x191)](_0x3367cd,_0x5aca93,_0x1d6e55){const _0x19006f=_0x2bcdd2;var _0x41c439;const {nineaiBuiltInSensitiveApiBase:_0x53d0fc,nineaiBuiltInSensitiveAuthKey:_0x4f853e}=_0x5aca93;if(!_0x53d0fc||!_0x4f853e)return;const _0x42ccf9=await axios_1['default'][_0x19006f(0x19a)](_0x53d0fc,{'content':_0x3367cd},{'headers':{'Content-Type':'application/json','Authorization':_0x4f853e}});if(!_0x42ccf9[_0x19006f(0x174)])return;if(_0x42ccf9[_0x19006f(0x174)][_0x19006f(0x176)]!=='0'){const {msg:msg='检测失败'}=_0x42ccf9[_0x19006f(0x174)];throw new common_1[(_0x19006f(0x172))]('敏感词检测\x20|\x20'+msg,common_1[_0x19006f(0x1ba)]['BAD_REQUEST']);}if(_0x42ccf9[_0x19006f(0x174)][_0x19006f(0x1b1)]&&((_0x41c439=_0x42ccf9[_0x19006f(0x174)]['word_list'])===null||_0x41c439===void 0x0?void 0x0:_0x41c439['length'])){const _0x1cc9fd=[...new Set(_0x42ccf9['data'][_0x19006f(0x1b1)][_0x19006f(0x198)](_0x5013b7=>_0x5013b7[_0x19006f(0x19c)]))],_0x38088a=[...new Set(_0x42ccf9['data'][_0x19006f(0x1b1)][_0x19006f(0x198)](_0x3a38e0=>_0x3a38e0[_0x19006f(0x19d)]))];await this[_0x19006f(0x197)](_0x1d6e55,_0x3367cd,_0x1cc9fd,_0x38088a,_0x19006f(0x17f));const _0x235343=this[_0x19006f(0x1d2)](_0x42ccf9['data']['word_list']);throw new common_1[(_0x19006f(0x172))](_0x235343,common_1['HttpStatus']['BAD_REQUEST']);}}[_0x2bcdd2(0x1d2)](_0x3f45a3){const _0x3cfd29=_0x2bcdd2,_0x1c02b9=_0x3f45a3[_0x3cfd29(0x198)](_0x2bdba7=>_0x2bdba7[_0x3cfd29(0x19d)]),_0x4d96b9=[...new Set(_0x1c02b9)];return _0x3cfd29(0x1a2)+_0x4d96b9[_0x3cfd29(0x189)](',')+_0x3cfd29(0x1bc);}async[_0x2bcdd2(0x18c)](){const _0x33dd3e=_0x2bcdd2,_0x2f77c7=await this[_0x33dd3e(0x190)][_0x33dd3e(0x179)]({'where':{'status':0x1},'select':[_0x33dd3e(0x195)]});this[_0x33dd3e(0x19b)]=_0x2f77c7['map'](_0x165e6e=>_0x165e6e[_0x33dd3e(0x195)]);}async[_0x2bcdd2(0x19f)](_0x2920b0){const _0x571b6d=_0x2bcdd2,{page:page=0x1,size:size=0x1f4,word:_0x20b23e,status:_0x98b1d6}=_0x2920b0,_0x14005e={};[0x0,0x1,'0','1'][_0x571b6d(0x1b6)](_0x98b1d6)&&(_0x14005e['status']=_0x98b1d6),_0x20b23e&&(_0x14005e[_0x571b6d(0x195)]=(0x0,typeorm_1[_0x571b6d(0x1a0)])('%'+_0x20b23e+'%'));const [_0x55a769,_0x168318]=await this[_0x571b6d(0x190)][_0x571b6d(0x1b4)]({'where':_0x14005e,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x571b6d(0x1c1)}});return{'rows':_0x55a769,'count':_0x168318};}async[_0x2bcdd2(0x19e)](_0x4d47d3){const _0x4440bd=_0x2bcdd2,_0x4c967a=await this[_0x4440bd(0x190)][_0x4440bd(0x1ca)]({'where':{'id':_0x4d47d3['id']}});if(!_0x4c967a)throw new common_1[(_0x4440bd(0x172))](_0x4440bd(0x1b3),common_1[_0x4440bd(0x1ba)][_0x4440bd(0x1b9)]);const _0x38983f=await this['badWordsEntity']['delete']({'id':_0x4d47d3['id']});if(_0x38983f[_0x4440bd(0x1d0)]>0x0)return await this['loadBadWords'](),_0x4440bd(0x1cc);else throw new common_1[(_0x4440bd(0x172))](_0x4440bd(0x16f),common_1['HttpStatus']['BAD_REQUEST']);}async[_0x2bcdd2(0x1d6)](_0x2d2c18){const _0x15e4e4=_0x2bcdd2,{id:_0x5ad1a8,word:_0x1147fd,status:_0x5d07b4}=_0x2d2c18,_0x8ddb69=await this['badWordsEntity'][_0x15e4e4(0x1ca)]({'where':{'word':_0x1147fd}});if(_0x8ddb69)throw new common_1[(_0x15e4e4(0x172))](_0x15e4e4(0x18d),common_1[_0x15e4e4(0x1ba)][_0x15e4e4(0x1b9)]);const _0x3eb7c9=await this[_0x15e4e4(0x190)][_0x15e4e4(0x17d)]({'id':_0x5ad1a8},{'word':_0x1147fd,'status':_0x5d07b4});if(_0x3eb7c9[_0x15e4e4(0x1d0)]>0x0)return await this[_0x15e4e4(0x18c)](),_0x15e4e4(0x175);else throw new common_1['HttpException']('更新敏感词失败',common_1[_0x15e4e4(0x1ba)][_0x15e4e4(0x1b9)]);}async['addBadWord'](_0x3bc205){const _0x339f41=_0x2bcdd2,{word:_0x295112}=_0x3bc205,_0x1a79f0=await this[_0x339f41(0x190)][_0x339f41(0x1ca)]({'where':{'word':_0x295112}});if(_0x1a79f0)throw new common_1['HttpException']('敏感词已存在,请检查您的提交信息',common_1['HttpStatus'][_0x339f41(0x1b9)]);return await this[_0x339f41(0x190)]['save']({'word':_0x295112}),await this[_0x339f41(0x18c)](),_0x339f41(0x1b2);}async[_0x2bcdd2(0x197)](_0x40c997,_0x1a820f,_0x2ba563,_0x5dc1e1,_0x3c45bb){const _0x4f1d79=_0x2bcdd2,_0xb8a523={'userId':_0x40c997,'content':_0x1a820f,'words':JSON[_0x4f1d79(0x1c9)](_0x2ba563),'typeCn':JSON[_0x4f1d79(0x1c9)](_0x5dc1e1),'typeOriginCn':_0x3c45bb};try{await this[_0x4f1d79(0x184)][_0x4f1d79(0x180)]()[_0x4f1d79(0x17d)](user_entity_1[_0x4f1d79(0x1cb)])['set']({'violationCount':()=>_0x4f1d79(0x1a1)})['where'](_0x4f1d79(0x17a),{'userId':_0x40c997})['execute'](),await this[_0x4f1d79(0x1a3)][_0x4f1d79(0x1b5)](_0xb8a523);}catch(_0x3bdd5b){console[_0x4f1d79(0x171)](_0x4f1d79(0x1ae),_0x3bdd5b);}}async[_0x2bcdd2(0x1ab)](_0x16a83f,_0x2f3891){const _0x230b3f=_0x2bcdd2,{role:_0x18bc17}=_0x16a83f[_0x230b3f(0x193)],{page:page=0x1,size:size=0xa,userId:_0x5804e0,typeOriginCn:_0x1593c8}=_0x2f3891,_0x5591cc={};_0x5804e0&&(_0x5591cc['userId']=_0x5804e0),_0x1593c8&&(_0x5591cc[_0x230b3f(0x1c2)]=_0x1593c8);const [_0x370daa,_0x1d5a1a]=await this[_0x230b3f(0x1a3)][_0x230b3f(0x1b4)]({'where':_0x5591cc,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x230b3f(0x16d)}}),_0x34fd67=[...new Set(_0x370daa[_0x230b3f(0x198)](_0x28a093=>_0x28a093['userId']))],_0x1af28a=await this[_0x230b3f(0x184)][_0x230b3f(0x179)]({'where':{'id':(0x0,typeorm_1['In'])(_0x34fd67)},'select':['id','avatar',_0x230b3f(0x1d3),_0x230b3f(0x1a7),'violationCount',_0x230b3f(0x1bd)]});return _0x370daa[_0x230b3f(0x188)](_0x5c3c42=>{const _0x37a895=_0x230b3f,_0x407817=_0x1af28a[_0x37a895(0x179)](_0x157d34=>_0x157d34['id']===_0x5c3c42[_0x37a895(0x1cf)]);_0x18bc17!=='super'&&(_0x407817[_0x37a895(0x1a7)]=(0x0,utils_1[_0x37a895(0x17b)])(_0x407817[_0x37a895(0x1a7)])),_0x5c3c42['userInfo']=_0x407817;}),{'rows':_0x370daa,'count':_0x1d5a1a};}};BadwordsService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_2['InjectRepository'])(badwords_entity_1[_0x2bcdd2(0x1a6)])),__param(0x1,(0x0,typeorm_2['InjectRepository'])(violationLog_entity_1[_0x2bcdd2(0x194)])),__param(0x2,(0x0,typeorm_2['InjectRepository'])(user_entity_1[_0x2bcdd2(0x1cb)])),__metadata(_0x2bcdd2(0x1a8),[typeorm_1[_0x2bcdd2(0x173)],typeorm_1['Repository'],typeorm_1[_0x2bcdd2(0x173)],globalConfig_service_1['GlobalConfigService']])],BadwordsService),exports[_0x2bcdd2(0x1c4)]=BadwordsService;