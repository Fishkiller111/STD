'use strict';function _0xc0a5(){const _0x46704e=['defineProperty','save','default','object','BAD_REQUEST','自定义检测','metadata','ViolationLogEntity','customSensitiveWords','typeorm','添加敏感词成功','../globalConfig/globalConfig.service','Repository','__param','530643ZOnZxV','badWordsEntity','email','keyword','hideString','userEntity','InjectRepository','您提交的内容中包含','design:paramtypes','stringify','status','avatar','badWords','HttpStatus','data','map','360340xcbrLI','更新敏感词失败','ASC','DESC','findOne','decorate','word_list','9517599LKKVnN','的内容、我们已对您的账户进行标记、请合规使用！','./violationLog.entity','敏感词不存在,请检查您的提交信息','检测失败','execute','../../common/utils','function','Injectable','createQueryBuilder','更新敏感词成功','application/json','nineai','UserEntity','checkBadWords','1808681winccq','formarTips','__decorate','typeOriginCn','171366xjekWm','65705fQJfwc','match','敏感词已存在,请检查您的提交信息','2021096rCnYLr','2Hdldgs','word','globalConfigService','affected','您提交的信息中包含','baiduTextAccessToken','join','code','forEach','violationLogEntity','BadwordsService','updateBadWords','extractContent','recordUserBadWords','checkBadWordsByConfig','GlobalConfigService','queryBadWords','set','username','violationCount','userId','category','../user/user.entity','delBadWords','./badwords.entity','update','axios','length','删除敏感词失败','super','find','includes','baidu','violation','application/x-www-form-urlencoded','敏感词已经存在了、请勿重复添加','__esModule','post','where','violationCount\x20+\x201','92PurFud','HttpException','百度云检测','nineaiCheckBadWords','baiduCheckBadWords','id\x20=\x20:userId','***','delete','userInfo'];_0xc0a5=function(){return _0x46704e;};return _0xc0a5();}const _0x55afbb=_0x52f5;function _0x52f5(_0xe04ed3,_0x41a681){const _0xc0a52c=_0xc0a5();return _0x52f5=function(_0x52f5ab,_0x3d1cfb){_0x52f5ab=_0x52f5ab-0x1d8;let _0x4d6ae6=_0xc0a52c[_0x52f5ab];return _0x4d6ae6;},_0x52f5(_0xe04ed3,_0x41a681);}(function(_0x2ef4f5,_0x3a43d0){const _0x58ff0f=_0x52f5,_0x1f7e2a=_0x2ef4f5();while(!![]){try{const _0x403cb2=-parseInt(_0x58ff0f(0x235))/0x1+parseInt(_0x58ff0f(0x1e6))/0x2*(-parseInt(_0x58ff0f(0x225))/0x3)+-parseInt(_0x58ff0f(0x20e))/0x4*(parseInt(_0x58ff0f(0x1e2))/0x5)+-parseInt(_0x58ff0f(0x1e1))/0x6+-parseInt(_0x58ff0f(0x1dd))/0x7+parseInt(_0x58ff0f(0x1e5))/0x8+parseInt(_0x58ff0f(0x23c))/0x9;if(_0x403cb2===_0x3a43d0)break;else _0x1f7e2a['push'](_0x1f7e2a['shift']());}catch(_0x292038){_0x1f7e2a['push'](_0x1f7e2a['shift']());}}}(_0xc0a5,0x2cdbc));var __decorate=this&&this[_0x55afbb(0x1df)]||function(_0x5dbcb2,_0x4b7d8b,_0x5349a3,_0x5f0cc8){const _0x48ecb1=_0x55afbb;var _0x35623b=arguments[_0x48ecb1(0x201)],_0x14de30=_0x35623b<0x3?_0x4b7d8b:_0x5f0cc8===null?_0x5f0cc8=Object['getOwnPropertyDescriptor'](_0x4b7d8b,_0x5349a3):_0x5f0cc8,_0x33e3e9;if(typeof Reflect===_0x48ecb1(0x21a)&&typeof Reflect[_0x48ecb1(0x23a)]===_0x48ecb1(0x243))_0x14de30=Reflect[_0x48ecb1(0x23a)](_0x5dbcb2,_0x4b7d8b,_0x5349a3,_0x5f0cc8);else{for(var _0x679cfa=_0x5dbcb2['length']-0x1;_0x679cfa>=0x0;_0x679cfa--)if(_0x33e3e9=_0x5dbcb2[_0x679cfa])_0x14de30=(_0x35623b<0x3?_0x33e3e9(_0x14de30):_0x35623b>0x3?_0x33e3e9(_0x4b7d8b,_0x5349a3,_0x14de30):_0x33e3e9(_0x4b7d8b,_0x5349a3))||_0x14de30;}return _0x35623b>0x3&&_0x14de30&&Object[_0x48ecb1(0x217)](_0x4b7d8b,_0x5349a3,_0x14de30),_0x14de30;},__metadata=this&&this['__metadata']||function(_0x38efee,_0x3e3d1b){const _0x685ae6=_0x55afbb;if(typeof Reflect===_0x685ae6(0x21a)&&typeof Reflect[_0x685ae6(0x21d)]===_0x685ae6(0x243))return Reflect['metadata'](_0x38efee,_0x3e3d1b);},__param=this&&this[_0x55afbb(0x224)]||function(_0x1c602a,_0x252935){return function(_0x26c9fc,_0x422258){_0x252935(_0x26c9fc,_0x422258,_0x1c602a);};};Object[_0x55afbb(0x217)](exports,_0x55afbb(0x20a),{'value':!![]}),exports[_0x55afbb(0x1f0)]=void 0x0;const globalConfig_service_1=require(_0x55afbb(0x222)),common_1=require('@nestjs/common'),badwords_entity_1=require(_0x55afbb(0x1fe)),typeorm_1=require(_0x55afbb(0x220)),typeorm_2=require('@nestjs/typeorm'),axios_1=require(_0x55afbb(0x200)),violationLog_entity_1=require(_0x55afbb(0x23e)),user_entity_1=require(_0x55afbb(0x1fc)),utils_1=require(_0x55afbb(0x242));let BadwordsService=class BadwordsService{constructor(_0x152ea7,_0x1e74ff,_0x5d2d60,_0x39ddfb){const _0x55a931=_0x55afbb;this[_0x55a931(0x226)]=_0x152ea7,this[_0x55a931(0x1ef)]=_0x1e74ff,this[_0x55a931(0x22a)]=_0x5d2d60,this['globalConfigService']=_0x39ddfb,this[_0x55a931(0x231)]=[];}async['onModuleInit'](){this['loadBadWords']();}async[_0x55afbb(0x21f)](_0x12c071,_0x28a17e){const _0x5e8f34=_0x55afbb,_0x344d30=[];for(let _0x11236c=0x0;_0x11236c<this[_0x5e8f34(0x231)]['length'];_0x11236c++){const _0x534cf3=this[_0x5e8f34(0x231)][_0x11236c];_0x12c071[_0x5e8f34(0x205)](_0x534cf3)&&_0x344d30['push'](_0x534cf3);}if(_0x344d30['length']){await this[_0x5e8f34(0x1f3)](_0x28a17e,_0x12c071,_0x344d30,['自定义'],_0x5e8f34(0x21c));const _0x37fae7='您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！';throw new common_1[(_0x5e8f34(0x20f))](_0x37fae7,common_1['HttpStatus']['BAD_REQUEST']);}}async[_0x55afbb(0x1dc)](_0x48494b,_0x41bedb){const _0x177f0=_0x55afbb,_0x284eb3=await this[_0x177f0(0x1e8)]['getSensitiveConfig']();_0x284eb3&&await this[_0x177f0(0x1f4)](_0x48494b,_0x284eb3,_0x41bedb),await this['customSensitiveWords'](_0x48494b,_0x41bedb);}async['checkBadWordsByConfig'](_0x24b81b,_0x4af7c0,_0x6fa136){const _0x364a28=_0x55afbb,{useType:_0x1202e1}=_0x4af7c0;_0x1202e1===_0x364a28(0x206)&&await this[_0x364a28(0x212)](_0x24b81b,_0x4af7c0[_0x364a28(0x1eb)],_0x6fa136),_0x1202e1===_0x364a28(0x1da)&&await this[_0x364a28(0x211)](_0x24b81b,_0x4af7c0,_0x6fa136);}['extractContent'](_0x4f3107){const _0x8be22b=_0x55afbb,_0x3f21d1=/存在(.*?)不合规/,_0x210172=_0x4f3107[_0x8be22b(0x1e3)](_0x3f21d1);return _0x210172?_0x210172[0x1]:'';}async[_0x55afbb(0x212)](_0x2a9bce,_0x323742,_0x3891f1){const _0x43a67a=_0x55afbb;if(!_0x323742)return;const _0x3e9c74='https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token='+_0x323742+'}',_0x25e5cc={'Content-Type':_0x43a67a(0x208),'Accept':_0x43a67a(0x1d9)},_0x4c0987=await axios_1[_0x43a67a(0x219)][_0x43a67a(0x20b)](_0x3e9c74,{'text':_0x2a9bce},{'headers':_0x25e5cc}),{conclusion:_0x18a670,error_code:_0x113994,error_msg:_0x1a2b7b,conclusionType:_0x4c9abf,data:_0x5dbaac}=_0x4c0987['data'];_0x113994&&console['log']('百度文本检测出现错误、请查看配置信息:\x20',_0x1a2b7b);if(_0x4c9abf!==0x1){const _0xfa4c28=[...new Set(_0x5dbaac['map'](_0x41b6cb=>this[_0x43a67a(0x1f2)](_0x41b6cb['msg'])))];await this[_0x43a67a(0x1f3)](_0x3891f1,_0x2a9bce,[_0x43a67a(0x214)],_0xfa4c28,_0x43a67a(0x210));const _0x26b117=_0x43a67a(0x1ea)+_0xfa4c28[_0x43a67a(0x1ec)](',')+_0x43a67a(0x23d);throw new common_1['HttpException'](_0x26b117,common_1['HttpStatus']['BAD_REQUEST']);}}async[_0x55afbb(0x211)](_0x3e4e7f,_0x32c41c,_0x1a6985){const _0x34f1c0=_0x55afbb;var _0xdb268b;const {nineaiBuiltInSensitiveApiBase:_0x497fc4,nineaiBuiltInSensitiveAuthKey:_0x1477cb}=_0x32c41c;if(!_0x497fc4||!_0x1477cb)return;const _0xe71b7f=await axios_1[_0x34f1c0(0x219)][_0x34f1c0(0x20b)](_0x497fc4,{'content':_0x3e4e7f},{'headers':{'Content-Type':_0x34f1c0(0x1d9),'Authorization':_0x1477cb}});if(!_0xe71b7f[_0x34f1c0(0x233)])return;if(_0xe71b7f['data'][_0x34f1c0(0x1ed)]!=='0'){const {msg:msg=_0x34f1c0(0x240)}=_0xe71b7f[_0x34f1c0(0x233)];throw new common_1[(_0x34f1c0(0x20f))]('敏感词检测\x20|\x20'+msg,common_1[_0x34f1c0(0x232)][_0x34f1c0(0x21b)]);}if(_0xe71b7f[_0x34f1c0(0x233)][_0x34f1c0(0x23b)]&&((_0xdb268b=_0xe71b7f['data'][_0x34f1c0(0x23b)])===null||_0xdb268b===void 0x0?void 0x0:_0xdb268b[_0x34f1c0(0x201)])){const _0x1e41cf=[...new Set(_0xe71b7f['data'][_0x34f1c0(0x23b)][_0x34f1c0(0x234)](_0x3912b5=>_0x3912b5[_0x34f1c0(0x228)]))],_0x3de34c=[...new Set(_0xe71b7f[_0x34f1c0(0x233)][_0x34f1c0(0x23b)]['map'](_0x3c5484=>_0x3c5484[_0x34f1c0(0x1fb)]))];await this[_0x34f1c0(0x1f3)](_0x1a6985,_0x3e4e7f,_0x1e41cf,_0x3de34c,'NineAi检测');const _0x327f20=this['formarTips'](_0xe71b7f[_0x34f1c0(0x233)][_0x34f1c0(0x23b)]);throw new common_1['HttpException'](_0x327f20,common_1[_0x34f1c0(0x232)][_0x34f1c0(0x21b)]);}}[_0x55afbb(0x1de)](_0x208c1e){const _0x1982f3=_0x55afbb,_0x4e16f2=_0x208c1e[_0x1982f3(0x234)](_0x50b480=>_0x50b480[_0x1982f3(0x1fb)]),_0x545f98=[...new Set(_0x4e16f2)];return _0x1982f3(0x22c)+_0x545f98['join'](',')+'的信息、我们已对您账号进行标记、请合规使用！';}async['loadBadWords'](){const _0x3d941b=_0x55afbb,_0x425573=await this['badWordsEntity'][_0x3d941b(0x204)]({'where':{'status':0x1},'select':[_0x3d941b(0x1e7)]});this[_0x3d941b(0x231)]=_0x425573[_0x3d941b(0x234)](_0x2590f8=>_0x2590f8[_0x3d941b(0x1e7)]);}async[_0x55afbb(0x1f6)](_0x12b824){const _0x575efc=_0x55afbb,{page:page=0x1,size:size=0x1f4,word:_0x2e5185,status:_0x1d35d2}=_0x12b824,_0x3d5b56={};[0x0,0x1,'0','1'][_0x575efc(0x205)](_0x1d35d2)&&(_0x3d5b56[_0x575efc(0x22f)]=_0x1d35d2),_0x2e5185&&(_0x3d5b56[_0x575efc(0x1e7)]=(0x0,typeorm_1['Like'])('%'+_0x2e5185+'%'));const [_0x18703a,_0x159379]=await this[_0x575efc(0x226)]['findAndCount']({'where':_0x3d5b56,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x575efc(0x237)}});return{'rows':_0x18703a,'count':_0x159379};}async[_0x55afbb(0x1fd)](_0x129a91){const _0x5079c5=_0x55afbb,_0x16d206=await this[_0x5079c5(0x226)][_0x5079c5(0x239)]({'where':{'id':_0x129a91['id']}});if(!_0x16d206)throw new common_1[(_0x5079c5(0x20f))](_0x5079c5(0x23f),common_1['HttpStatus']['BAD_REQUEST']);const _0x5b2462=await this[_0x5079c5(0x226)][_0x5079c5(0x215)]({'id':_0x129a91['id']});if(_0x5b2462[_0x5079c5(0x1e9)]>0x0)return await this['loadBadWords'](),'删除敏感词成功';else throw new common_1['HttpException'](_0x5079c5(0x202),common_1['HttpStatus']['BAD_REQUEST']);}async[_0x55afbb(0x1f1)](_0x2d245a){const _0x7759b5=_0x55afbb,{id:_0x1e42f8,word:_0x2a021f,status:_0x13eb89}=_0x2d245a,_0x37476e=await this[_0x7759b5(0x226)][_0x7759b5(0x239)]({'where':{'word':_0x2a021f}});if(_0x37476e)throw new common_1[(_0x7759b5(0x20f))](_0x7759b5(0x209),common_1[_0x7759b5(0x232)][_0x7759b5(0x21b)]);const _0x4b05da=await this[_0x7759b5(0x226)][_0x7759b5(0x1ff)]({'id':_0x1e42f8},{'word':_0x2a021f,'status':_0x13eb89});if(_0x4b05da[_0x7759b5(0x1e9)]>0x0)return await this['loadBadWords'](),_0x7759b5(0x1d8);else throw new common_1[(_0x7759b5(0x20f))](_0x7759b5(0x236),common_1[_0x7759b5(0x232)][_0x7759b5(0x21b)]);}async['addBadWord'](_0x8445b2){const _0x3c7000=_0x55afbb,{word:_0x1bf1f1}=_0x8445b2,_0x528c06=await this[_0x3c7000(0x226)]['findOne']({'where':{'word':_0x1bf1f1}});if(_0x528c06)throw new common_1['HttpException'](_0x3c7000(0x1e4),common_1[_0x3c7000(0x232)][_0x3c7000(0x21b)]);return await this[_0x3c7000(0x226)]['save']({'word':_0x1bf1f1}),await this['loadBadWords'](),_0x3c7000(0x221);}async[_0x55afbb(0x1f3)](_0x36e99f,_0x510dda,_0xe81120,_0x1fec95,_0x3697e2){const _0x19a561=_0x55afbb,_0x129259={'userId':_0x36e99f,'content':_0x510dda,'words':JSON[_0x19a561(0x22e)](_0xe81120),'typeCn':JSON[_0x19a561(0x22e)](_0x1fec95),'typeOriginCn':_0x3697e2};try{await this[_0x19a561(0x22a)][_0x19a561(0x245)]()[_0x19a561(0x1ff)](user_entity_1[_0x19a561(0x1db)])[_0x19a561(0x1f7)]({'violationCount':()=>_0x19a561(0x20d)})[_0x19a561(0x20c)](_0x19a561(0x213),{'userId':_0x36e99f})[_0x19a561(0x241)](),await this[_0x19a561(0x1ef)][_0x19a561(0x218)](_0x129259);}catch(_0x4d907d){console['log']('error:\x20',_0x4d907d);}}async[_0x55afbb(0x207)](_0xd38359,_0xc3fda3){const _0x4e47e9=_0x55afbb,{role:_0x429031}=_0xd38359['user'],{page:page=0x1,size:size=0xa,userId:_0x26336d,typeOriginCn:_0x43b942}=_0xc3fda3,_0x88080f={};_0x26336d&&(_0x88080f[_0x4e47e9(0x1fa)]=_0x26336d),_0x43b942&&(_0x88080f[_0x4e47e9(0x1e0)]=_0x43b942);const [_0x2d8b39,_0x3fad9d]=await this[_0x4e47e9(0x1ef)]['findAndCount']({'where':_0x88080f,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x4e47e9(0x238)}}),_0x18f07a=[...new Set(_0x2d8b39[_0x4e47e9(0x234)](_0xf6f115=>_0xf6f115[_0x4e47e9(0x1fa)]))],_0x2c8bb3=await this['userEntity'][_0x4e47e9(0x204)]({'where':{'id':(0x0,typeorm_1['In'])(_0x18f07a)},'select':['id',_0x4e47e9(0x230),_0x4e47e9(0x1f8),'email',_0x4e47e9(0x1f9),_0x4e47e9(0x22f)]});return _0x2d8b39[_0x4e47e9(0x1ee)](_0x458b8b=>{const _0xb36f2e=_0x4e47e9,_0x3f5b0f=_0x2c8bb3['find'](_0x5cc6c5=>_0x5cc6c5['id']===_0x458b8b[_0xb36f2e(0x1fa)]);_0x429031!==_0xb36f2e(0x203)&&(_0x3f5b0f[_0xb36f2e(0x227)]=(0x0,utils_1[_0xb36f2e(0x229)])(_0x3f5b0f[_0xb36f2e(0x227)])),_0x458b8b[_0xb36f2e(0x216)]=_0x3f5b0f;}),{'rows':_0x2d8b39,'count':_0x3fad9d};}};BadwordsService=__decorate([(0x0,common_1[_0x55afbb(0x244)])(),__param(0x0,(0x0,typeorm_2[_0x55afbb(0x22b)])(badwords_entity_1['BadWordsEntity'])),__param(0x1,(0x0,typeorm_2[_0x55afbb(0x22b)])(violationLog_entity_1[_0x55afbb(0x21e)])),__param(0x2,(0x0,typeorm_2[_0x55afbb(0x22b)])(user_entity_1[_0x55afbb(0x1db)])),__metadata(_0x55afbb(0x22d),[typeorm_1['Repository'],typeorm_1[_0x55afbb(0x223)],typeorm_1['Repository'],globalConfig_service_1[_0x55afbb(0x1f5)]])],BadwordsService),exports[_0x55afbb(0x1f0)]=BadwordsService;