'use strict';const _0x49349e=_0x4d17;(function(_0x5cdcc7,_0x1bca45){const _0x25dce9=_0x4d17,_0x1bd33d=_0x5cdcc7();while(!![]){try{const _0x2fd26b=parseInt(_0x25dce9(0x1bd))/0x1+parseInt(_0x25dce9(0x1bc))/0x2+parseInt(_0x25dce9(0x171))/0x3+-parseInt(_0x25dce9(0x1ba))/0x4*(-parseInt(_0x25dce9(0x1b5))/0x5)+-parseInt(_0x25dce9(0x1b1))/0x6*(parseInt(_0x25dce9(0x189))/0x7)+parseInt(_0x25dce9(0x185))/0x8*(parseInt(_0x25dce9(0x1b7))/0x9)+-parseInt(_0x25dce9(0x1b9))/0xa*(parseInt(_0x25dce9(0x1a5))/0xb);if(_0x2fd26b===_0x1bca45)break;else _0x1bd33d['push'](_0x1bd33d['shift']());}catch(_0xa7ed42){_0x1bd33d['push'](_0x1bd33d['shift']());}}}(_0x21d7,0xd94cb));function _0x21d7(){const _0x2d2a9b=['digest','\x0a\x20\x20\x20\x20<xml>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<ToUserName><![CDATA[','getOwnPropertyDescriptor','由于公众号的回复限制、过长的问题我们可能无法回复、您可以前往我们的官方站点享受更加完善的服务、如果您有更多问题、欢迎像我提问！','回跳跳转地址:\x20','log','createRandomNonceStr','genXmlMsgByConfig','update','aotoPlay','createHash','2522718LfcZry','defineProperty','&noncestr=','GlobalConfigService','str:\x20','getJsapiTicket','getWechatAccessToken',']]></ToUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<FromUserName><![CDATA[','&code=','wechatOfficialToken','sha1','HttpException','https://open.weixin.qq.com/connect/oauth2/authorize?appid=','join','sort','getConfigs','非法参数','loginByCode','loginByOpenId','&grant_type=authorization_code','31296uEFQEz','AuthService','&redirect_uri=','../../common/utils','7gpgflp','../globalConfig/globalConfig.service','UserService','getQRSceneStrByBind','../chatgpt/chatgpt.service','jsapiTicket:\x20','scanedSceneStrMap','genXmlMsg','&url=','../user/user.service','sceneStrMap','AutoreplyService','checkAutoReply','getQRCodeTicket','jiangly','ChatgptService',']]></Content>\x0a\x20\x20\x20\x20</xml>','wechatJsapiTicket','QR_STR_SCENE','authService','来自公众号的询问问题\x20=======>\x20','@nestjs/common','getQRSceneStr','https://api.weixin.qq.com/sns/oauth2/access_token?appid=','autoreplyService','__decorate','BAD_REQUEST','jsapi_ticket=','121cTNyjK','https://api.weixin.qq.com/cgi-bin/qrcode/create?access_token=','get','OfficialService','onModuleInit','axios','wechatOfficialAppId','toFixed','getUserOpenId','__esModule','getUserFromOpenId','scanBindWx','2015634xEcSJI','object','wechatOfficialAppSecret','HttpStatus','10bIekUN','getRedirectUrl','2853TdjTJG','function','3841730QqPZwe','2984528gQKoaZ','getUserById','1272900ASBvdv','1242177WshnJe','globalConfigService','user','split','__metadata','length','default','来自公众号的回复问题\x20=======>\x20超时导致问题无法回答完整','fetchQRCodeTicket','metadata','../auth/auth.service','&response_type=code&scope=snsapi_base&state=weChatLogin#wechat_redirect','chatgptService','../autoreply/autoreply.service','appId:\x20','getTime','now','crypto','decorate','design:paramtypes',']]></FromUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<CreateTime>','Injectable','userService'];_0x21d7=function(){return _0x2d2a9b;};return _0x21d7();}var __decorate=this&&this[_0x49349e(0x1a2)]||function(_0x4fc6fb,_0x5b497d,_0x57698f,_0x5e5b6f){const _0x52eb51=_0x49349e;var _0x224cde=arguments['length'],_0x163037=_0x224cde<0x3?_0x5b497d:_0x5e5b6f===null?_0x5e5b6f=Object[_0x52eb51(0x168)](_0x5b497d,_0x57698f):_0x5e5b6f,_0x5c1beb;if(typeof Reflect===_0x52eb51(0x1b2)&&typeof Reflect[_0x52eb51(0x161)]==='function')_0x163037=Reflect[_0x52eb51(0x161)](_0x4fc6fb,_0x5b497d,_0x57698f,_0x5e5b6f);else{for(var _0x7282bc=_0x4fc6fb[_0x52eb51(0x1c2)]-0x1;_0x7282bc>=0x0;_0x7282bc--)if(_0x5c1beb=_0x4fc6fb[_0x7282bc])_0x163037=(_0x224cde<0x3?_0x5c1beb(_0x163037):_0x224cde>0x3?_0x5c1beb(_0x5b497d,_0x57698f,_0x163037):_0x5c1beb(_0x5b497d,_0x57698f))||_0x163037;}return _0x224cde>0x3&&_0x163037&&Object[_0x52eb51(0x172)](_0x5b497d,_0x57698f,_0x163037),_0x163037;},__metadata=this&&this[_0x49349e(0x1c1)]||function(_0x16ccea,_0x254f3f){const _0x24381a=_0x49349e;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x24381a(0x1b8))return Reflect[_0x24381a(0x1c6)](_0x16ccea,_0x254f3f);};Object['defineProperty'](exports,_0x49349e(0x1ae),{'value':!![]}),exports[_0x49349e(0x1a8)]=void 0x0;const chatgpt_service_1=require(_0x49349e(0x18d)),globalConfig_service_1=require(_0x49349e(0x18a)),auth_service_1=require(_0x49349e(0x1c7)),user_service_1=require(_0x49349e(0x192)),autoreply_service_1=require(_0x49349e(0x15c)),common_1=require(_0x49349e(0x19e)),crypto=require(_0x49349e(0x160)),axios_1=require(_0x49349e(0x1aa)),utils_1=require(_0x49349e(0x188));let OfficialService=class OfficialService{constructor(_0xe3adaf,_0x11a20f,_0x90e075,_0x43a6e1,_0x32fa5e){const _0xe4189e=_0x49349e;this[_0xe4189e(0x1a1)]=_0xe3adaf,this['userService']=_0x11a20f,this[_0xe4189e(0x19c)]=_0x90e075,this[_0xe4189e(0x1be)]=_0x43a6e1,this[_0xe4189e(0x15b)]=_0x32fa5e,this[_0xe4189e(0x193)]={},this[_0xe4189e(0x18f)]={};}async[_0x49349e(0x1a9)](){const _0x342e46=_0x49349e;await this['globalConfigService'][_0x342e46(0x177)](!![]);}async[_0x49349e(0x19f)](_0x509837){const _0x4c5057=_0x49349e,{invitedBy:_0xda9f48}=_0x509837;let _0x445bae=(0x0,utils_1[_0x4c5057(0x16c)])(0x20);return _0xda9f48&&(_0x445bae+=':'+_0xda9f48),this[_0x4c5057(0x193)][_0x445bae]=!![],_0x445bae;}async[_0x49349e(0x18c)](_0x20b29a){const _0x35afd5=_0x49349e,{id:_0x2d1285}=_0x20b29a[_0x35afd5(0x1bf)],_0x3b05c7=(0x0,utils_1[_0x35afd5(0x16c)])(0x20)+'/'+_0x2d1285;return this[_0x35afd5(0x193)][_0x3b05c7]=!![],_0x3b05c7;}async[_0x49349e(0x196)](_0x1401ee){const _0x1c70cd=_0x49349e;return this[_0x1c70cd(0x1c5)](_0x1401ee);}async[_0x49349e(0x1b6)](_0x4ee80a){const _0x1063d7=_0x49349e,_0x35deef=await this[_0x1063d7(0x1be)][_0x1063d7(0x180)]([_0x1063d7(0x1ab)]),_0x12dc33=_0x1063d7(0x17d)+_0x35deef+_0x1063d7(0x187)+encodeURIComponent(_0x4ee80a)+_0x1063d7(0x15a);return console[_0x1063d7(0x16b)](_0x1063d7(0x16a),_0x12dc33),_0x12dc33;}async[_0x49349e(0x176)](_0x13f1f4){const _0x32740a=_0x49349e,_0x52199f=(0x0,utils_1[_0x32740a(0x16c)])(0x20),_0x1441e4=(Date[_0x32740a(0x15f)]()/0x3e8)[_0x32740a(0x1ac)](0x0),_0x2eabb1=await this[_0x32740a(0x1be)][_0x32740a(0x180)]([_0x32740a(0x19a)]);console[_0x32740a(0x16b)](_0x32740a(0x18e),_0x2eabb1);const _0x395243=await this['globalConfigService'][_0x32740a(0x180)]([_0x32740a(0x1ab)]);console[_0x32740a(0x16b)](_0x32740a(0x15d),_0x395243);const _0x1b1bd3=_0x32740a(0x1a4)+_0x2eabb1+_0x32740a(0x173)+_0x52199f+'&timestamp='+_0x1441e4+_0x32740a(0x191)+_0x13f1f4;console[_0x32740a(0x16b)](_0x32740a(0x175),_0x1b1bd3);const _0x465967=this['sha1'](_0x1b1bd3);return{'appId':_0x395243,'nonceStr':_0x52199f,'timestamp':_0x1441e4,'signature':_0x465967};}async[_0x49349e(0x1c5)](_0x7d7e0f){const _0x5dc7db=_0x49349e,_0x3727fb=await this[_0x5dc7db(0x1be)][_0x5dc7db(0x180)](['wechatAccessToken']),_0xa12291={'action_name':_0x5dc7db(0x19b),'action_info':{'scene':{'scene_str':_0x7d7e0f}}},_0x2f26fa=await axios_1[_0x5dc7db(0x1c3)]['post'](_0x5dc7db(0x1a6)+_0x3727fb,_0xa12291),{data:{errmsg:_0x6339bc,ticket:_0x1a36a1}}=_0x2f26fa;if(_0x6339bc)throw new common_1[(_0x5dc7db(0x17c))](_0x6339bc,common_1[_0x5dc7db(0x1b4)][_0x5dc7db(0x1a3)]);return _0x1a36a1;}async[_0x49349e(0x182)](_0x2c7174,_0x3bac8e){const _0x42fb5a=_0x49349e,_0x3f2903=await this[_0x42fb5a(0x1be)][_0x42fb5a(0x180)]([_0x42fb5a(0x1ab)]),_0x415505=await this['globalConfigService'][_0x42fb5a(0x180)]([_0x42fb5a(0x1b3)]),_0x1d8667=await axios_1['default'][_0x42fb5a(0x1a7)](_0x42fb5a(0x1a0)+_0x3f2903+'&secret='+_0x415505+_0x42fb5a(0x179)+_0x3bac8e+_0x42fb5a(0x184)),{data:{errmsg:_0x574bc2,openid:_0x440980}}=_0x1d8667;if(_0x574bc2)throw new common_1['HttpException'](_0x574bc2,common_1[_0x42fb5a(0x1b4)][_0x42fb5a(0x1a3)]);let _0x10e733;return _0x10e733=await this['userService'][_0x42fb5a(0x1ad)](_0x440980),!_0x10e733&&(_0x10e733=await this['userService'][_0x42fb5a(0x1af)](_0x440980)),this[_0x42fb5a(0x19c)][_0x42fb5a(0x183)](_0x10e733,_0x2c7174);}async['scan'](_0x56c32f,_0x217e9e){const _0x5d15c5=_0x49349e;if(!this[_0x5d15c5(0x193)][_0x217e9e])throw new common_1[(_0x5d15c5(0x17c))]('非法参数',common_1[_0x5d15c5(0x1b4)][_0x5d15c5(0x1a3)]);const _0x5b824f=await this[_0x5d15c5(0x165)][_0x5d15c5(0x1af)](_0x56c32f,_0x217e9e);this[_0x5d15c5(0x18f)][_0x217e9e]=_0x5b824f['id'];}async['loginBySceneStr'](_0x35ee07,_0x1320ea){const _0x224fcd=_0x49349e;if(!this['sceneStrMap'][_0x1320ea])return;const _0x4bc876=this[_0x224fcd(0x18f)][_0x1320ea];if(!_0x4bc876)return'';const _0xa8f683=await this['userService'][_0x224fcd(0x1bb)](_0x4bc876);return delete this[_0x224fcd(0x18f)][_0x1320ea],this[_0x224fcd(0x19c)][_0x224fcd(0x183)](_0xa8f683,_0x35ee07);}async[_0x49349e(0x1b0)](_0x192853,_0x320490){const _0x5b704f=_0x49349e;if(!this[_0x5b704f(0x193)][_0x320490])throw new common_1[(_0x5b704f(0x17c))](_0x5b704f(0x181),common_1[_0x5b704f(0x1b4)]['BAD_REQUEST']);const _0x33288b=_0x320490[_0x5b704f(0x1c0)]('/')[0x1],_0x45ae41=await this['userService']['bindWx'](_0x192853,_0x33288b);this['scanedSceneStrMap'][_0x320490]=_0x45ae41;}async['bindWxBySceneStr'](_0x3b311d,_0x22467b){const _0xe0bed9=_0x49349e;if(!this[_0xe0bed9(0x193)][_0x22467b])throw new common_1['HttpException']('非法参数',common_1[_0xe0bed9(0x1b4)][_0xe0bed9(0x1a3)]);const {id:_0x33fa83}=_0x3b311d[_0xe0bed9(0x1bf)],_0x329537=this[_0xe0bed9(0x18f)][_0x22467b];if(!_0x329537)return'';return delete this['scanedSceneStrMap'][_0x22467b],_0x329537;}async['verify'](_0xcb1b4e,_0x37f563,_0x110838){const _0x5c559f=_0x49349e,_0x4883bf=await this[_0x5c559f(0x1be)][_0x5c559f(0x180)]([_0x5c559f(0x17a)])||_0x5c559f(0x197);return await this[_0x5c559f(0x17b)]([_0x4883bf,_0x37f563,_0x110838][_0x5c559f(0x17f)]()[_0x5c559f(0x17e)](''))==_0xcb1b4e;}[_0x49349e(0x17b)](_0x39f25e){const _0x56b5c0=_0x49349e;return crypto[_0x56b5c0(0x170)](_0x56b5c0(0x17b))[_0x56b5c0(0x16e)](_0x39f25e)[_0x56b5c0(0x166)]('hex');}async[_0x49349e(0x16d)](_0x58ff22,_0x491ace){const _0x324c97=_0x49349e,_0x2930bc=await this[_0x324c97(0x1be)]['getConfigs']([_0x491ace]);return this[_0x324c97(0x190)](_0x58ff22,_0x2930bc);}async[_0x49349e(0x190)](_0x3e6417,_0x547f3e){const _0x35583a=_0x49349e;return _0x35583a(0x167)+_0x3e6417['fromusername'][0x0]+_0x35583a(0x178)+_0x3e6417['tousername'][0x0]+_0x35583a(0x163)+new Date()[_0x35583a(0x15e)]()+'</CreateTime>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<MsgType><![CDATA[text]]></MsgType>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<Content><![CDATA['+_0x547f3e+_0x35583a(0x199);}async[_0x49349e(0x16f)](_0x594d5e){const _0x10fd41=_0x49349e,_0x219410=new Promise((_0x367c77,_0x5e9022)=>{setTimeout(()=>{_0x5e9022(new Error('请求超时'));},0x12c0);});let _0x3f8b8e='';try{console['log'](_0x10fd41(0x19d),_0x594d5e);const _0x4297c8=await Promise['race']([this[_0x10fd41(0x15b)]['chatSyncFree'](_0x594d5e),_0x219410]);_0x3f8b8e=_0x4297c8||await this[_0x10fd41(0x1a1)][_0x10fd41(0x195)](_0x594d5e);}catch(_0x2ee881){console[_0x10fd41(0x16b)](_0x10fd41(0x1c4)),_0x3f8b8e=await this[_0x10fd41(0x1be)][_0x10fd41(0x180)](['officialAutoReplyText'])||_0x10fd41(0x169);}return _0x3f8b8e;}};function _0x4d17(_0x292e3d,_0x506aa4){const _0x21d76c=_0x21d7();return _0x4d17=function(_0x4d172f,_0x222a69){_0x4d172f=_0x4d172f-0x15a;let _0x262f09=_0x21d76c[_0x4d172f];return _0x262f09;},_0x4d17(_0x292e3d,_0x506aa4);}OfficialService=__decorate([(0x0,common_1[_0x49349e(0x164)])(),__metadata(_0x49349e(0x162),[autoreply_service_1[_0x49349e(0x194)],user_service_1[_0x49349e(0x18b)],auth_service_1[_0x49349e(0x186)],globalConfig_service_1[_0x49349e(0x174)],chatgpt_service_1[_0x49349e(0x198)]])],OfficialService),exports[_0x49349e(0x1a8)]=OfficialService;