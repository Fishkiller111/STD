'use strict';const _0x54e8b3=_0x3e6f;(function(_0x1c07f8,_0x9f67d3){const _0x30c85c=_0x3e6f,_0x56d97b=_0x1c07f8();while(!![]){try{const _0x28a2a1=-parseInt(_0x30c85c(0x1ca))/0x1+-parseInt(_0x30c85c(0x190))/0x2+-parseInt(_0x30c85c(0x184))/0x3*(-parseInt(_0x30c85c(0x17d))/0x4)+parseInt(_0x30c85c(0x17c))/0x5*(parseInt(_0x30c85c(0x178))/0x6)+parseInt(_0x30c85c(0x1c0))/0x7*(-parseInt(_0x30c85c(0x18a))/0x8)+-parseInt(_0x30c85c(0x1ac))/0x9*(-parseInt(_0x30c85c(0x1bc))/0xa)+-parseInt(_0x30c85c(0x1a1))/0xb*(-parseInt(_0x30c85c(0x18b))/0xc);if(_0x28a2a1===_0x9f67d3)break;else _0x56d97b['push'](_0x56d97b['shift']());}catch(_0x1bb02e){_0x56d97b['push'](_0x56d97b['shift']());}}}(_0x2826,0xede60));function _0x2826(){const _0x5e1e08=['saveRecordRechargeLog','queryAllCrami','user','object','delPackage','cramiEntity','code','当前套餐下存在卡密、请先删除卡密后才可删除套餐！','batchDelCrami','6NnfwIE','UserEntity','LessThanOrEqual','map','4642215GxStDf','574972umqOQA','./cramiPackage.entity','userEntity','defineProperty','当前卡密已被使用、已使用的卡密禁止删除！','every','findOne','18PVXyto','name','error:\x20','createPackage','InjectRepository','assign','10152MdlJgz','4160868YcsfuB','generateCramiCode','RechargeType','CramiPackageEntity','log','2789556swBnmh','createCrami','当前卡密不存在、请确认您要删除的卡密是否存在！','updatePackage','BAD_REQUEST','../../common/utils','role','push','find','queryOnePackage','__metadata','create','Injectable','PACKAGE_GIFT','super','cramiPackageEntity','HttpStatus','44PFmONe','useCrami','删除卡密成功！','length','当前套餐不存在、请确认您选择的套餐是否存在！','CramiEntity','更新套餐失败、请重试！','更新套餐成功！','当前套餐不存在、请检查你的输入参数！','delete','useId','874143ZKHDNx','userBalanceService','function','DESC','maskEmail','Not','delCrami','findAndCount','@nestjs/common','affected','../userBalance/userBalance.service','Repository','update','@nestjs/typeorm','删除卡密失败、请重试！','CramiService','170djRdFK','UserBalanceService','maskCrami','使用卡密成功','10430MNmSjc','getOwnPropertyDescriptor','typeorm','count','HttpException','当前卡密已被使用、请确认您输入的卡密是否正确！','../../common/constants/balance.constant','套餐名称或套餐等级重复、请检查！','metadata','status','568996zluFXM','__param','username','../user/user.entity','email','packageId','generateCrami','__esModule','forEach','decorate'];_0x2826=function(){return _0x5e1e08;};return _0x2826();}var __decorate=this&&this['__decorate']||function(_0x102e39,_0x287de0,_0x2a5b5b,_0x3c2b35){const _0x27e74f=_0x3e6f;var _0x4760a8=arguments[_0x27e74f(0x1a4)],_0x7f315c=_0x4760a8<0x3?_0x287de0:_0x3c2b35===null?_0x3c2b35=Object[_0x27e74f(0x1c1)](_0x287de0,_0x2a5b5b):_0x3c2b35,_0x527d3b;if(typeof Reflect===_0x27e74f(0x1d7)&&typeof Reflect['decorate']===_0x27e74f(0x1ae))_0x7f315c=Reflect[_0x27e74f(0x1d3)](_0x102e39,_0x287de0,_0x2a5b5b,_0x3c2b35);else{for(var _0x28ef28=_0x102e39[_0x27e74f(0x1a4)]-0x1;_0x28ef28>=0x0;_0x28ef28--)if(_0x527d3b=_0x102e39[_0x28ef28])_0x7f315c=(_0x4760a8<0x3?_0x527d3b(_0x7f315c):_0x4760a8>0x3?_0x527d3b(_0x287de0,_0x2a5b5b,_0x7f315c):_0x527d3b(_0x287de0,_0x2a5b5b))||_0x7f315c;}return _0x4760a8>0x3&&_0x7f315c&&Object[_0x27e74f(0x180)](_0x287de0,_0x2a5b5b,_0x7f315c),_0x7f315c;},__metadata=this&&this[_0x54e8b3(0x19a)]||function(_0x2d7194,_0x5c3ad0){const _0x417652=_0x54e8b3;if(typeof Reflect===_0x417652(0x1d7)&&typeof Reflect['metadata']===_0x417652(0x1ae))return Reflect[_0x417652(0x1c8)](_0x2d7194,_0x5c3ad0);},__param=this&&this[_0x54e8b3(0x1cb)]||function(_0x21e2f5,_0x17a8ab){return function(_0x47d015,_0x6034eb){_0x17a8ab(_0x47d015,_0x6034eb,_0x21e2f5);};};function _0x3e6f(_0x36b21e,_0x4feb36){const _0x282684=_0x2826();return _0x3e6f=function(_0x3e6f24,_0x15bbb0){_0x3e6f24=_0x3e6f24-0x175;let _0x28bcab=_0x282684[_0x3e6f24];return _0x28bcab;},_0x3e6f(_0x36b21e,_0x4feb36);}Object[_0x54e8b3(0x180)](exports,_0x54e8b3(0x1d1),{'value':!![]}),exports[_0x54e8b3(0x1bb)]=void 0x0;const common_1=require(_0x54e8b3(0x1b4)),crami_entity_1=require('./crami.entity'),typeorm_1=require(_0x54e8b3(0x1b9)),typeorm_2=require(_0x54e8b3(0x1c2)),cramiPackage_entity_1=require(_0x54e8b3(0x17e)),utils_1=require(_0x54e8b3(0x195)),user_entity_1=require(_0x54e8b3(0x1cd)),userBalance_service_1=require(_0x54e8b3(0x1b6)),balance_constant_1=require(_0x54e8b3(0x1c6));let CramiService=class CramiService{constructor(_0x176de7,_0x1e36ba,_0x1841fb,_0x2705c8){const _0x546a61=_0x54e8b3;this['cramiEntity']=_0x176de7,this[_0x546a61(0x19f)]=_0x1e36ba,this['userEntity']=_0x1841fb,this[_0x546a61(0x1ad)]=_0x2705c8;}async[_0x54e8b3(0x199)](_0x22f5c0){const _0x3af15d=_0x54e8b3;return await this[_0x3af15d(0x19f)][_0x3af15d(0x183)]({'where':{'id':_0x22f5c0}});}async['queryAllPackage'](_0x43500c){const _0x29e697=_0x54e8b3;try{const {page:page=0x1,size:size=0xa,name:_0x2c57a8,status:_0x4e0885,type:_0x39ee08}=_0x43500c,_0x4935ba={};_0x2c57a8&&Object[_0x29e697(0x189)](_0x4935ba,{'name':(0x0,typeorm_2['Like'])('%'+_0x2c57a8+'%')}),_0x4e0885&&Object['assign'](_0x4935ba,{'status':_0x4e0885});_0x39ee08&&(_0x39ee08>0x0?Object[_0x29e697(0x189)](_0x4935ba,{'days':(0x0,typeorm_2['MoreThan'])(0x0)}):Object[_0x29e697(0x189)](_0x4935ba,{'days':(0x0,typeorm_2[_0x29e697(0x17a)])(0x0)}));const [_0x213917,_0x208e91]=await this['cramiPackageEntity'][_0x29e697(0x1b3)]({'skip':(page-0x1)*size,'take':size,'where':_0x4935ba,'order':{'order':_0x29e697(0x1af)}});return{'rows':_0x213917,'count':_0x208e91};}catch(_0x521bf8){console[_0x29e697(0x18f)](_0x29e697(0x186),_0x521bf8);}}async[_0x54e8b3(0x187)](_0x485a07){const _0x25fd0b=_0x54e8b3,{name:_0x78976a,weight:_0x10fa19}=_0x485a07,_0x10229e=await this['cramiPackageEntity'][_0x25fd0b(0x183)]({'where':[{'name':_0x78976a},{'weight':_0x10fa19}]});if(_0x10229e)throw new common_1['HttpException'](_0x25fd0b(0x1c7),common_1[_0x25fd0b(0x1a0)][_0x25fd0b(0x194)]);try{return await this[_0x25fd0b(0x19f)]['save'](_0x485a07);}catch(_0x14992f){console[_0x25fd0b(0x18f)]('error:\x20',_0x14992f);throw new common_1['HttpException'](_0x14992f,common_1[_0x25fd0b(0x1a0)]['BAD_REQUEST']);}}async[_0x54e8b3(0x193)](_0x1155cb){const _0x2cfa65=_0x54e8b3,{id:_0x41f54e,name:_0x140a2f,weight:_0x59c027}=_0x1155cb,_0xa181d8=await this[_0x2cfa65(0x19f)][_0x2cfa65(0x183)]({'where':{'id':_0x41f54e}});if(!_0xa181d8)throw new common_1[(_0x2cfa65(0x1c4))](_0x2cfa65(0x1a9),common_1['HttpStatus']['BAD_REQUEST']);const _0x54fbad=await this[_0x2cfa65(0x19f)][_0x2cfa65(0x1c3)]({'where':[{'name':_0x140a2f,'id':(0x0,typeorm_2[_0x2cfa65(0x1b1)])(_0x41f54e)},{'weight':_0x59c027,'id':(0x0,typeorm_2[_0x2cfa65(0x1b1)])(_0x41f54e)}]});if(_0x54fbad)throw new common_1[(_0x2cfa65(0x1c4))](_0x2cfa65(0x1c7),common_1[_0x2cfa65(0x1a0)]['BAD_REQUEST']);const _0x598312=await this[_0x2cfa65(0x19f)][_0x2cfa65(0x1b8)]({'id':_0x41f54e},_0x1155cb);if(_0x598312[_0x2cfa65(0x1b5)]>0x0)return _0x2cfa65(0x1a8);else throw new common_1[(_0x2cfa65(0x1c4))](_0x2cfa65(0x1a7),common_1['HttpStatus']['BAD_REQUEST']);}async[_0x54e8b3(0x1d8)](_0x2191a){const _0x5ac554=_0x54e8b3,{id:_0x2e8699}=_0x2191a,_0x5a6b85=await this['cramiEntity']['count']({'where':{'packageId':_0x2e8699}});if(_0x5a6b85)throw new common_1['HttpException'](_0x5ac554(0x176),common_1[_0x5ac554(0x1a0)]['BAD_REQUEST']);return await this[_0x5ac554(0x19f)][_0x5ac554(0x1aa)]({'id':_0x2e8699});}async[_0x54e8b3(0x191)](_0xf792a){const _0x2a3bf0=_0x54e8b3,{packageId:_0x527d7c,count:count=0x1}=_0xf792a;if(_0x527d7c){const _0x2b93b5=await this[_0x2a3bf0(0x19f)][_0x2a3bf0(0x183)]({'where':{'id':_0x527d7c}});if(!_0x2b93b5)throw new common_1[(_0x2a3bf0(0x1c4))](_0x2a3bf0(0x1a5),common_1[_0x2a3bf0(0x1a0)][_0x2a3bf0(0x194)]);const {days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x2b93b5,_0x396707={'packageId':_0x527d7c,'days':days,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this['generateCrami'](_0x396707,count);}if(!_0x527d7c){const {model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0xf792a;if([model3Count,model4Count,drawMjCount][_0x2a3bf0(0x182)](_0x549b91=>!_0x549b91))throw new common_1['HttpException']('自定义卡密必须至少一项余额不为0️零！',common_1['HttpStatus']['BAD_REQUEST']);const _0x29c10b={'days':-0x1,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0x2a3bf0(0x1d0)](_0x29c10b,count);}}async[_0x54e8b3(0x1d0)](_0x1045e3,_0x3c5de9){const _0x437d24=_0x54e8b3,_0x2e2b00=[];for(let _0x29d67=0x0;_0x29d67<_0x3c5de9;_0x29d67++){const _0x5f398d=(0x0,utils_1[_0x437d24(0x18c)])(),_0x4c8cf1=this[_0x437d24(0x1d9)][_0x437d24(0x19b)](Object['assign'](Object[_0x437d24(0x189)]({},_0x1045e3),{'code':_0x5f398d}));_0x2e2b00[_0x437d24(0x197)](_0x4c8cf1);}return await this['cramiEntity']['save'](_0x2e2b00);}async[_0x54e8b3(0x1a2)](_0x2ab3d0,_0x4ddac0){const _0xa4d266=_0x54e8b3,{id:_0x14efb9}=_0x2ab3d0[_0xa4d266(0x1d6)],_0x592ae2=await this['cramiEntity'][_0xa4d266(0x183)]({'where':{'code':_0x4ddac0[_0xa4d266(0x175)]}});if(!_0x592ae2)throw new common_1[(_0xa4d266(0x1c4))]('当前卡密不存在、请确认您输入的卡密是否正确！',common_1[_0xa4d266(0x1a0)][_0xa4d266(0x194)]);const {status:_0x2cd48c,days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0,packageId:_0x3ae99f}=_0x592ae2;if(_0x2cd48c===0x1)throw new common_1[(_0xa4d266(0x1c4))](_0xa4d266(0x1c5),common_1[_0xa4d266(0x1a0)][_0xa4d266(0x194)]);const _0x4b5342={'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'packageId':_0x3ae99f};return await this[_0xa4d266(0x1ad)]['addBalanceToUser'](_0x14efb9,Object[_0xa4d266(0x189)]({},_0x4b5342),days),await this[_0xa4d266(0x1ad)][_0xa4d266(0x1d4)]({'userId':_0x14efb9,'rechargeType':balance_constant_1[_0xa4d266(0x18d)][_0xa4d266(0x19d)],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'days':days}),await this['cramiEntity'][_0xa4d266(0x1b8)]({'code':_0x4ddac0[_0xa4d266(0x175)]},{'useId':_0x14efb9,'status':0x1}),_0xa4d266(0x1bf);}async[_0x54e8b3(0x1d5)](_0x35b1dc,_0x3984c7){const _0x4e9208=_0x54e8b3,{page:page=0x1,size:size=0xa,status:_0x38399e,useId:_0xf26e53}=_0x35b1dc,_0x16f565={};_0x38399e&&Object[_0x4e9208(0x189)](_0x16f565,{'status':_0x38399e}),_0xf26e53&&Object[_0x4e9208(0x189)](_0x16f565,{'useId':_0xf26e53});const [_0x3131e4,_0x3aa172]=await this[_0x4e9208(0x1d9)]['findAndCount']({'skip':(page-0x1)*size,'take':size,'order':{'createdAt':_0x4e9208(0x1af)},'where':_0x16f565}),_0x221287=_0x3131e4['map'](_0xf07497=>_0xf07497[_0x4e9208(0x1ab)]),_0x4cdf75=_0x3131e4[_0x4e9208(0x17b)](_0x17abe3=>_0x17abe3[_0x4e9208(0x1cf)]),_0x409f82=await this[_0x4e9208(0x17f)][_0x4e9208(0x198)]({'where':{'id':(0x0,typeorm_2['In'])(_0x221287)}}),_0x2df834=await this[_0x4e9208(0x19f)][_0x4e9208(0x198)]({'where':{'id':(0x0,typeorm_2['In'])(_0x4cdf75)}});return _0x3131e4[_0x4e9208(0x1d2)](_0xe5fdcb=>{const _0x4c853f=_0x4e9208;var _0x557da4,_0x3e5927,_0x4a13d4;_0xe5fdcb['username']=(_0x557da4=_0x409f82[_0x4c853f(0x198)](_0x1ae94f=>_0x1ae94f['id']===_0xe5fdcb[_0x4c853f(0x1ab)]))===null||_0x557da4===void 0x0?void 0x0:_0x557da4[_0x4c853f(0x1cc)],_0xe5fdcb[_0x4c853f(0x1ce)]=(_0x3e5927=_0x409f82[_0x4c853f(0x198)](_0x33327f=>_0x33327f['id']===_0xe5fdcb[_0x4c853f(0x1ab)]))===null||_0x3e5927===void 0x0?void 0x0:_0x3e5927['email'],_0xe5fdcb['packageName']=(_0x4a13d4=_0x2df834[_0x4c853f(0x198)](_0x1c23c6=>_0x1c23c6['id']===_0xe5fdcb[_0x4c853f(0x1cf)]))===null||_0x4a13d4===void 0x0?void 0x0:_0x4a13d4[_0x4c853f(0x185)];}),_0x3984c7['user'][_0x4e9208(0x196)]!==_0x4e9208(0x19e)&&_0x3131e4[_0x4e9208(0x1d2)](_0x4b77ab=>_0x4b77ab[_0x4e9208(0x1ce)]=(0x0,utils_1[_0x4e9208(0x1b0)])(_0x4b77ab[_0x4e9208(0x1ce)])),_0x3984c7['user'][_0x4e9208(0x196)]!=='super'&&_0x3131e4[_0x4e9208(0x1d2)](_0x58cfc1=>_0x58cfc1['code']=(0x0,utils_1[_0x4e9208(0x1be)])(_0x58cfc1[_0x4e9208(0x175)])),{'rows':_0x3131e4,'count':_0x3aa172};}async[_0x54e8b3(0x1b2)](_0x2a942e){const _0x119326=_0x54e8b3,_0x350bd7=await this[_0x119326(0x1d9)]['findOne']({'where':{'id':_0x2a942e}});if(!_0x350bd7)throw new common_1[(_0x119326(0x1c4))](_0x119326(0x192),common_1[_0x119326(0x1a0)]['BAD_REQUEST']);if(_0x350bd7[_0x119326(0x1c9)]===0x1)throw new common_1[(_0x119326(0x1c4))](_0x119326(0x181),common_1[_0x119326(0x1a0)][_0x119326(0x194)]);return await this['cramiEntity'][_0x119326(0x1aa)]({'id':_0x2a942e});}async[_0x54e8b3(0x177)](_0x110840){const _0x2c991f=_0x54e8b3,{ids:_0x570fb6}=_0x110840,_0x4990a0=await this['cramiEntity'][_0x2c991f(0x1aa)](_0x570fb6);if(_0x4990a0[_0x2c991f(0x1b5)]>0x0)return _0x2c991f(0x1a3);else throw new common_1['HttpException'](_0x2c991f(0x1ba),common_1['HttpStatus'][_0x2c991f(0x194)]);}};CramiService=__decorate([(0x0,common_1[_0x54e8b3(0x19c)])(),__param(0x0,(0x0,typeorm_1[_0x54e8b3(0x188)])(crami_entity_1[_0x54e8b3(0x1a6)])),__param(0x1,(0x0,typeorm_1[_0x54e8b3(0x188)])(cramiPackage_entity_1[_0x54e8b3(0x18e)])),__param(0x2,(0x0,typeorm_1[_0x54e8b3(0x188)])(user_entity_1[_0x54e8b3(0x179)])),__metadata('design:paramtypes',[typeorm_2[_0x54e8b3(0x1b7)],typeorm_2['Repository'],typeorm_2[_0x54e8b3(0x1b7)],userBalance_service_1[_0x54e8b3(0x1bd)]])],CramiService),exports[_0x54e8b3(0x1bb)]=CramiService;