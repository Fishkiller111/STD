'use strict';const _0xe69c7f=_0x5767;(function(_0x32f70b,_0x2ed6df){const _0x2461fa=_0x5767,_0x412cfe=_0x32f70b();while(!![]){try{const _0x1ec093=-parseInt(_0x2461fa(0x1de))/0x1*(-parseInt(_0x2461fa(0x1e2))/0x2)+-parseInt(_0x2461fa(0x1c0))/0x3*(parseInt(_0x2461fa(0x1bf))/0x4)+parseInt(_0x2461fa(0x219))/0x5*(-parseInt(_0x2461fa(0x203))/0x6)+parseInt(_0x2461fa(0x1fe))/0x7+parseInt(_0x2461fa(0x202))/0x8*(-parseInt(_0x2461fa(0x1c3))/0x9)+parseInt(_0x2461fa(0x207))/0xa*(parseInt(_0x2461fa(0x1c5))/0xb)+-parseInt(_0x2461fa(0x1c6))/0xc*(-parseInt(_0x2461fa(0x1f7))/0xd);if(_0x1ec093===_0x2ed6df)break;else _0x412cfe['push'](_0x412cfe['shift']());}catch(_0x53a9fd){_0x412cfe['push'](_0x412cfe['shift']());}}}(_0x3e3f,0x9a5f9));function _0x5767(_0x2d2c35,_0x1eb78a){const _0x3e3fe4=_0x3e3f();return _0x5767=function(_0x576759,_0x15bb67){_0x576759=_0x576759-0x1bc;let _0x134533=_0x3e3fe4[_0x576759];return _0x134533;},_0x5767(_0x2d2c35,_0x1eb78a);}var __decorate=this&&this[_0xe69c7f(0x1bd)]||function(_0x13cf2b,_0x3ecdd8,_0x44784b,_0x2d5682){const _0x47f799=_0xe69c7f;var _0x40d75d=arguments['length'],_0x4d834b=_0x40d75d<0x3?_0x3ecdd8:_0x2d5682===null?_0x2d5682=Object[_0x47f799(0x1f4)](_0x3ecdd8,_0x44784b):_0x2d5682,_0x14b5de;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x47f799(0x1e0))_0x4d834b=Reflect[_0x47f799(0x1cc)](_0x13cf2b,_0x3ecdd8,_0x44784b,_0x2d5682);else{for(var _0x305e85=_0x13cf2b[_0x47f799(0x1d7)]-0x1;_0x305e85>=0x0;_0x305e85--)if(_0x14b5de=_0x13cf2b[_0x305e85])_0x4d834b=(_0x40d75d<0x3?_0x14b5de(_0x4d834b):_0x40d75d>0x3?_0x14b5de(_0x3ecdd8,_0x44784b,_0x4d834b):_0x14b5de(_0x3ecdd8,_0x44784b))||_0x4d834b;}return _0x40d75d>0x3&&_0x4d834b&&Object[_0x47f799(0x1e8)](_0x3ecdd8,_0x44784b,_0x4d834b),_0x4d834b;},__metadata=this&&this['__metadata']||function(_0x16b482,_0x28d818){const _0x424f53=_0xe69c7f;if(typeof Reflect===_0x424f53(0x1e1)&&typeof Reflect[_0x424f53(0x1fb)]===_0x424f53(0x1e0))return Reflect[_0x424f53(0x1fb)](_0x16b482,_0x28d818);},__param=this&&this['__param']||function(_0x70044b,_0x3a0380){return function(_0x48aade,_0x4fd15c){_0x3a0380(_0x48aade,_0x4fd15c,_0x70044b);};};Object['defineProperty'](exports,_0xe69c7f(0x1d0),{'value':!![]}),exports[_0xe69c7f(0x1e7)]=void 0x0;function _0x3e3f(){const _0x422266=['套餐名称或套餐等级重复、请检查！','packageId','length','HttpStatus','cramiPackageEntity','update','删除卡密失败、请重试！','username','Injectable','135193IrqKbd','every','function','object','12dCYOoT','packageName','userBalanceService','BAD_REQUEST','当前卡密已被使用、请确认您输入的卡密是否正确！','CramiService','defineProperty','delCrami','当前卡密已被使用、已使用的卡密禁止删除！','maskCrami','save','useCrami','queryOnePackage','MoreThan','删除卡密成功！','@nestjs/common','使用卡密成功','forEach','getOwnPropertyDescriptor','super','createPackage','13arlkhz','./cramiPackage.entity','code','user','metadata','../../common/utils','DESC','4519620WUBdou','Not','addBalanceToUser','useId','2395408YdyiVJ','12slPOYF','queryAllCrami','../../common/constants/balance.constant','userEntity','653190EpobHp','createCrami','findOne','maskEmail','batchDelCrami','../user/user.entity','map','delete','role','当前卡密不存在、请确认您输入的卡密是否正确！','Repository','generateCrami','自定义卡密必须至少一项余额不为0️零！','queryAllPackage','HttpException','cramiEntity','Like','error:\x20','726295PsiJyl','count','assign','email','RechargeType','design:paramtypes','CramiEntity','__decorate','当前套餐不存在、请确认您选择的套餐是否存在！','841612loNTlp','3IzPuBS','当前套餐下存在卡密、请先删除卡密后才可删除套餐！','findAndCount','36blgNtZ','log','33HuAlcO','8137956xVAvMj','create','更新套餐失败、请重试！','当前套餐不存在、请检查你的输入参数！','affected','../userBalance/userBalance.service','decorate','UserBalanceService','saveRecordRechargeLog','find','__esModule','@nestjs/typeorm','CramiPackageEntity','UserEntity','delPackage'];_0x3e3f=function(){return _0x422266;};return _0x3e3f();}const common_1=require(_0xe69c7f(0x1f1)),crami_entity_1=require('./crami.entity'),typeorm_1=require(_0xe69c7f(0x1d1)),typeorm_2=require('typeorm'),cramiPackage_entity_1=require(_0xe69c7f(0x1f8)),utils_1=require(_0xe69c7f(0x1fc)),user_entity_1=require(_0xe69c7f(0x20c)),userBalance_service_1=require(_0xe69c7f(0x1cb)),balance_constant_1=require(_0xe69c7f(0x205));let CramiService=class CramiService{constructor(_0x150b86,_0x23c957,_0x494254,_0x4cd03e){const _0x4a2363=_0xe69c7f;this[_0x4a2363(0x216)]=_0x150b86,this[_0x4a2363(0x1d9)]=_0x23c957,this[_0x4a2363(0x206)]=_0x494254,this[_0x4a2363(0x1e4)]=_0x4cd03e;}async[_0xe69c7f(0x1ee)](_0x3e2aa5){const _0x561a40=_0xe69c7f;return await this[_0x561a40(0x1d9)]['findOne']({'where':{'id':_0x3e2aa5}});}async[_0xe69c7f(0x214)](_0x310e88){const _0x528df5=_0xe69c7f;try{const {page:page=0x1,size:size=0xa,name:_0x185ef4,status:_0x25a1f4,type:_0x33d4ea}=_0x310e88,_0x40556a={};_0x185ef4&&Object['assign'](_0x40556a,{'name':(0x0,typeorm_2[_0x528df5(0x217)])('%'+_0x185ef4+'%')}),_0x25a1f4&&Object[_0x528df5(0x21b)](_0x40556a,{'status':_0x25a1f4});_0x33d4ea&&(_0x33d4ea>0x0?Object[_0x528df5(0x21b)](_0x40556a,{'days':(0x0,typeorm_2[_0x528df5(0x1ef)])(0x0)}):Object['assign'](_0x40556a,{'days':(0x0,typeorm_2['LessThanOrEqual'])(0x0)}));const [_0x5c6eb4,_0x786f1]=await this[_0x528df5(0x1d9)][_0x528df5(0x1c2)]({'skip':(page-0x1)*size,'take':size,'where':_0x40556a,'order':{'order':_0x528df5(0x1fd)}});return{'rows':_0x5c6eb4,'count':_0x786f1};}catch(_0x59eed9){console['log'](_0x528df5(0x218),_0x59eed9);}}async[_0xe69c7f(0x1f6)](_0x3e6ba0){const _0x2108a6=_0xe69c7f,{name:_0x541311,weight:_0x1f4f5d}=_0x3e6ba0,_0x4e423b=await this[_0x2108a6(0x1d9)][_0x2108a6(0x209)]({'where':[{'name':_0x541311},{'weight':_0x1f4f5d}]});if(_0x4e423b)throw new common_1['HttpException'](_0x2108a6(0x1d5),common_1[_0x2108a6(0x1d8)][_0x2108a6(0x1e5)]);try{return await this[_0x2108a6(0x1d9)][_0x2108a6(0x1ec)](_0x3e6ba0);}catch(_0x9f2f58){console[_0x2108a6(0x1c4)](_0x2108a6(0x218),_0x9f2f58);throw new common_1[(_0x2108a6(0x215))](_0x9f2f58,common_1[_0x2108a6(0x1d8)][_0x2108a6(0x1e5)]);}}async['updatePackage'](_0x245e6c){const _0x33b000=_0xe69c7f,{id:_0x193ac6,name:_0x5a9cf6,weight:_0x34a0e1}=_0x245e6c,_0x87124d=await this[_0x33b000(0x1d9)]['findOne']({'where':{'id':_0x193ac6}});if(!_0x87124d)throw new common_1['HttpException'](_0x33b000(0x1c9),common_1[_0x33b000(0x1d8)]['BAD_REQUEST']);const _0x3a0084=await this[_0x33b000(0x1d9)][_0x33b000(0x21a)]({'where':[{'name':_0x5a9cf6,'id':(0x0,typeorm_2[_0x33b000(0x1ff)])(_0x193ac6)},{'weight':_0x34a0e1,'id':(0x0,typeorm_2[_0x33b000(0x1ff)])(_0x193ac6)}]});if(_0x3a0084)throw new common_1[(_0x33b000(0x215))](_0x33b000(0x1d5),common_1['HttpStatus'][_0x33b000(0x1e5)]);const _0x7c20c5=await this['cramiPackageEntity'][_0x33b000(0x1da)]({'id':_0x193ac6},_0x245e6c);if(_0x7c20c5[_0x33b000(0x1ca)]>0x0)return'更新套餐成功！';else throw new common_1[(_0x33b000(0x215))](_0x33b000(0x1c8),common_1[_0x33b000(0x1d8)][_0x33b000(0x1e5)]);}async[_0xe69c7f(0x1d4)](_0x5e33d8){const _0x1262c7=_0xe69c7f,{id:_0x749d76}=_0x5e33d8,_0x60fb45=await this[_0x1262c7(0x216)][_0x1262c7(0x21a)]({'where':{'packageId':_0x749d76}});if(_0x60fb45)throw new common_1['HttpException'](_0x1262c7(0x1c1),common_1[_0x1262c7(0x1d8)][_0x1262c7(0x1e5)]);return await this[_0x1262c7(0x1d9)][_0x1262c7(0x20e)]({'id':_0x749d76});}async[_0xe69c7f(0x208)](_0x2c6c20){const _0xc3231e=_0xe69c7f,{packageId:_0x3fbe9e,count:count=0x1}=_0x2c6c20;if(_0x3fbe9e){const _0x44e65b=await this[_0xc3231e(0x1d9)]['findOne']({'where':{'id':_0x3fbe9e}});if(!_0x44e65b)throw new common_1[(_0xc3231e(0x215))](_0xc3231e(0x1be),common_1[_0xc3231e(0x1d8)]['BAD_REQUEST']);const {days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x44e65b,_0x420940={'packageId':_0x3fbe9e,'days':days,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0xc3231e(0x212)](_0x420940,count);}if(!_0x3fbe9e){const {model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x2c6c20;if([model3Count,model4Count,drawMjCount][_0xc3231e(0x1df)](_0xbffd90=>!_0xbffd90))throw new common_1[(_0xc3231e(0x215))](_0xc3231e(0x213),common_1[_0xc3231e(0x1d8)][_0xc3231e(0x1e5)]);const _0x17bf24={'days':-0x1,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0xc3231e(0x212)](_0x17bf24,count);}}async['generateCrami'](_0x3e573f,_0x58e9d5){const _0xcc2be2=_0xe69c7f,_0x50f699=[];for(let _0x2004d6=0x0;_0x2004d6<_0x58e9d5;_0x2004d6++){const _0x386cf7=(0x0,utils_1['generateCramiCode'])(),_0x223eff=this[_0xcc2be2(0x216)][_0xcc2be2(0x1c7)](Object[_0xcc2be2(0x21b)](Object[_0xcc2be2(0x21b)]({},_0x3e573f),{'code':_0x386cf7}));_0x50f699['push'](_0x223eff);}return await this[_0xcc2be2(0x216)][_0xcc2be2(0x1ec)](_0x50f699);}async[_0xe69c7f(0x1ed)](_0x388530,_0x2aa829){const _0x4f35bf=_0xe69c7f,{id:_0x3ad52c}=_0x388530['user'],_0x30ec34=await this[_0x4f35bf(0x216)][_0x4f35bf(0x209)]({'where':{'code':_0x2aa829[_0x4f35bf(0x1f9)]}});if(!_0x30ec34)throw new common_1[(_0x4f35bf(0x215))](_0x4f35bf(0x210),common_1[_0x4f35bf(0x1d8)][_0x4f35bf(0x1e5)]);const {status:_0x4a7dba,days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0,packageId:_0x1d53d5}=_0x30ec34;if(_0x4a7dba===0x1)throw new common_1[(_0x4f35bf(0x215))](_0x4f35bf(0x1e6),common_1[_0x4f35bf(0x1d8)][_0x4f35bf(0x1e5)]);const _0x4a7a89={'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'packageId':_0x1d53d5};return await this[_0x4f35bf(0x1e4)][_0x4f35bf(0x200)](_0x3ad52c,Object[_0x4f35bf(0x21b)]({},_0x4a7a89),days),await this['userBalanceService'][_0x4f35bf(0x1ce)]({'userId':_0x3ad52c,'rechargeType':balance_constant_1[_0x4f35bf(0x21d)]['PACKAGE_GIFT'],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'days':days}),await this[_0x4f35bf(0x216)][_0x4f35bf(0x1da)]({'code':_0x2aa829['code']},{'useId':_0x3ad52c,'status':0x1}),_0x4f35bf(0x1f2);}async[_0xe69c7f(0x204)](_0x21ac22,_0x4f5e5c){const _0x535020=_0xe69c7f,{page:page=0x1,size:size=0xa,status:_0x3d2a96,useId:_0x5add3a}=_0x21ac22,_0x459bbd={};_0x3d2a96&&Object[_0x535020(0x21b)](_0x459bbd,{'status':_0x3d2a96}),_0x5add3a&&Object[_0x535020(0x21b)](_0x459bbd,{'useId':_0x5add3a});const [_0x24fb41,_0x4a6d48]=await this[_0x535020(0x216)]['findAndCount']({'skip':(page-0x1)*size,'take':size,'order':{'createdAt':_0x535020(0x1fd)},'where':_0x459bbd}),_0x17bc0d=_0x24fb41[_0x535020(0x20d)](_0x34a874=>_0x34a874[_0x535020(0x201)]),_0x230e52=_0x24fb41[_0x535020(0x20d)](_0x32ad0a=>_0x32ad0a['packageId']),_0x28a821=await this[_0x535020(0x206)][_0x535020(0x1cf)]({'where':{'id':(0x0,typeorm_2['In'])(_0x17bc0d)}}),_0x274b12=await this['cramiPackageEntity'][_0x535020(0x1cf)]({'where':{'id':(0x0,typeorm_2['In'])(_0x230e52)}});return _0x24fb41['forEach'](_0x367a7c=>{const _0x2f3e67=_0x535020;var _0x461d6a,_0x5c837f,_0x22bf63;_0x367a7c['username']=(_0x461d6a=_0x28a821[_0x2f3e67(0x1cf)](_0x4d853f=>_0x4d853f['id']===_0x367a7c['useId']))===null||_0x461d6a===void 0x0?void 0x0:_0x461d6a[_0x2f3e67(0x1dc)],_0x367a7c[_0x2f3e67(0x21c)]=(_0x5c837f=_0x28a821['find'](_0x416328=>_0x416328['id']===_0x367a7c[_0x2f3e67(0x201)]))===null||_0x5c837f===void 0x0?void 0x0:_0x5c837f[_0x2f3e67(0x21c)],_0x367a7c[_0x2f3e67(0x1e3)]=(_0x22bf63=_0x274b12['find'](_0x3251bc=>_0x3251bc['id']===_0x367a7c[_0x2f3e67(0x1d6)]))===null||_0x22bf63===void 0x0?void 0x0:_0x22bf63['name'];}),_0x4f5e5c[_0x535020(0x1fa)][_0x535020(0x20f)]!==_0x535020(0x1f5)&&_0x24fb41[_0x535020(0x1f3)](_0xc52e52=>_0xc52e52[_0x535020(0x21c)]=(0x0,utils_1[_0x535020(0x20a)])(_0xc52e52[_0x535020(0x21c)])),_0x4f5e5c['user'][_0x535020(0x20f)]!==_0x535020(0x1f5)&&_0x24fb41[_0x535020(0x1f3)](_0xbc8d44=>_0xbc8d44['code']=(0x0,utils_1[_0x535020(0x1eb)])(_0xbc8d44[_0x535020(0x1f9)])),{'rows':_0x24fb41,'count':_0x4a6d48};}async[_0xe69c7f(0x1e9)](_0x23d5ed){const _0x12b4fa=_0xe69c7f,_0x5c8c37=await this['cramiEntity'][_0x12b4fa(0x209)]({'where':{'id':_0x23d5ed}});if(!_0x5c8c37)throw new common_1[(_0x12b4fa(0x215))]('当前卡密不存在、请确认您要删除的卡密是否存在！',common_1['HttpStatus'][_0x12b4fa(0x1e5)]);if(_0x5c8c37['status']===0x1)throw new common_1[(_0x12b4fa(0x215))](_0x12b4fa(0x1ea),common_1[_0x12b4fa(0x1d8)][_0x12b4fa(0x1e5)]);return await this[_0x12b4fa(0x216)][_0x12b4fa(0x20e)]({'id':_0x23d5ed});}async[_0xe69c7f(0x20b)](_0x30aa48){const _0x8f1ecc=_0xe69c7f,{ids:_0x46f5f5}=_0x30aa48,_0x4896c6=await this[_0x8f1ecc(0x216)][_0x8f1ecc(0x20e)](_0x46f5f5);if(_0x4896c6[_0x8f1ecc(0x1ca)]>0x0)return _0x8f1ecc(0x1f0);else throw new common_1[(_0x8f1ecc(0x215))](_0x8f1ecc(0x1db),common_1[_0x8f1ecc(0x1d8)][_0x8f1ecc(0x1e5)]);}};CramiService=__decorate([(0x0,common_1[_0xe69c7f(0x1dd)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(crami_entity_1[_0xe69c7f(0x1bc)])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(cramiPackage_entity_1[_0xe69c7f(0x1d2)])),__param(0x2,(0x0,typeorm_1['InjectRepository'])(user_entity_1[_0xe69c7f(0x1d3)])),__metadata(_0xe69c7f(0x21e),[typeorm_2[_0xe69c7f(0x211)],typeorm_2[_0xe69c7f(0x211)],typeorm_2[_0xe69c7f(0x211)],userBalance_service_1[_0xe69c7f(0x1cd)]])],CramiService),exports[_0xe69c7f(0x1e7)]=CramiService;