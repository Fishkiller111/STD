'use strict';const _0x620667=_0x27b8;(function(_0x1e1d83,_0x187b9e){const _0x5f2588=_0x27b8,_0x55508f=_0x1e1d83();while(!![]){try{const _0x57211e=parseInt(_0x5f2588(0x144))/0x1+parseInt(_0x5f2588(0x10f))/0x2*(parseInt(_0x5f2588(0x130))/0x3)+parseInt(_0x5f2588(0x11a))/0x4*(-parseInt(_0x5f2588(0x13c))/0x5)+parseInt(_0x5f2588(0x141))/0x6+-parseInt(_0x5f2588(0x11c))/0x7*(parseInt(_0x5f2588(0x13e))/0x8)+parseInt(_0x5f2588(0x11b))/0x9*(parseInt(_0x5f2588(0x113))/0xa)+parseInt(_0x5f2588(0x134))/0xb;if(_0x57211e===_0x187b9e)break;else _0x55508f['push'](_0x55508f['shift']());}catch(_0x1e5092){_0x55508f['push'](_0x55508f['shift']());}}}(_0xd52d,0xda060));function _0xd52d(){const _0x2be5bd=['64055skRqvD','更新套餐成功！','CramiService','../../common/utils','length','error:\x20','../userBalance/userBalance.service','packageId','queryAllPackage','saveRecordRechargeLog','username','forEach','useId','email','queryAllCrami','BAD_REQUEST','function','套餐名称或套餐等级重复、请检查！','useCrami','role','object','./crami.entity','当前卡密不存在、请确认您要删除的卡密是否存在！','queryOnePackage','InjectRepository','push','save','delCrami','affected','update','Repository','Not','every','DESC','__param','RechargeType','MoreThan','HttpStatus','CramiEntity','find','删除卡密成功！','metadata','defineProperty','640574zcFcjN','./cramiPackage.entity','delPackage','count','2824070fojWcE','../../common/constants/balance.constant','HttpException','__decorate','packageName','当前套餐不存在、请确认您选择的套餐是否存在！','maskEmail','1408900NRVVQD','27IAtIOq','49DMxkTD','delete','super','createPackage','cramiEntity','UserBalanceService','更新套餐失败、请重试！','map','assign','当前卡密已被使用、已使用的卡密禁止删除！','generateCrami','cramiPackageEntity','updatePackage','batchDelCrami','UserEntity','decorate','status','generateCramiCode','使用卡密成功','当前卡密已被使用、请确认您输入的卡密是否正确！','15ZUQSHd','getOwnPropertyDescriptor','findOne','Like','7673545KVTLBC','当前卡密不存在、请确认您输入的卡密是否正确！','LessThanOrEqual','addBalanceToUser','CramiPackageEntity','userBalanceService','PACKAGE_GIFT','findAndCount','10YJmRnl','log','1968632EHTQXq','Injectable','@nestjs/typeorm','658326dEVuNx','code','user'];_0xd52d=function(){return _0x2be5bd;};return _0xd52d();}var __decorate=this&&this[_0x620667(0x116)]||function(_0x24eb92,_0x11e1ba,_0x30aca6,_0x548d9c){const _0x2cae36=_0x620667;var _0x320876=arguments[_0x2cae36(0x148)],_0x2915a7=_0x320876<0x3?_0x11e1ba:_0x548d9c===null?_0x548d9c=Object[_0x2cae36(0x131)](_0x11e1ba,_0x30aca6):_0x548d9c,_0x56e8d5;if(typeof Reflect==='object'&&typeof Reflect[_0x2cae36(0x12b)]===_0x2cae36(0x154))_0x2915a7=Reflect[_0x2cae36(0x12b)](_0x24eb92,_0x11e1ba,_0x30aca6,_0x548d9c);else{for(var _0x586f8=_0x24eb92[_0x2cae36(0x148)]-0x1;_0x586f8>=0x0;_0x586f8--)if(_0x56e8d5=_0x24eb92[_0x586f8])_0x2915a7=(_0x320876<0x3?_0x56e8d5(_0x2915a7):_0x320876>0x3?_0x56e8d5(_0x11e1ba,_0x30aca6,_0x2915a7):_0x56e8d5(_0x11e1ba,_0x30aca6))||_0x2915a7;}return _0x320876>0x3&&_0x2915a7&&Object[_0x2cae36(0x10e)](_0x11e1ba,_0x30aca6,_0x2915a7),_0x2915a7;},__metadata=this&&this['__metadata']||function(_0x1c75c9,_0x39392f){const _0xcbc5cf=_0x620667;if(typeof Reflect===_0xcbc5cf(0x158)&&typeof Reflect['metadata']===_0xcbc5cf(0x154))return Reflect[_0xcbc5cf(0x10d)](_0x1c75c9,_0x39392f);},__param=this&&this[_0x620667(0x106)]||function(_0x328a50,_0x4889a3){return function(_0x91d63a,_0x52cb7c){_0x4889a3(_0x91d63a,_0x52cb7c,_0x328a50);};};Object[_0x620667(0x10e)](exports,'__esModule',{'value':!![]}),exports[_0x620667(0x146)]=void 0x0;const common_1=require('@nestjs/common'),crami_entity_1=require(_0x620667(0x159)),typeorm_1=require(_0x620667(0x140)),typeorm_2=require('typeorm'),cramiPackage_entity_1=require(_0x620667(0x110)),utils_1=require(_0x620667(0x147)),user_entity_1=require('../user/user.entity'),userBalance_service_1=require(_0x620667(0x14a)),balance_constant_1=require(_0x620667(0x114));let CramiService=class CramiService{constructor(_0x200420,_0x55586b,_0x6f702b,_0x41601d){const _0x45544e=_0x620667;this[_0x45544e(0x120)]=_0x200420,this['cramiPackageEntity']=_0x55586b,this['userEntity']=_0x6f702b,this[_0x45544e(0x139)]=_0x41601d;}async[_0x620667(0x15b)](_0x2eb500){const _0xa3728c=_0x620667;return await this[_0xa3728c(0x127)][_0xa3728c(0x132)]({'where':{'id':_0x2eb500}});}async[_0x620667(0x14c)](_0x5b490e){const _0x3ffee4=_0x620667;try{const {page:page=0x1,size:size=0xa,name:_0x3029ba,status:_0x3e2945,type:_0x51820c}=_0x5b490e,_0x447fbf={};_0x3029ba&&Object['assign'](_0x447fbf,{'name':(0x0,typeorm_2[_0x3ffee4(0x133)])('%'+_0x3029ba+'%')}),_0x3e2945&&Object[_0x3ffee4(0x124)](_0x447fbf,{'status':_0x3e2945});_0x51820c&&(_0x51820c>0x0?Object[_0x3ffee4(0x124)](_0x447fbf,{'days':(0x0,typeorm_2[_0x3ffee4(0x108)])(0x0)}):Object[_0x3ffee4(0x124)](_0x447fbf,{'days':(0x0,typeorm_2[_0x3ffee4(0x136)])(0x0)}));const [_0x256f27,_0x4e1ed5]=await this[_0x3ffee4(0x127)][_0x3ffee4(0x13b)]({'skip':(page-0x1)*size,'take':size,'where':_0x447fbf,'order':{'order':_0x3ffee4(0x105)}});return{'rows':_0x256f27,'count':_0x4e1ed5};}catch(_0x325ad6){console[_0x3ffee4(0x13d)](_0x3ffee4(0x149),_0x325ad6);}}async[_0x620667(0x11f)](_0x140299){const _0x36830a=_0x620667,{name:_0x10f652,weight:_0xb25845}=_0x140299,_0x17aa52=await this[_0x36830a(0x127)][_0x36830a(0x132)]({'where':[{'name':_0x10f652},{'weight':_0xb25845}]});if(_0x17aa52)throw new common_1[(_0x36830a(0x115))](_0x36830a(0x155),common_1[_0x36830a(0x109)][_0x36830a(0x153)]);try{return await this[_0x36830a(0x127)][_0x36830a(0x15e)](_0x140299);}catch(_0x327d94){console[_0x36830a(0x13d)](_0x36830a(0x149),_0x327d94);throw new common_1[(_0x36830a(0x115))](_0x327d94,common_1[_0x36830a(0x109)][_0x36830a(0x153)]);}}async[_0x620667(0x128)](_0x40aec9){const _0x3cae08=_0x620667,{id:_0x3b96de,name:_0x5d37c4,weight:_0x5cb0f8}=_0x40aec9,_0x3ff18e=await this['cramiPackageEntity'][_0x3cae08(0x132)]({'where':{'id':_0x3b96de}});if(!_0x3ff18e)throw new common_1[(_0x3cae08(0x115))]('当前套餐不存在、请检查你的输入参数！',common_1['HttpStatus'][_0x3cae08(0x153)]);const _0x34db5f=await this['cramiPackageEntity']['count']({'where':[{'name':_0x5d37c4,'id':(0x0,typeorm_2['Not'])(_0x3b96de)},{'weight':_0x5cb0f8,'id':(0x0,typeorm_2[_0x3cae08(0x103)])(_0x3b96de)}]});if(_0x34db5f)throw new common_1[(_0x3cae08(0x115))](_0x3cae08(0x155),common_1[_0x3cae08(0x109)][_0x3cae08(0x153)]);const _0xe5b2f7=await this[_0x3cae08(0x127)][_0x3cae08(0x101)]({'id':_0x3b96de},_0x40aec9);if(_0xe5b2f7[_0x3cae08(0x100)]>0x0)return _0x3cae08(0x145);else throw new common_1[(_0x3cae08(0x115))](_0x3cae08(0x122),common_1[_0x3cae08(0x109)]['BAD_REQUEST']);}async[_0x620667(0x111)](_0x430b2d){const _0x17219b=_0x620667,{id:_0x48c521}=_0x430b2d,_0x10d5ca=await this[_0x17219b(0x120)][_0x17219b(0x112)]({'where':{'packageId':_0x48c521}});if(_0x10d5ca)throw new common_1['HttpException']('当前套餐下存在卡密、请先删除卡密后才可删除套餐！',common_1[_0x17219b(0x109)][_0x17219b(0x153)]);return await this[_0x17219b(0x127)][_0x17219b(0x11d)]({'id':_0x48c521});}async['createCrami'](_0x42517e){const _0x3ff41f=_0x620667,{packageId:_0x39a591,count:count=0x1}=_0x42517e;if(_0x39a591){const _0x362d14=await this[_0x3ff41f(0x127)][_0x3ff41f(0x132)]({'where':{'id':_0x39a591}});if(!_0x362d14)throw new common_1[(_0x3ff41f(0x115))](_0x3ff41f(0x118),common_1['HttpStatus'][_0x3ff41f(0x153)]);const {days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x362d14,_0x392b8f={'packageId':_0x39a591,'days':days,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this['generateCrami'](_0x392b8f,count);}if(!_0x39a591){const {model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x42517e;if([model3Count,model4Count,drawMjCount][_0x3ff41f(0x104)](_0x347f27=>!_0x347f27))throw new common_1[(_0x3ff41f(0x115))]('自定义卡密必须至少一项余额不为0️零！',common_1[_0x3ff41f(0x109)][_0x3ff41f(0x153)]);const _0x18c3f3={'days':-0x1,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0x3ff41f(0x126)](_0x18c3f3,count);}}async[_0x620667(0x126)](_0x3a15ac,_0x2010f3){const _0x2eb9b9=_0x620667,_0x4cdf4f=[];for(let _0x53aace=0x0;_0x53aace<_0x2010f3;_0x53aace++){const _0x49e935=(0x0,utils_1[_0x2eb9b9(0x12d)])(),_0x2b889d=this[_0x2eb9b9(0x120)]['create'](Object['assign'](Object[_0x2eb9b9(0x124)]({},_0x3a15ac),{'code':_0x49e935}));_0x4cdf4f[_0x2eb9b9(0x15d)](_0x2b889d);}return await this['cramiEntity'][_0x2eb9b9(0x15e)](_0x4cdf4f);}async[_0x620667(0x156)](_0x3947a6,_0x50b929){const _0x4e2f23=_0x620667,{id:_0x59aebf}=_0x3947a6[_0x4e2f23(0x143)],_0x355474=await this['cramiEntity'][_0x4e2f23(0x132)]({'where':{'code':_0x50b929[_0x4e2f23(0x142)]}});if(!_0x355474)throw new common_1[(_0x4e2f23(0x115))](_0x4e2f23(0x135),common_1['HttpStatus'][_0x4e2f23(0x153)]);const {status:_0x378663,days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0,packageId:_0x203092}=_0x355474;if(_0x378663===0x1)throw new common_1[(_0x4e2f23(0x115))](_0x4e2f23(0x12f),common_1[_0x4e2f23(0x109)][_0x4e2f23(0x153)]);const _0x34d5b5={'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'packageId':_0x203092};return await this['userBalanceService'][_0x4e2f23(0x137)](_0x59aebf,Object[_0x4e2f23(0x124)]({},_0x34d5b5),days),await this[_0x4e2f23(0x139)][_0x4e2f23(0x14d)]({'userId':_0x59aebf,'rechargeType':balance_constant_1[_0x4e2f23(0x107)][_0x4e2f23(0x13a)],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'days':days}),await this[_0x4e2f23(0x120)][_0x4e2f23(0x101)]({'code':_0x50b929[_0x4e2f23(0x142)]},{'useId':_0x59aebf,'status':0x1}),_0x4e2f23(0x12e);}async[_0x620667(0x152)](_0x58b915,_0x8c0b9f){const _0x1ec05d=_0x620667,{page:page=0x1,size:size=0xa,status:_0xecb924,useId:_0x38c1b7}=_0x58b915,_0x2ccb21={};_0xecb924&&Object['assign'](_0x2ccb21,{'status':_0xecb924}),_0x38c1b7&&Object[_0x1ec05d(0x124)](_0x2ccb21,{'useId':_0x38c1b7});const [_0x3dd34a,_0x207b07]=await this[_0x1ec05d(0x120)]['findAndCount']({'skip':(page-0x1)*size,'take':size,'order':{'createdAt':'DESC'},'where':_0x2ccb21}),_0x21f67f=_0x3dd34a[_0x1ec05d(0x123)](_0x2a4aca=>_0x2a4aca[_0x1ec05d(0x150)]),_0x5242cd=_0x3dd34a[_0x1ec05d(0x123)](_0x443045=>_0x443045['packageId']),_0x34fffe=await this['userEntity'][_0x1ec05d(0x10b)]({'where':{'id':(0x0,typeorm_2['In'])(_0x21f67f)}}),_0x2f8ada=await this[_0x1ec05d(0x127)][_0x1ec05d(0x10b)]({'where':{'id':(0x0,typeorm_2['In'])(_0x5242cd)}});return _0x3dd34a[_0x1ec05d(0x14f)](_0x20e435=>{const _0x2d6db5=_0x1ec05d;var _0x2522e3,_0x1df37c,_0x406fe1;_0x20e435[_0x2d6db5(0x14e)]=(_0x2522e3=_0x34fffe[_0x2d6db5(0x10b)](_0x435a7d=>_0x435a7d['id']===_0x20e435[_0x2d6db5(0x150)]))===null||_0x2522e3===void 0x0?void 0x0:_0x2522e3['username'],_0x20e435[_0x2d6db5(0x151)]=(_0x1df37c=_0x34fffe['find'](_0x37c554=>_0x37c554['id']===_0x20e435[_0x2d6db5(0x150)]))===null||_0x1df37c===void 0x0?void 0x0:_0x1df37c[_0x2d6db5(0x151)],_0x20e435[_0x2d6db5(0x117)]=(_0x406fe1=_0x2f8ada[_0x2d6db5(0x10b)](_0x52c60d=>_0x52c60d['id']===_0x20e435[_0x2d6db5(0x14b)]))===null||_0x406fe1===void 0x0?void 0x0:_0x406fe1['name'];}),_0x8c0b9f[_0x1ec05d(0x143)]['role']!==_0x1ec05d(0x11e)&&_0x3dd34a[_0x1ec05d(0x14f)](_0x2b0c2a=>_0x2b0c2a[_0x1ec05d(0x151)]=(0x0,utils_1[_0x1ec05d(0x119)])(_0x2b0c2a[_0x1ec05d(0x151)])),_0x8c0b9f['user'][_0x1ec05d(0x157)]!==_0x1ec05d(0x11e)&&_0x3dd34a['forEach'](_0x5cd05f=>_0x5cd05f[_0x1ec05d(0x142)]=(0x0,utils_1['maskCrami'])(_0x5cd05f[_0x1ec05d(0x142)])),{'rows':_0x3dd34a,'count':_0x207b07};}async[_0x620667(0xff)](_0x81392e){const _0x328f69=_0x620667,_0x425a97=await this[_0x328f69(0x120)]['findOne']({'where':{'id':_0x81392e}});if(!_0x425a97)throw new common_1[(_0x328f69(0x115))](_0x328f69(0x15a),common_1['HttpStatus']['BAD_REQUEST']);if(_0x425a97[_0x328f69(0x12c)]===0x1)throw new common_1['HttpException'](_0x328f69(0x125),common_1[_0x328f69(0x109)][_0x328f69(0x153)]);return await this[_0x328f69(0x120)][_0x328f69(0x11d)]({'id':_0x81392e});}async[_0x620667(0x129)](_0x45f252){const _0x2195ac=_0x620667,{ids:_0x56dae3}=_0x45f252,_0x3ff1c6=await this[_0x2195ac(0x120)][_0x2195ac(0x11d)](_0x56dae3);if(_0x3ff1c6[_0x2195ac(0x100)]>0x0)return _0x2195ac(0x10c);else throw new common_1[(_0x2195ac(0x115))]('删除卡密失败、请重试！',common_1[_0x2195ac(0x109)][_0x2195ac(0x153)]);}};function _0x27b8(_0x7348bd,_0x7bfba3){const _0xd52d77=_0xd52d();return _0x27b8=function(_0x27b8a7,_0xd7770){_0x27b8a7=_0x27b8a7-0xff;let _0x2a3dd4=_0xd52d77[_0x27b8a7];return _0x2a3dd4;},_0x27b8(_0x7348bd,_0x7bfba3);}CramiService=__decorate([(0x0,common_1[_0x620667(0x13f)])(),__param(0x0,(0x0,typeorm_1[_0x620667(0x15c)])(crami_entity_1[_0x620667(0x10a)])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(cramiPackage_entity_1[_0x620667(0x138)])),__param(0x2,(0x0,typeorm_1[_0x620667(0x15c)])(user_entity_1[_0x620667(0x12a)])),__metadata('design:paramtypes',[typeorm_2['Repository'],typeorm_2[_0x620667(0x102)],typeorm_2['Repository'],userBalance_service_1[_0x620667(0x121)]])],CramiService),exports[_0x620667(0x146)]=CramiService;