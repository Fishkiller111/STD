'use strict';const _0x40c29b=_0x40d1;(function(_0x5ddc99,_0x581bbe){const _0x2c2811=_0x40d1,_0x340ed5=_0x5ddc99();while(!![]){try{const _0x5b0a66=-parseInt(_0x2c2811(0xc0))/0x1+-parseInt(_0x2c2811(0xbb))/0x2+-parseInt(_0x2c2811(0xd0))/0x3*(-parseInt(_0x2c2811(0xb6))/0x4)+parseInt(_0x2c2811(0xc5))/0x5+-parseInt(_0x2c2811(0xa0))/0x6*(-parseInt(_0x2c2811(0xbe))/0x7)+parseInt(_0x2c2811(0xa1))/0x8*(-parseInt(_0x2c2811(0xa9))/0x9)+-parseInt(_0x2c2811(0xad))/0xa;if(_0x5b0a66===_0x581bbe)break;else _0x340ed5['push'](_0x340ed5['shift']());}catch(_0xc01bc9){_0x340ed5['push'](_0x340ed5['shift']());}}}(_0x215e,0x6a26d));var __decorate=this&&this['__decorate']||function(_0xb444e1,_0x1fe769,_0x3133dd,_0x3b7567){const _0x73b672=_0x40d1;var _0x37c92f=arguments[_0x73b672(0xb1)],_0x5d5dbb=_0x37c92f<0x3?_0x1fe769:_0x3b7567===null?_0x3b7567=Object[_0x73b672(0xc2)](_0x1fe769,_0x3133dd):_0x3b7567,_0x37a21f;if(typeof Reflect===_0x73b672(0xb4)&&typeof Reflect[_0x73b672(0xb7)]===_0x73b672(0xce))_0x5d5dbb=Reflect['decorate'](_0xb444e1,_0x1fe769,_0x3133dd,_0x3b7567);else{for(var _0xa5429b=_0xb444e1[_0x73b672(0xb1)]-0x1;_0xa5429b>=0x0;_0xa5429b--)if(_0x37a21f=_0xb444e1[_0xa5429b])_0x5d5dbb=(_0x37c92f<0x3?_0x37a21f(_0x5d5dbb):_0x37c92f>0x3?_0x37a21f(_0x1fe769,_0x3133dd,_0x5d5dbb):_0x37a21f(_0x1fe769,_0x3133dd))||_0x5d5dbb;}return _0x37c92f>0x3&&_0x5d5dbb&&Object[_0x73b672(0xa2)](_0x1fe769,_0x3133dd,_0x5d5dbb),_0x5d5dbb;},__metadata=this&&this[_0x40c29b(0xbd)]||function(_0x57f974,_0x243b4e){const _0x3bf59b=_0x40c29b;if(typeof Reflect===_0x3bf59b(0xb4)&&typeof Reflect['metadata']===_0x3bf59b(0xce))return Reflect[_0x3bf59b(0xcd)](_0x57f974,_0x243b4e);},__param=this&&this['__param']||function(_0x2e489d,_0x27d2d9){return function(_0x111184,_0x3a1637){_0x27d2d9(_0x111184,_0x3a1637,_0x2e489d);};};Object[_0x40c29b(0xa2)](exports,'__esModule',{'value':!![]}),exports[_0x40c29b(0xa7)]=void 0x0;const common_1=require('@nestjs/common'),bull_1=require(_0x40c29b(0xaa)),utils_1=require(_0x40c29b(0xab)),midjourney_service_1=require(_0x40c29b(0xca)),userBalance_service_1=require(_0x40c29b(0xcb)),globalConfig_service_1=require(_0x40c29b(0xa4));let QueueService=class QueueService{constructor(_0x1f39a8,_0x408930,_0x219ba0,_0x59f78b){const _0x12a680=_0x40c29b;this[_0x12a680(0x9e)]=_0x1f39a8,this[_0x12a680(0x9c)]=_0x408930,this[_0x12a680(0xc3)]=_0x219ba0,this[_0x12a680(0xb8)]=_0x59f78b,this[_0x12a680(0xb9)]=[];}async['onApplicationBootstrap'](){const _0x3a9376=_0x40c29b;await this[_0x3a9376(0x9e)]['clean'](0x0,_0x3a9376(0xbf)),await this[_0x3a9376(0x9c)]['cleanQueue']();}async[_0x40c29b(0xae)](_0x43b89c,_0x2f6c96){const _0x38415a=_0x40c29b,{imgUrl:_0xaa79cc,orderId:_0x2e139d,action:_0x4bbecd,drawId:_0xd77859}=_0x43b89c;await this['midjourneyService'][_0x38415a(0x9f)](_0x2f6c96),await this[_0x38415a(0xc3)][_0x38415a(0xbc)](_0x2f6c96,_0x38415a(0x9d),_0x4bbecd===_0x38415a(0xa6)?0x1:0x4);if(_0x4bbecd===_0x38415a(0xc8)){const _0x54460a=''+(0x0,utils_1[_0x38415a(0xc1)])(),_0x364197=Object[_0x38415a(0xcf)](Object['assign']({},_0x43b89c),{'userId':_0x2f6c96[_0x38415a(0xaf)]['id'],'randomDrawId':_0x54460a}),_0x4788f0=await this[_0x38415a(0x9c)][_0x38415a(0xd1)](_0x364197),_0x177d85=await this[_0x38415a(0xb8)][_0x38415a(0xc6)]([_0x38415a(0xac)])||0x30d40,_0x375181=await this[_0x38415a(0x9e)]['add']('mjDraw',{'id':_0x4788f0['id'],'action':_0x4bbecd,'userId':_0x2f6c96[_0x38415a(0xaf)]['id']},{'delay':0x3e8,'timeout':+_0x177d85});return this[_0x38415a(0xb9)]['push'](_0x375181['id']),!![];}else{const {orderId:_0x92671c,action:_0x4f2204,drawId:_0x1c90ae}=_0x43b89c,_0x5747e2=await this[_0x38415a(0x9c)][_0x38415a(0xc9)](_0x4f2204,_0x1c90ae,_0x92671c),_0x4267da=Object[_0x38415a(0xcf)](Object[_0x38415a(0xcf)](Object[_0x38415a(0xcf)]({},_0x43b89c),{'userId':_0x2f6c96[_0x38415a(0xaf)]['id']}),_0x5747e2),_0x4cf7e7=await this['midjourneyService'][_0x38415a(0xd1)](_0x4267da),_0x548a21=await this[_0x38415a(0xb8)][_0x38415a(0xc6)]([_0x38415a(0xac)])||0x30d40,_0x2a30af=await this[_0x38415a(0x9e)][_0x38415a(0xb2)](_0x38415a(0x9d),{'id':_0x4cf7e7['id'],'action':_0x4f2204,'userId':_0x2f6c96['user']['id']},{'delay':0x3e8,'timeout':+_0x548a21});this['jobIds'][_0x38415a(0xba)](_0x2a30af['id']);return;}if(!_0xd77859||!_0x2e139d)throw new common_1[(_0x38415a(0xb5))](_0x38415a(0xb3),common_1[_0x38415a(0xc7)]['BAD_REQUEST']);}async[_0x40c29b(0xa3)](){const _0x1f5bdc=_0x40c29b;return{'jobIds':this[_0x1f5bdc(0xb9)]};}};function _0x40d1(_0x227c91,_0x40600a){const _0x215eb9=_0x215e();return _0x40d1=function(_0x40d1a9,_0x5346d5){_0x40d1a9=_0x40d1a9-0x9c;let _0x29d057=_0x215eb9[_0x40d1a9];return _0x29d057;},_0x40d1(_0x227c91,_0x40600a);}QueueService=__decorate([__param(0x0,(0x0,bull_1[_0x40c29b(0xb0)])(_0x40c29b(0xcc))),__metadata('design:paramtypes',[Object,midjourney_service_1[_0x40c29b(0xa5)],userBalance_service_1[_0x40c29b(0xa8)],globalConfig_service_1[_0x40c29b(0xc4)]])],QueueService),exports[_0x40c29b(0xa7)]=QueueService;function _0x215e(){const _0x97f778=['617931bzjdAG','addDrawQueue','midjourneyService','mjDraw','mjDrawQueue','checkLimit','1164678wDMTqL','16xfQwqS','defineProperty','getQueue','../globalConfig/globalConfig.service','MidjourneyService','UPSCALE','QueueService','UserBalanceService','72306THkbJk','@nestjs/bull','../../common/utils','mjTimeoutMs','3351430bRSARX','addMjDrawQueue','user','InjectQueue','length','add','缺少必要参数！','object','HttpException','8qHdPOy','decorate','globalConfigService','jobIds','push','802204udJaZz','validateBalance','__metadata','21IoLYTp','active','317157TlVUkg','createRandomUid','getOwnPropertyDescriptor','userBalanceService','GlobalConfigService','2549870FfMluP','getConfigs','HttpStatus','IMAGINE','getDrawActionDetail','../midjourney/midjourney.service','../userBalance/userBalance.service','MJDRAW','metadata','function','assign'];_0x215e=function(){return _0x97f778;};return _0x215e();}