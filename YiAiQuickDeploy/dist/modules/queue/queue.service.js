'use strict';const _0x52599e=_0x4dd6;function _0x4dd6(_0x3036a9,_0x5e8416){const _0x27bf80=_0x27bf();return _0x4dd6=function(_0x4dd6c7,_0x3eaee7){_0x4dd6c7=_0x4dd6c7-0x1a0;let _0x5bdcdb=_0x27bf80[_0x4dd6c7];return _0x5bdcdb;},_0x4dd6(_0x3036a9,_0x5e8416);}(function(_0x5a5dba,_0x42a136){const _0x171588=_0x4dd6,_0x5b4735=_0x5a5dba();while(!![]){try{const _0x333dd0=-parseInt(_0x171588(0x1ce))/0x1+parseInt(_0x171588(0x1d4))/0x2*(parseInt(_0x171588(0x1c2))/0x3)+parseInt(_0x171588(0x1a4))/0x4*(parseInt(_0x171588(0x1cf))/0x5)+-parseInt(_0x171588(0x1be))/0x6+-parseInt(_0x171588(0x1a3))/0x7+-parseInt(_0x171588(0x1ac))/0x8*(parseInt(_0x171588(0x1a2))/0x9)+-parseInt(_0x171588(0x1ad))/0xa*(-parseInt(_0x171588(0x1c4))/0xb);if(_0x333dd0===_0x42a136)break;else _0x5b4735['push'](_0x5b4735['shift']());}catch(_0x45c5b8){_0x5b4735['push'](_0x5b4735['shift']());}}}(_0x27bf,0x1c2e7));function _0x27bf(){const _0xf6b034=['metadata','UPSCALE','9OMqIhA','96117bpkeuN','26780whjJuq','object','getQueue','BAD_REQUEST','getOwnPropertyDescriptor','../midjourney/midjourney.service','cleanQueue','add','335752hHrukF','1830cTiGsS','../../common/utils','MJDRAW','MidjourneyService','InjectQueue','function','QueueService','缺少必要参数！','../globalConfig/globalConfig.service','onApplicationBootstrap','jobIds','design:paramtypes','mjDrawQueue','checkLimit','mjTimeoutMs','validateBalance','assign','542844ihOrDX','createRandomUid','@nestjs/bull','__param','6UyvAEf','getDrawActionDetail','957XrLEss','userBalanceService','push','clean','__decorate','addDrawQueue','length','mjDraw','IMAGINE','user','49849lYQmyU','145cQCZgz','HttpStatus','../userBalance/userBalance.service','@nestjs/common','__esModule','101378CfgSng','decorate','GlobalConfigService','globalConfigService','defineProperty','__metadata','midjourneyService'];_0x27bf=function(){return _0xf6b034;};return _0x27bf();}var __decorate=this&&this[_0x52599e(0x1c8)]||function(_0x3efac5,_0x222dfb,_0x215ef4,_0xf27663){const _0x1c3607=_0x52599e;var _0x10387a=arguments[_0x1c3607(0x1ca)],_0x5cd9c4=_0x10387a<0x3?_0x222dfb:_0xf27663===null?_0xf27663=Object[_0x1c3607(0x1a8)](_0x222dfb,_0x215ef4):_0xf27663,_0x431893;if(typeof Reflect===_0x1c3607(0x1a5)&&typeof Reflect[_0x1c3607(0x1d5)]===_0x1c3607(0x1b2))_0x5cd9c4=Reflect[_0x1c3607(0x1d5)](_0x3efac5,_0x222dfb,_0x215ef4,_0xf27663);else{for(var _0x24a619=_0x3efac5['length']-0x1;_0x24a619>=0x0;_0x24a619--)if(_0x431893=_0x3efac5[_0x24a619])_0x5cd9c4=(_0x10387a<0x3?_0x431893(_0x5cd9c4):_0x10387a>0x3?_0x431893(_0x222dfb,_0x215ef4,_0x5cd9c4):_0x431893(_0x222dfb,_0x215ef4))||_0x5cd9c4;}return _0x10387a>0x3&&_0x5cd9c4&&Object['defineProperty'](_0x222dfb,_0x215ef4,_0x5cd9c4),_0x5cd9c4;},__metadata=this&&this[_0x52599e(0x1d9)]||function(_0x1c1626,_0x3cfc0b){const _0x116dbb=_0x52599e;if(typeof Reflect===_0x116dbb(0x1a5)&&typeof Reflect[_0x116dbb(0x1a0)]===_0x116dbb(0x1b2))return Reflect['metadata'](_0x1c1626,_0x3cfc0b);},__param=this&&this[_0x52599e(0x1c1)]||function(_0x2bcb6e,_0x34ecb8){return function(_0x2c2bf5,_0x10a202){_0x34ecb8(_0x2c2bf5,_0x10a202,_0x2bcb6e);};};Object[_0x52599e(0x1d8)](exports,_0x52599e(0x1d3),{'value':!![]}),exports[_0x52599e(0x1b3)]=void 0x0;const common_1=require(_0x52599e(0x1d2)),bull_1=require(_0x52599e(0x1c0)),utils_1=require(_0x52599e(0x1ae)),midjourney_service_1=require(_0x52599e(0x1a9)),userBalance_service_1=require(_0x52599e(0x1d1)),globalConfig_service_1=require(_0x52599e(0x1b5));let QueueService=class QueueService{constructor(_0x6cf8c0,_0x204e5f,_0x1e994a,_0x1aa49a){const _0x220a39=_0x52599e;this[_0x220a39(0x1b9)]=_0x6cf8c0,this['midjourneyService']=_0x204e5f,this['userBalanceService']=_0x1e994a,this[_0x220a39(0x1d7)]=_0x1aa49a,this[_0x220a39(0x1b7)]=[];}async[_0x52599e(0x1b6)](){const _0x316d64=_0x52599e;await this[_0x316d64(0x1b9)][_0x316d64(0x1c7)](0x0,'active'),await this['midjourneyService'][_0x316d64(0x1aa)]();}async['addMjDrawQueue'](_0x10630f,_0x8b2353){const _0x111440=_0x52599e,{imgUrl:_0x200351,orderId:_0x5e2c20,action:_0x424848,drawId:_0x281c11}=_0x10630f;await this[_0x111440(0x1da)][_0x111440(0x1ba)](_0x8b2353),await this[_0x111440(0x1c5)][_0x111440(0x1bc)](_0x8b2353,_0x111440(0x1cb),_0x424848===_0x111440(0x1a1)?0x1:0x4);if(_0x424848===_0x111440(0x1cc)){const _0x257da7=''+(0x0,utils_1[_0x111440(0x1bf)])(),_0xd3bf71=Object[_0x111440(0x1bd)](Object[_0x111440(0x1bd)]({},_0x10630f),{'userId':_0x8b2353['user']['id'],'randomDrawId':_0x257da7}),_0x3c4f05=await this[_0x111440(0x1da)][_0x111440(0x1c9)](_0xd3bf71),_0x1c9078=await this[_0x111440(0x1d7)]['getConfigs']([_0x111440(0x1bb)])||0x30d40,_0x4b96d6=await this[_0x111440(0x1b9)][_0x111440(0x1ab)](_0x111440(0x1cb),{'id':_0x3c4f05['id'],'action':_0x424848,'userId':_0x8b2353['user']['id']},{'delay':0x3e8,'timeout':+_0x1c9078});return this[_0x111440(0x1b7)][_0x111440(0x1c6)](_0x4b96d6['id']),!![];}else{const {orderId:_0x3d36e1,action:_0x370966,drawId:_0x227d3c}=_0x10630f,_0x47c2f4=await this[_0x111440(0x1da)][_0x111440(0x1c3)](_0x370966,_0x227d3c,_0x3d36e1),_0x332d30=Object[_0x111440(0x1bd)](Object[_0x111440(0x1bd)](Object['assign']({},_0x10630f),{'userId':_0x8b2353['user']['id']}),_0x47c2f4),_0x5ed883=await this[_0x111440(0x1da)][_0x111440(0x1c9)](_0x332d30),_0xcfb589=await this[_0x111440(0x1d7)]['getConfigs']([_0x111440(0x1bb)])||0x30d40,_0x350304=await this[_0x111440(0x1b9)][_0x111440(0x1ab)](_0x111440(0x1cb),{'id':_0x5ed883['id'],'action':_0x370966,'userId':_0x8b2353[_0x111440(0x1cd)]['id']},{'delay':0x3e8,'timeout':+_0xcfb589});this[_0x111440(0x1b7)][_0x111440(0x1c6)](_0x350304['id']);return;}if(!_0x281c11||!_0x5e2c20)throw new common_1['HttpException'](_0x111440(0x1b4),common_1[_0x111440(0x1d0)][_0x111440(0x1a7)]);}async[_0x52599e(0x1a6)](){return{'jobIds':this['jobIds']};}};QueueService=__decorate([__param(0x0,(0x0,bull_1[_0x52599e(0x1b1)])(_0x52599e(0x1af))),__metadata(_0x52599e(0x1b8),[Object,midjourney_service_1[_0x52599e(0x1b0)],userBalance_service_1['UserBalanceService'],globalConfig_service_1[_0x52599e(0x1d6)]])],QueueService),exports[_0x52599e(0x1b3)]=QueueService;