'use strict';const _0x43f74d=_0x2e43;(function(_0x418561,_0x491c49){const _0x420edc=_0x2e43,_0x14ca8b=_0x418561();while(!![]){try{const _0x17de47=parseInt(_0x420edc(0x199))/0x1+parseInt(_0x420edc(0x16e))/0x2+-parseInt(_0x420edc(0x181))/0x3*(-parseInt(_0x420edc(0x175))/0x4)+parseInt(_0x420edc(0x1ad))/0x5*(parseInt(_0x420edc(0x18e))/0x6)+-parseInt(_0x420edc(0x1b4))/0x7*(-parseInt(_0x420edc(0x1db))/0x8)+parseInt(_0x420edc(0x1d7))/0x9+-parseInt(_0x420edc(0x1cd))/0xa*(parseInt(_0x420edc(0x13d))/0xb);if(_0x17de47===_0x491c49)break;else _0x14ca8b['push'](_0x14ca8b['shift']());}catch(_0x3b7add){_0x14ca8b['push'](_0x14ca8b['shift']());}}}(_0x1798,0x1f4cd));function _0x1798(){const _0x5ada5c=['qureyUserInfoByInviteCode','99500EtFWjj','hex','password','decorate','createRandomUid','__param','super','4pzYDeZ','queryOne','不可将用户置为未激活状态！','userBalanceService','getUserStatus','getOpenIdByUserId','updateUserStatus','修改用户状态失败！','verifyUserPassword','重置密码失败！','getSuper','saveRecordRechargeLog','369921bpjAyu','map','findOne','queryUserInfoById','openId','用户不存在！','getConfigs','userRecharge','addBalanceToUser','UNAUTHORIZED','generateRandomString','超级管理员不可被操作！','findAndCount','252JnuEWG','../../common/utils','phone','formatCreateOrUpdateDate','updateInfo','affected','当前账户不存在！','sign','length','__decorate','../globalConfig/config.entity','116546CorMII','queryUserBalance','hashSync','__esModule','update','user','BLACKLISTED','function','verifyUserCredentials','../chatgpt/whiteList.entity','无效的邀请码！','mailerService','cloneDeep','client','该微信已绑定其他账号！','object','RechargeType','crypto','您的账户已被永久加入黑名单、如有疑问、请联系管理员！','PENDING','24140RiAACk','addBalanceToNewUser','UserStatusErrMsg','bcryptjs','./user.entity','consecutiveDays','$2y$','32088lysZow','queryOneUserInfo','userEntity','getInviteRecord','whiteListEntity','maskEmail','__metadata','用户名或者邮箱已被注册！','getClientIp','Injectable','没有变更，无需更改！','checkUserStatus','createUser','maskIpAddress','生成邀请码失败，请重新试一次吧！','../../common/constants/balance.constant','恭喜您绑定成功、后续可直接扫码登录了！','forEach','resetUserPass','VerificationService','UserStatusEnum','../../common/constants/user.constant','DESC','MailerService','getUserById','1490SubVpe','status','queryUserBalanceByIds','$2b$','用户名已存在！','LOCKED','username','当前密码错误！','log','metadata','1853316phDzpi','lastLoginIp','visitor','email','312zlfVqy','verifyUserRegisterByPhone','../userBalance/userBalance.service','startsWith','用户名已存在、请更换用户名！','GlobalConfigService','assign','绑定微信失败、请联系管理员！','55286YwIzNi','HttpStatus','当前用户信息失效、请重新登录！','Not','genInviteCode','inviteCode','@nestjs/common','createdAt','----,','digest','createHash','defineProperty','design:paramtypes','getUserFromOpenId','balanceInfo','BAD_REQUEST','queryAll',']成功!','createUserAndVerifycation','save','compareSync','bindWx','Repository','HttpException','Connection','configEntity','getOwnPropertyDescriptor','FORBIDDEN','修改密码失败、请重新试试吧。','Like','当前用户不存在！','InjectRepository','$2a$','savaLoginIp','typeorm','role','inviteLink','md5','ACTIVE','修改用户状态成功！','connection','未激活用户不可手动变更状态！','createUserFromOpenId','avatar','globalConfigService','WhiteListEntity','userDefautlAvatar','当前手机号已注册、请勿重复注册！'];_0x1798=function(){return _0x5ada5c;};return _0x1798();}var __decorate=this&&this[_0x43f74d(0x197)]||function(_0x4753d9,_0x3dd866,_0x32b88e,_0x33ce41){const _0x27f513=_0x43f74d;var _0x161a41=arguments['length'],_0x2c32ba=_0x161a41<0x3?_0x3dd866:_0x33ce41===null?_0x33ce41=Object[_0x27f513(0x157)](_0x3dd866,_0x32b88e):_0x33ce41,_0x2bd906;if(typeof Reflect===_0x27f513(0x1a8)&&typeof Reflect['decorate']==='function')_0x2c32ba=Reflect[_0x27f513(0x171)](_0x4753d9,_0x3dd866,_0x32b88e,_0x33ce41);else{for(var _0x4afce1=_0x4753d9[_0x27f513(0x196)]-0x1;_0x4afce1>=0x0;_0x4afce1--)if(_0x2bd906=_0x4753d9[_0x4afce1])_0x2c32ba=(_0x161a41<0x3?_0x2bd906(_0x2c32ba):_0x161a41>0x3?_0x2bd906(_0x3dd866,_0x32b88e,_0x2c32ba):_0x2bd906(_0x3dd866,_0x32b88e))||_0x2c32ba;}return _0x161a41>0x3&&_0x2c32ba&&Object[_0x27f513(0x148)](_0x3dd866,_0x32b88e,_0x2c32ba),_0x2c32ba;},__metadata=this&&this[_0x43f74d(0x1ba)]||function(_0x2301e3,_0x4a8ceb){const _0x46d3fc=_0x43f74d;if(typeof Reflect===_0x46d3fc(0x1a8)&&typeof Reflect[_0x46d3fc(0x1d6)]===_0x46d3fc(0x1a0))return Reflect[_0x46d3fc(0x1d6)](_0x2301e3,_0x4a8ceb);},__param=this&&this[_0x43f74d(0x173)]||function(_0x3c5151,_0x9b0c6d){return function(_0x1db27c,_0x5b1b15){_0x9b0c6d(_0x1db27c,_0x5b1b15,_0x3c5151);};};Object[_0x43f74d(0x148)](exports,_0x43f74d(0x19c),{'value':!![]}),exports['UserService']=void 0x0;const globalConfig_service_1=require('../globalConfig/globalConfig.service'),user_constant_1=require(_0x43f74d(0x1c9)),mailer_1=require('@nestjs-modules/mailer'),verification_service_1=require('../verification/verification.service'),common_1=require(_0x43f74d(0x143)),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require(_0x43f74d(0x15f)),user_entity_1=require(_0x43f74d(0x1b1)),bcrypt=require(_0x43f74d(0x1b0)),crypto=require(_0x43f74d(0x1aa)),_=require('lodash'),userBalance_service_1=require(_0x43f74d(0x1dd)),utils_1=require(_0x43f74d(0x18f)),balance_constant_1=require(_0x43f74d(0x1c3)),config_entity_1=require(_0x43f74d(0x198)),whiteList_entity_1=require(_0x43f74d(0x1a2));let UserService=class UserService{constructor(_0x3d25b8,_0x15ce00,_0x45b743,_0x279725,_0x5cc720,_0x221faa,_0x64733b,_0x56c922){const _0x30d5a3=_0x43f74d;this[_0x30d5a3(0x1b6)]=_0x3d25b8,this[_0x30d5a3(0x1b8)]=_0x15ce00,this[_0x30d5a3(0x165)]=_0x45b743,this['verificationService']=_0x279725,this[_0x30d5a3(0x1a4)]=_0x5cc720,this[_0x30d5a3(0x178)]=_0x221faa,this['globalConfigService']=_0x64733b,this[_0x30d5a3(0x156)]=_0x56c922;}async[_0x43f74d(0x14f)](_0x1f790f,_0x2d62fc){const _0x3158f5=_0x43f74d,{username:_0x7d7ee,email:_0x14c91f,password:_0x3dfb18,invitedBy:_0x4bc420,client:client=0x0}=_0x1f790f;if(_0x4bc420){const _0x3fc542=await this[_0x3158f5(0x1b6)][_0x3158f5(0x183)]({'where':{'inviteCode':_0x4bc420}});if(!_0x3fc542)throw new common_1[(_0x3158f5(0x154))](_0x3158f5(0x1a3),common_1['HttpStatus'][_0x3158f5(0x14c)]);}const _0x431dc0=[{'username':_0x7d7ee},{'email':_0x14c91f}],_0x434f35=await this[_0x3158f5(0x1b6)][_0x3158f5(0x183)]({'where':_0x431dc0});if(_0x434f35&&_0x434f35[_0x3158f5(0x1ce)]!==user_constant_1['UserStatusEnum'][_0x3158f5(0x1ac)])throw new common_1[(_0x3158f5(0x154))](_0x3158f5(0x1bb),common_1[_0x3158f5(0x13e)][_0x3158f5(0x14c)]);try{const _0x5e5345=_[_0x3158f5(0x1a5)](_0x1f790f),_0x3cef3d=bcrypt[_0x3158f5(0x19b)](_0x3dfb18,0xa),_0x48bb46=(0x0,utils_1[_0x3158f5(0x1bc)])(_0x2d62fc);_0x5e5345['password']=_0x3cef3d,_0x5e5345['registerIp']=_0x48bb46,_0x5e5345[_0x3158f5(0x1a6)]=client;let _0x3d49ac;if(!_0x434f35){const _0x2920ed=await this[_0x3158f5(0x169)][_0x3158f5(0x187)]([_0x3158f5(0x16b)]);_0x5e5345[_0x3158f5(0x168)]=_0x2920ed,_0x3d49ac=await this[_0x3158f5(0x1b6)][_0x3158f5(0x150)](_0x5e5345);}else _0x3d49ac=_0x434f35;const {username:_0x1c7682,email:_0x2666a9,id:_0x2c40ae,invitedBy:_0x1f071a}=_0x3d49ac;await this[_0x3158f5(0x17b)](_0x2c40ae,user_constant_1[_0x3158f5(0x1c8)][_0x3158f5(0x163)]);let _0x2130c5;return _0x1f071a&&(_0x2130c5=await this[_0x3158f5(0x16d)](_0x1f071a)),await this[_0x3158f5(0x178)][_0x3158f5(0x1ae)](_0x2c40ae,_0x2130c5===null||_0x2130c5===void 0x0?void 0x0:_0x2130c5['id']),_0x3d49ac;}catch(_0x432011){console[_0x3158f5(0x1d5)]('error:\x20',_0x432011);throw _0x432011;}}async[_0x43f74d(0x17f)](){const _0x4baaa5=_0x43f74d,_0x524ae5=await this[_0x4baaa5(0x1b6)][_0x4baaa5(0x183)]({'where':{'role':_0x4baaa5(0x174)}});return _0x524ae5;}async[_0x43f74d(0x1a1)](_0x2b56ba){const _0x3a2619=_0x43f74d,{username:_0x3702a6,password:_0x399f8f,uid:uid=0x0,phone:_0x4db461}=_0x2b56ba;let _0x58369a=null;if(uid>0x0){_0x58369a=await this[_0x3a2619(0x1b6)][_0x3a2619(0x183)]({'where':{'id':uid}});if(!_0x58369a)throw new common_1[(_0x3a2619(0x154))]('当前账户不存在！',common_1[_0x3a2619(0x13e)][_0x3a2619(0x158)]);if(_0x58369a['password'][_0x3a2619(0x1de)](_0x3a2619(0x15d))||_0x58369a[_0x3a2619(0x170)]['startsWith']('$2b$')||_0x58369a['password']['startsWith'](_0x3a2619(0x1b3))){if(!bcrypt[_0x3a2619(0x151)](_0x399f8f,_0x58369a[_0x3a2619(0x170)]))throw new common_1[(_0x3a2619(0x154))](_0x3a2619(0x1d4),common_1['HttpStatus'][_0x3a2619(0x14c)]);}else{console[_0x3a2619(0x1d5)](_0x3a2619(0x145));const _0x3ee87a=crypto['createHash']('md5')[_0x3a2619(0x19d)](_0x399f8f)[_0x3a2619(0x146)](_0x3a2619(0x16f));console[_0x3a2619(0x1d5)](_0x3a2619(0x145),_0x3ee87a);if(_0x3ee87a!==_0x58369a[_0x3a2619(0x170)])throw new common_1['HttpException']('当前密码错误！',common_1['HttpStatus'][_0x3a2619(0x14c)]);}}if(_0x3702a6&&_0x399f8f){const _0x5a9429=[{'username':_0x3702a6},{'email':_0x3702a6}];_0x58369a=await this[_0x3a2619(0x1b6)]['findOne']({'where':_0x5a9429});if(!_0x58369a)throw new common_1[(_0x3a2619(0x154))]('当前账户不存在！',common_1[_0x3a2619(0x13e)][_0x3a2619(0x158)]);if(_0x58369a['password'][_0x3a2619(0x1de)](_0x3a2619(0x15d))||_0x58369a[_0x3a2619(0x170)][_0x3a2619(0x1de)](_0x3a2619(0x1d0))||_0x58369a['password'][_0x3a2619(0x1de)](_0x3a2619(0x1b3))){if(!bcrypt[_0x3a2619(0x151)](_0x399f8f,_0x58369a[_0x3a2619(0x170)]))throw new common_1[(_0x3a2619(0x154))]('当前密码错误！',common_1[_0x3a2619(0x13e)][_0x3a2619(0x14c)]);}else{console[_0x3a2619(0x1d5)](_0x3a2619(0x145));const _0xe23512=crypto[_0x3a2619(0x147)](_0x3a2619(0x162))[_0x3a2619(0x19d)](_0x399f8f)[_0x3a2619(0x146)](_0x3a2619(0x16f));console[_0x3a2619(0x1d5)](_0x3a2619(0x145),_0xe23512);if(_0xe23512!==_0x58369a[_0x3a2619(0x170)])throw new common_1['HttpException']('当前密码错误！',common_1['HttpStatus'][_0x3a2619(0x14c)]);}}if(_0x4db461&&_0x399f8f){const _0x23b004=[{'phone':_0x4db461}];_0x58369a=await this[_0x3a2619(0x1b6)]['findOne']({'where':_0x23b004});if(!_0x58369a)throw new common_1[(_0x3a2619(0x154))](_0x3a2619(0x194),common_1[_0x3a2619(0x13e)]['FORBIDDEN']);if(_0x58369a[_0x3a2619(0x170)][_0x3a2619(0x1de)]('$2a$')||_0x58369a[_0x3a2619(0x170)]['startsWith'](_0x3a2619(0x1d0))||_0x58369a['password']['startsWith'](_0x3a2619(0x1b3))){if(!bcrypt['compareSync'](_0x399f8f,_0x58369a[_0x3a2619(0x170)]))throw new common_1[(_0x3a2619(0x154))](_0x3a2619(0x1d4),common_1[_0x3a2619(0x13e)]['BAD_REQUEST']);}else{console[_0x3a2619(0x1d5)](_0x3a2619(0x145));const _0x7666e=crypto[_0x3a2619(0x147)](_0x3a2619(0x162))[_0x3a2619(0x19d)](_0x399f8f)[_0x3a2619(0x146)](_0x3a2619(0x16f));console[_0x3a2619(0x1d5)](_0x3a2619(0x145),_0x7666e);if(_0x7666e!==_0x58369a['password'])throw new common_1[(_0x3a2619(0x154))](_0x3a2619(0x1d4),common_1[_0x3a2619(0x13e)][_0x3a2619(0x14c)]);}}if(!_0x58369a)throw new common_1[(_0x3a2619(0x154))](_0x3a2619(0x194),common_1[_0x3a2619(0x13e)][_0x3a2619(0x158)]);if(_0x58369a['status']!==user_constant_1[_0x3a2619(0x1c8)][_0x3a2619(0x163)])throw new common_1[(_0x3a2619(0x154))](user_constant_1[_0x3a2619(0x1af)][_0x58369a[_0x3a2619(0x1ce)]],common_1[_0x3a2619(0x13e)][_0x3a2619(0x14c)]);return _0x58369a;}async[_0x43f74d(0x17d)](_0x59385b,_0x41549c){const _0x246c2e=_0x43f74d,_0x4fa214=await this[_0x246c2e(0x1b6)][_0x246c2e(0x183)]({'where':{'id':_0x59385b}});if(_0x4fa214[_0x246c2e(0x170)]['startsWith']('$2a$')||_0x4fa214['password'][_0x246c2e(0x1de)](_0x246c2e(0x1d0))||_0x4fa214['password'][_0x246c2e(0x1de)]('$2y$'))return bcrypt[_0x246c2e(0x151)](_0x41549c,_0x4fa214['password']);else{const _0x4c4f7c=crypto[_0x246c2e(0x147)]('md5')[_0x246c2e(0x19d)](_0x41549c)[_0x246c2e(0x146)](_0x246c2e(0x16f));return console['log'](_0x246c2e(0x145),_0x4c4f7c),_0x4c4f7c===_0x4fa214['password'];}}async[_0x43f74d(0x17b)](_0x497b36,_0x383791){const _0x3a4554=_0x43f74d,_0x2094d8=await this[_0x3a4554(0x1b6)][_0x3a4554(0x19d)]({'id':_0x497b36},{'status':_0x383791});return _0x2094d8[_0x3a4554(0x193)]>0x0;}async[_0x43f74d(0x179)](_0x595b77){const _0x13363d=_0x43f74d,_0x280921=await this[_0x13363d(0x1b6)]['findOne']({'where':{'id':_0x595b77}});return _0x280921['status'];}async[_0x43f74d(0x184)](_0x20357a){const _0x3a136a=_0x43f74d;return await this[_0x3a136a(0x1b6)][_0x3a136a(0x183)]({'where':{'id':_0x20357a}});}async[_0x43f74d(0x1b5)](_0x20f874){const _0x156f37=_0x43f74d;return await this[_0x156f37(0x1b6)][_0x156f37(0x183)]({'where':{'id':_0x20f874}});}async[_0x43f74d(0x1bf)](_0x282589){const _0x505c0e=_0x43f74d,{id:_0x598a88,role:_0x3ad14c}=_0x282589;if(_0x3ad14c===_0x505c0e(0x1d9))return!![];const _0x4c6d91=await this[_0x505c0e(0x1b6)][_0x505c0e(0x183)]({'where':{'id':_0x598a88}});if(!_0x4c6d91)throw new common_1[(_0x505c0e(0x154))](_0x505c0e(0x13f),common_1[_0x505c0e(0x13e)][_0x505c0e(0x18a)]);if(_0x4c6d91[_0x505c0e(0x1ce)]===user_constant_1[_0x505c0e(0x1c8)][_0x505c0e(0x19f)])throw new common_1[(_0x505c0e(0x154))](_0x505c0e(0x1ab),common_1[_0x505c0e(0x13e)][_0x505c0e(0x14c)]);if(_0x4c6d91[_0x505c0e(0x1ce)]===user_constant_1['UserStatusEnum'][_0x505c0e(0x1d2)])throw new common_1[(_0x505c0e(0x154))]('您的账户已被封禁、如有疑问、请联系管理员！',common_1[_0x505c0e(0x13e)][_0x505c0e(0x14c)]);}async['getUserInfo'](_0x48bf92){const _0xd574d6=_0x43f74d,_0x771f88=await this[_0xd574d6(0x1b6)][_0xd574d6(0x183)]({'where':{'id':_0x48bf92},'select':[_0xd574d6(0x1d3),'avatar',_0xd574d6(0x160),_0xd574d6(0x1da),_0xd574d6(0x195),_0xd574d6(0x142),_0xd574d6(0x185),_0xd574d6(0x1b2)]});if(!_0x771f88)throw new common_1[(_0xd574d6(0x154))](_0xd574d6(0x13f),common_1[_0xd574d6(0x13e)][_0xd574d6(0x18a)]);_0x771f88['isBindWx']=!!(_0x771f88===null||_0x771f88===void 0x0?void 0x0:_0x771f88[_0xd574d6(0x185)]),delete _0x771f88[_0xd574d6(0x185)];const _0x480f27=await this[_0xd574d6(0x178)][_0xd574d6(0x19a)](_0x48bf92);return{'userInfo':_0x771f88,'userBalance':Object['assign']({},_0x480f27)};}async[_0x43f74d(0x1cc)](_0x2f448d){const _0x23f9ea=_0x43f74d;return await this[_0x23f9ea(0x1b6)][_0x23f9ea(0x183)]({'where':{'id':_0x2f448d}});}async['getUserOpenId'](_0xd6a4df){const _0x59829b=_0x43f74d;return await this[_0x59829b(0x1b6)][_0x59829b(0x183)]({'where':{'openId':_0xd6a4df}});}async[_0x43f74d(0x192)](_0x496771,_0x424907){const _0x2f7bb3=_0x43f74d,{id:_0x285e4d}=_0x424907[_0x2f7bb3(0x19e)],_0x9b0f8c=await this[_0x2f7bb3(0x1b6)][_0x2f7bb3(0x183)]({'where':{'id':_0x285e4d}});if(!_0x9b0f8c)throw new common_1['HttpException'](_0x2f7bb3(0x15b),common_1['HttpStatus'][_0x2f7bb3(0x14c)]);if(_0x496771['username']&&_0x9b0f8c[_0x2f7bb3(0x1d3)]===_0x496771[_0x2f7bb3(0x1d3)])throw new common_1[(_0x2f7bb3(0x154))](_0x2f7bb3(0x1be),common_1['HttpStatus'][_0x2f7bb3(0x14c)]);if(_0x496771[_0x2f7bb3(0x1d3)]){const _0x5399f6=await this[_0x2f7bb3(0x1b6)][_0x2f7bb3(0x183)]({'where':{'username':_0x496771[_0x2f7bb3(0x1d3)],'id':(0x0,typeorm_2[_0x2f7bb3(0x140)])(_0x285e4d)}});if(_0x5399f6)throw new common_1[(_0x2f7bb3(0x154))](_0x2f7bb3(0x1d1),common_1[_0x2f7bb3(0x13e)]['BAD_REQUEST']);}const _0x4bc10d=await this[_0x2f7bb3(0x1b6)][_0x2f7bb3(0x19d)]({'id':_0x285e4d},_0x496771);if(_0x4bc10d[_0x2f7bb3(0x193)]<=0x0)throw new common_1[(_0x2f7bb3(0x154))]('修改用户信息失败！',common_1[_0x2f7bb3(0x13e)][_0x2f7bb3(0x14c)]);return'修改用户信息成功！';}async['updateUserPassword'](_0x519287,_0x1b1264){const _0x31c9c8=_0x43f74d,_0x2de181=bcrypt['hashSync'](_0x1b1264,0xa),_0x4db68e=await this[_0x31c9c8(0x1b6)][_0x31c9c8(0x19d)]({'id':_0x519287},{'password':_0x2de181});if(_0x4db68e[_0x31c9c8(0x193)]<=0x0)throw new common_1['HttpException'](_0x31c9c8(0x159),common_1[_0x31c9c8(0x13e)][_0x31c9c8(0x14c)]);}async[_0x43f74d(0x141)](_0x59abc6){const _0x2eade8=_0x43f74d,{id:_0xcec8b6}=_0x59abc6[_0x2eade8(0x19e)],_0x5d8a1a=await this['userEntity'][_0x2eade8(0x183)]({'where':{'id':_0xcec8b6}});if(!_0x5d8a1a||_0x5d8a1a['inviteCode'])throw new common_1['HttpException']('已生成过邀请码、请勿重复生成',common_1[_0x2eade8(0x13e)][_0x2eade8(0x14c)]);const _0x2cbd62=(0x0,utils_1[_0x2eade8(0x18b)])(),_0x1fb3dc=await this['userEntity'][_0x2eade8(0x183)]({'where':{'inviteCode':_0x2cbd62}});if(_0x1fb3dc)throw new common_1['HttpException'](_0x2eade8(0x1c2),common_1[_0x2eade8(0x13e)][_0x2eade8(0x14c)]);const _0x39279d=await this[_0x2eade8(0x1b6)][_0x2eade8(0x19d)]({'id':_0xcec8b6},{'inviteCode':_0x2cbd62});if(_0x39279d['affected']<=0x0)throw new common_1[(_0x2eade8(0x154))](_0x2eade8(0x1c2),common_1[_0x2eade8(0x13e)][_0x2eade8(0x14c)]);return _0x2cbd62;}async[_0x43f74d(0x1b7)](_0x1515f1,_0x53a13d){const _0x1990b7=_0x43f74d;try{const {id:_0x369369}=_0x1515f1[_0x1990b7(0x19e)],{page:page=0x1,size:size=0xa}=_0x53a13d,_0x292a67=await this[_0x1990b7(0x1b6)][_0x1990b7(0x183)]({'where':{'id':_0x369369}}),{inviteCode:_0x5daeb5}=_0x292a67;if(!_0x5daeb5)return[];const [_0x6bce45,_0x25c760]=await this['userEntity']['findAndCount']({'where':{'inviteCode':_0x5daeb5},'order':{'id':'DESC'},'select':[_0x1990b7(0x1d3),_0x1990b7(0x1da),'createdAt','status',_0x1990b7(0x168)],'take':size,'skip':(page-0x1)*size});return(0x0,utils_1[_0x1990b7(0x191)])(_0x6bce45)[_0x1990b7(0x182)](_0x5936bf=>{const _0x22b685=_0x1990b7;return _0x5936bf[_0x22b685(0x1da)]=(0x0,utils_1[_0x22b685(0x1b9)])(_0x5936bf['email']),_0x5936bf;}),{'rows':_0x6bce45,'count':_0x25c760};}catch(_0x4890a7){console['log']('error:\x20',_0x4890a7);throw new common_1[(_0x1990b7(0x154))]('获取邀请记录失败！',common_1['HttpStatus']['BAD_REQUEST']);}}async[_0x43f74d(0x161)](_0x337aa0){const _0x147dc8=_0x43f74d,_0x11dab5=await this[_0x147dc8(0x1b6)][_0x147dc8(0x183)]({'where':{'inviteCode':_0x337aa0}});if(!_0x11dab5)return 0x1;const {inviteLinkCount:inviteLinkCount=0x0}=_0x11dab5,_0x160be5=await this['userEntity'][_0x147dc8(0x19d)]({'inviteCode':_0x337aa0},{'inviteLinkCount':inviteLinkCount+0x1});return _0x160be5['affected']?0x1:0x0;}async[_0x43f74d(0x16d)](_0x31c104){const _0x2426f8=_0x43f74d;return await this[_0x2426f8(0x1b6)][_0x2426f8(0x183)]({'where':{'inviteCode':_0x31c104}});}async[_0x43f74d(0x188)](_0x39fb7f){const _0x45f4b5=_0x43f74d,{userId:_0xa25a2d,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x39fb7f;await this['userBalanceService'][_0x45f4b5(0x189)](_0xa25a2d,{'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount});const _0x4250d6=await this[_0x45f4b5(0x178)][_0x45f4b5(0x180)]({'userId':_0xa25a2d,'rechargeType':balance_constant_1[_0x45f4b5(0x1a9)]['ADMIN_GIFT'],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'extent':''});return _0x4250d6;}async[_0x43f74d(0x14d)](_0x7c0b53,_0x1b738d){const _0x3e234a=_0x43f74d,{page:page=0x1,size:size=0xa,username:_0x49b97b,email:_0x3338f8,status:_0x5ab3ad,keyword:_0x3f0b87,phone:_0x2ae2f3}=_0x7c0b53;let _0x3271a6={};_0x49b97b&&Object[_0x3e234a(0x13b)](_0x3271a6,{'username':(0x0,typeorm_2[_0x3e234a(0x15a)])('%'+_0x49b97b+'%')}),_0x3338f8&&Object['assign'](_0x3271a6,{'email':(0x0,typeorm_2[_0x3e234a(0x15a)])('%'+_0x3338f8+'%')}),_0x2ae2f3&&Object[_0x3e234a(0x13b)](_0x3271a6,{'phone':(0x0,typeorm_2[_0x3e234a(0x15a)])('%'+_0x2ae2f3+'%')}),_0x5ab3ad&&Object['assign'](_0x3271a6,{'status':_0x5ab3ad});_0x3f0b87&&(_0x3271a6=[{'username':(0x0,typeorm_2[_0x3e234a(0x15a)])('%'+_0x3f0b87+'%')},{'email':(0x0,typeorm_2['Like'])('%'+_0x3f0b87+'%')},{'phone':(0x0,typeorm_2[_0x3e234a(0x15a)])('%'+_0x3f0b87+'%')}]);const [_0x31624a,_0x55a340]=await this[_0x3e234a(0x1b6)][_0x3e234a(0x18d)]({'skip':(page-0x1)*size,'where':_0x3271a6,'take':size,'order':{'createdAt':_0x3e234a(0x1ca)},'cache':!![],'select':[_0x3e234a(0x1d3),_0x3e234a(0x168),_0x3e234a(0x142),_0x3e234a(0x160),'sign',_0x3e234a(0x1ce),'id',_0x3e234a(0x1da),_0x3e234a(0x144),'lastLoginIp',_0x3e234a(0x190)]}),_0x481466=_0x31624a['map'](_0x23db36=>_0x23db36['id']),_0x4f96f4=await this['userBalanceService'][_0x3e234a(0x1cf)](_0x481466);return _0x31624a[_0x3e234a(0x1c5)](_0x2d1b9b=>_0x2d1b9b[_0x3e234a(0x14b)]=_0x4f96f4['find'](_0x11d022=>_0x11d022['userId']===_0x2d1b9b['id'])),_0x1b738d[_0x3e234a(0x19e)][_0x3e234a(0x160)]!=='super'&&_0x31624a[_0x3e234a(0x1c5)](_0x53d77c=>_0x53d77c[_0x3e234a(0x1da)]=(0x0,utils_1['maskEmail'])(_0x53d77c[_0x3e234a(0x1da)])),_0x1b738d[_0x3e234a(0x19e)][_0x3e234a(0x160)]!==_0x3e234a(0x174)&&_0x31624a[_0x3e234a(0x1c5)](_0xf9d883=>_0xf9d883[_0x3e234a(0x1d8)]=(0x0,utils_1[_0x3e234a(0x1c1)])(_0xf9d883[_0x3e234a(0x1d8)])),_0x1b738d[_0x3e234a(0x19e)]['role']!=='super'&&_0x31624a[_0x3e234a(0x1c5)](_0x459195=>_0x459195[_0x3e234a(0x190)]=(0x0,utils_1[_0x3e234a(0x1c1)])(_0x459195[_0x3e234a(0x190)])),{'rows':_0x31624a,'count':_0x55a340};}async[_0x43f74d(0x176)]({id:_0x169758}){const _0x1dd831=_0x43f74d;return await this['userEntity'][_0x1dd831(0x183)]({'where':{'id':_0x169758},'select':[_0x1dd831(0x1d3),_0x1dd831(0x168),_0x1dd831(0x142),_0x1dd831(0x160),_0x1dd831(0x195),'status']});}async['updateStatus'](_0x4c50d5){const _0x2a6ce6=_0x43f74d,{id:_0x24c53b,status:_0x238928}=_0x4c50d5,_0xe68671=await this[_0x2a6ce6(0x1b6)][_0x2a6ce6(0x183)]({'where':{'id':_0x24c53b}});if(!_0xe68671)throw new common_1[(_0x2a6ce6(0x154))](_0x2a6ce6(0x186),common_1[_0x2a6ce6(0x13e)][_0x2a6ce6(0x14c)]);if(_0xe68671[_0x2a6ce6(0x160)]===_0x2a6ce6(0x174))throw new common_1[(_0x2a6ce6(0x154))]('超级管理员不可被操作！',common_1['HttpStatus']['BAD_REQUEST']);if(_0xe68671[_0x2a6ce6(0x1ce)]===user_constant_1[_0x2a6ce6(0x1c8)][_0x2a6ce6(0x1ac)])throw new common_1[(_0x2a6ce6(0x154))](_0x2a6ce6(0x166),common_1[_0x2a6ce6(0x13e)]['BAD_REQUEST']);if(_0xe68671[_0x2a6ce6(0x160)]===_0x2a6ce6(0x174))throw new common_1[(_0x2a6ce6(0x154))](_0x2a6ce6(0x18c),common_1['HttpStatus'][_0x2a6ce6(0x14c)]);if(_0x238928===user_constant_1[_0x2a6ce6(0x1c8)]['PENDING'])throw new common_1[(_0x2a6ce6(0x154))](_0x2a6ce6(0x177),common_1[_0x2a6ce6(0x13e)][_0x2a6ce6(0x14c)]);const _0x32e5e4=await this[_0x2a6ce6(0x1b6)][_0x2a6ce6(0x19d)]({'id':_0x24c53b},{'status':_0x238928});if(_0x32e5e4['affected']<=0x0)throw new common_1[(_0x2a6ce6(0x154))](_0x2a6ce6(0x17c),common_1[_0x2a6ce6(0x13e)]['BAD_REQUEST']);return _0x2a6ce6(0x164);}async[_0x43f74d(0x1c6)](_0x3ed2ac){const _0x2f89e3=_0x43f74d,{id:_0x38553a}=_0x3ed2ac,_0x2db3c5=await this[_0x2f89e3(0x1b6)][_0x2f89e3(0x183)]({'where':{'id':_0x38553a}});if(!_0x2db3c5)throw new common_1[(_0x2f89e3(0x154))](_0x2f89e3(0x186),common_1[_0x2f89e3(0x13e)][_0x2f89e3(0x14c)]);const _0x343781='123456',_0x7a4fcc=bcrypt[_0x2f89e3(0x19b)](_0x343781,0xa),_0x246a1c=await this['userEntity']['update']({'id':_0x38553a},{'password':_0x7a4fcc});if(_0x246a1c[_0x2f89e3(0x193)]<=0x0)throw new common_1[(_0x2f89e3(0x154))](_0x2f89e3(0x17e),common_1[_0x2f89e3(0x13e)]['BAD_REQUEST']);return'密码重置为['+_0x343781+_0x2f89e3(0x14e);}async[_0x43f74d(0x15e)](_0x4cd0c5,_0x593207){const _0x49a9=_0x43f74d;return await this[_0x49a9(0x1b6)][_0x49a9(0x19d)]({'id':_0x4cd0c5},{'lastLoginIp':_0x593207});}async[_0x43f74d(0x14a)](_0xc7fefb,_0x29074a){const _0x21601f=_0x43f74d,_0x46690b=await this[_0x21601f(0x1b6)][_0x21601f(0x183)]({'where':{'openId':_0xc7fefb}});if(!_0x46690b){const _0x295109=_0x29074a?_0x29074a['split'](':')[0x1]:'',_0x55a447=await this[_0x21601f(0x16d)](_0x295109),_0x3af51f=await this[_0x21601f(0x167)](_0xc7fefb,_0x295109);return await this['userBalanceService'][_0x21601f(0x1ae)](_0x3af51f['id'],_0x295109?_0x55a447===null||_0x55a447===void 0x0?void 0x0:_0x55a447['id']:null),_0x3af51f;}return _0x46690b;}async[_0x43f74d(0x167)](_0x46b7d3,_0x22d681){const _0x3b772c=_0x43f74d,_0x59eb04=await this[_0x3b772c(0x169)]['getConfigs']([_0x3b772c(0x16b)]),_0x573bac={'avatar':_0x59eb04,'username':'用户'+(0x0,utils_1[_0x3b772c(0x172)])(),'status':user_constant_1[_0x3b772c(0x1c8)]['ACTIVE'],'sex':0x0,'email':(0x0,utils_1[_0x3b772c(0x172)])()+'@default.com','invitedBy':_0x22d681,'openId':_0x46b7d3},_0x4fd44f=await this[_0x3b772c(0x1b6)][_0x3b772c(0x150)](_0x573bac);return _0x4fd44f;}async[_0x43f74d(0x152)](_0x338c6c,_0x2a7150){const _0x24891a=_0x43f74d;try{const _0x2687bb=await this[_0x24891a(0x1b6)][_0x24891a(0x183)]({'where':{'id':_0x2a7150}});if(!_0x2687bb)return{'status':![],'msg':'当前绑定用户不存在！'};const _0xb9bf91=await this[_0x24891a(0x1b6)][_0x24891a(0x183)]({'where':{'openId':_0x338c6c}});if(_0xb9bf91)return{'status':![],'msg':_0x24891a(0x1a7)};const _0x3ddf58=await this[_0x24891a(0x1b6)][_0x24891a(0x19d)]({'id':_0x2a7150},{'openId':_0x338c6c});if(_0x3ddf58[_0x24891a(0x193)]<=0x0)return{'status':![],'msg':_0x24891a(0x13c)};return{'status':!![],'msg':_0x24891a(0x1c4)};}catch(_0x2c2cc5){return{'status':![],'msg':_0x24891a(0x13c)};}}async[_0x43f74d(0x17a)](_0x5dddd9){const _0x48935f=_0x43f74d,_0x58c258=await this[_0x48935f(0x1b6)]['findOne']({'where':{'id':_0x5dddd9}});return _0x58c258===null||_0x58c258===void 0x0?void 0x0:_0x58c258[_0x48935f(0x185)];}async[_0x43f74d(0x1dc)](_0x17f85c){const _0x808ad=_0x43f74d,{username:_0xb85460,password:_0x2ed8c9,phone:_0x2223fc,phoneCode:_0x18ce14}=_0x17f85c,_0x288c0d=await this['userEntity']['findOne']({'where':[{'username':_0xb85460},{'phone':_0x2223fc}]});if(_0x288c0d&&_0x288c0d[_0x808ad(0x1d3)]===_0xb85460)throw new common_1[(_0x808ad(0x154))](_0x808ad(0x1df),common_1[_0x808ad(0x13e)][_0x808ad(0x14c)]);if(_0x288c0d&&_0x288c0d[_0x808ad(0x190)]===_0x2223fc)throw new common_1[(_0x808ad(0x154))](_0x808ad(0x16c),common_1[_0x808ad(0x13e)]['BAD_REQUEST']);}async[_0x43f74d(0x1c0)](_0x4a1f4e){const _0x4dea38=_0x43f74d;return await this[_0x4dea38(0x1b6)][_0x4dea38(0x150)](_0x4a1f4e);}};function _0x2e43(_0x5402b9,_0x449af0){const _0x1798e4=_0x1798();return _0x2e43=function(_0x2e4375,_0x1e0043){_0x2e4375=_0x2e4375-0x13b;let _0x1e542d=_0x1798e4[_0x2e4375];return _0x1e542d;},_0x2e43(_0x5402b9,_0x449af0);}UserService=__decorate([(0x0,common_1[_0x43f74d(0x1bd)])(),__param(0x0,(0x0,typeorm_1[_0x43f74d(0x15c)])(user_entity_1['UserEntity'])),__param(0x1,(0x0,typeorm_1[_0x43f74d(0x15c)])(whiteList_entity_1[_0x43f74d(0x16a)])),__param(0x7,(0x0,typeorm_1['InjectRepository'])(config_entity_1['ConfigEntity'])),__metadata(_0x43f74d(0x149),[typeorm_2[_0x43f74d(0x153)],typeorm_2[_0x43f74d(0x153)],typeorm_2[_0x43f74d(0x155)],verification_service_1[_0x43f74d(0x1c7)],mailer_1[_0x43f74d(0x1cb)],userBalance_service_1['UserBalanceService'],globalConfig_service_1[_0x43f74d(0x1e0)],typeorm_2['Repository']])],UserService),exports['UserService']=UserService;